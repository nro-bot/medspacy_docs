
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://nrobot.dev/medspacy_docs/reference/medspacy/context/">
      
      
        <link rel="prev" href="../common/util/">
      
      
        <link rel="next" href="context/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.3">
    
    
      
        <title>medspacy.context - Medspacy autogenerated docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.d7758b05.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#medspacy.context" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Medspacy autogenerated docs" class="md-header__button md-logo" aria-label="Medspacy autogenerated docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Medspacy autogenerated docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              medspacy.context
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Medspacy autogenerated docs" class="md-nav__button md-logo" aria-label="Medspacy autogenerated docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Medspacy autogenerated docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to MkDocs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>medspacy
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>medspacy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.components
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_tokenizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.custom_tokenizer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.ner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sentence_splitting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.sentence_splitting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.util
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_8" >
        
          
          <label class="md-nav__link" for="__nav_2_1_8" id="__nav_2_1_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>common
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_8">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>common
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.common
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/base_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.common.base_rule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/medspacy_matcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.common.medspacy_matcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/regex_matcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.common.regex_matcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.common.util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_9" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_9" id="__nav_2_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>context
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_9">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>context
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    medspacy.context
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    medspacy.context
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#medspacy.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConText" class="md-nav__link">
    <span class="md-ellipsis">
      ConText
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.categories" class="md-nav__link">
    <span class="md-ellipsis">
      categories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.input_span_type" class="md-nav__link">
    <span class="md-ellipsis">
      input_span_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.rules" class="md-nav__link">
    <span class="md-ellipsis">
      rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.span_group_name" class="md-nav__link">
    <span class="md-ellipsis">
      span_group_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.register_default_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      register_default_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.register_graph_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      register_graph_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.set_context_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      set_context_attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextGraph
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.apply_modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      apply_modifiers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.from_serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      from_serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.update_scopes" class="md-nav__link">
    <span class="md-ellipsis">
      update_scopes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextModifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextModifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.allowed_types" class="md-nav__link">
    <span class="md-ellipsis">
      allowed_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.category" class="md-nav__link">
    <span class="md-ellipsis">
      category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.direction" class="md-nav__link">
    <span class="md-ellipsis">
      direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.excluded_types" class="md-nav__link">
    <span class="md-ellipsis">
      excluded_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.max_scope" class="md-nav__link">
    <span class="md-ellipsis">
      max_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.max_targets" class="md-nav__link">
    <span class="md-ellipsis">
      max_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modifier_span" class="md-nav__link">
    <span class="md-ellipsis">
      modifier_span
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.num_targets" class="md-nav__link">
    <span class="md-ellipsis">
      num_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.rule" class="md-nav__link">
    <span class="md-ellipsis">
      rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.scope_span" class="md-nav__link">
    <span class="md-ellipsis">
      scope_span
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.__set_scope" class="md-nav__link">
    <span class="md-ellipsis">
      __set_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.allows" class="md-nav__link">
    <span class="md-ellipsis">
      allows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.from_serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      from_serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.limit_scope" class="md-nav__link">
    <span class="md-ellipsis">
      limit_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modifies" class="md-nav__link">
    <span class="md-ellipsis">
      modifies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modify" class="md-nav__link">
    <span class="md-ellipsis">
      modify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.on_modifies" class="md-nav__link">
    <span class="md-ellipsis">
      on_modifies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.reduce_targets" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.update_scope" class="md-nav__link">
    <span class="md-ellipsis">
      update_scope
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.context.context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context_graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.context.context_graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context_modifier/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.context.context_modifier
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.context.context_rule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.context.util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_10" >
        
          
          <label class="md-nav__link" for="__nav_2_1_10" id="__nav_2_1_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>io
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_10">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>io
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/config_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.config_example
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/db/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.db
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/db_connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.db_connect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/db_reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.db_reader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/db_writer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.db_writer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/doc_consumer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.doc_consumer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/pipeline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.io.pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_11" >
        
          
          <label class="md-nav__link" for="__nav_2_1_11" id="__nav_2_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>postprocess
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_11">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>postprocess
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.postprocess
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocess/postprocessing_functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.postprocess.postprocessing_functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocess/postprocessing_pattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.postprocess.postprocessing_pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocess/postprocessing_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.postprocess.postprocessing_rule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../postprocess/postprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.postprocess.postprocessor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_12" >
        
          
          <label class="md-nav__link" for="__nav_2_1_12" id="__nav_2_1_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>preprocess
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_12">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>preprocess
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocess/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.preprocess
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocess/preprocessing_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.preprocess.preprocessing_rule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocess/preprocessor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.preprocess.preprocessor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_13" >
        
          
          <label class="md-nav__link" for="__nav_2_1_13" id="__nav_2_1_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>section detection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_13">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>section detection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../section_detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.section_detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../section_detection/section/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.section_detection.section
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../section_detection/section_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.section_detection.section_rule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../section_detection/sectionizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.section_detection.sectionizer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../section_detection/util/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.section_detection.util
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_14" >
        
          
          <label class="md-nav__link" for="__nav_2_1_14" id="__nav_2_1_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>target matcher
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_14">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code>target matcher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../target_matcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.target_matcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../target_matcher/concept_tagger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.target_matcher.concept_tagger
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../target_matcher/target_matcher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.target_matcher.target_matcher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../target_matcher/target_rule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    medspacy.target_matcher.target_rule
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#medspacy.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConText" class="md-nav__link">
    <span class="md-ellipsis">
      ConText
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConText">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.categories" class="md-nav__link">
    <span class="md-ellipsis">
      categories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.input_span_type" class="md-nav__link">
    <span class="md-ellipsis">
      input_span_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.rules" class="md-nav__link">
    <span class="md-ellipsis">
      rules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.span_group_name" class="md-nav__link">
    <span class="md-ellipsis">
      span_group_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.register_default_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      register_default_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.register_graph_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      register_graph_attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConText.set_context_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      set_context_attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextGraph
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.apply_modifiers" class="md-nav__link">
    <span class="md-ellipsis">
      apply_modifiers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.from_serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      from_serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextGraph.update_scopes" class="md-nav__link">
    <span class="md-ellipsis">
      update_scopes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextModifier
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextModifier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.allowed_types" class="md-nav__link">
    <span class="md-ellipsis">
      allowed_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.category" class="md-nav__link">
    <span class="md-ellipsis">
      category
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.direction" class="md-nav__link">
    <span class="md-ellipsis">
      direction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.excluded_types" class="md-nav__link">
    <span class="md-ellipsis">
      excluded_types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.max_scope" class="md-nav__link">
    <span class="md-ellipsis">
      max_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.max_targets" class="md-nav__link">
    <span class="md-ellipsis">
      max_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modifier_span" class="md-nav__link">
    <span class="md-ellipsis">
      modifier_span
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.num_targets" class="md-nav__link">
    <span class="md-ellipsis">
      num_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.rule" class="md-nav__link">
    <span class="md-ellipsis">
      rule
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.scope_span" class="md-nav__link">
    <span class="md-ellipsis">
      scope_span
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.__set_scope" class="md-nav__link">
    <span class="md-ellipsis">
      __set_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.allows" class="md-nav__link">
    <span class="md-ellipsis">
      allows
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.from_serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      from_serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.limit_scope" class="md-nav__link">
    <span class="md-ellipsis">
      limit_scope
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modifies" class="md-nav__link">
    <span class="md-ellipsis">
      modifies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.modify" class="md-nav__link">
    <span class="md-ellipsis">
      modify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.on_modifies" class="md-nav__link">
    <span class="md-ellipsis">
      on_modifies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.reduce_targets" class="md-nav__link">
    <span class="md-ellipsis">
      reduce_targets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.serialized_representation" class="md-nav__link">
    <span class="md-ellipsis">
      serialized_representation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextModifier.update_scope" class="md-nav__link">
    <span class="md-ellipsis">
      update_scope
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule" class="md-nav__link">
    <span class="md-ellipsis">
      ConTextRule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConTextRule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.from_dict" class="md-nav__link">
    <span class="md-ellipsis">
      from_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#medspacy.context.ConTextRule.to_json" class="md-nav__link">
    <span class="md-ellipsis">
      to_json
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>medspacy.context</h1>

<div class="doc doc-object doc-module">



<a id="medspacy.context"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="medspacy.context.ConText" class="doc doc-heading">
            <code>ConText</code>


</h2>


    <div class="doc doc-contents ">


        <p>The ConText for spaCy processing.</p>
<p>This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.
Sets two spaCy extensions:
        - Span.<em>.modifiers: a list of ConTextModifier objects which modify a target Span
        - Doc.</em>.context_graph: a ConText graph object which contains the targets,
            modifiers, and edges between them.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_context&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConText for spaCy processing.</span>

<span class="sd">    This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.</span>
<span class="sd">    Sets two spaCy extensions:</span>
<span class="sd">            - Span._.modifiers: a list of ConTextModifier objects which modify a target Span</span>
<span class="sd">            - Doc._.context_graph: a ConText graph object which contains the targets,</span>
<span class="sd">                modifiers, and edges between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConText object.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A SpaCy Language object.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">                original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">                None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">                directly through `ConText.add`.</span>
<span class="sd">            language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">                and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">                Default is &quot;en&quot; for English.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">                terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">                ContextRule object.</span>
<span class="sd">            max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">                Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">                Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">                all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">                be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">                will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">                ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">                afib. Default True.</span>
<span class="sd">            prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">                False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">                targets in its scope. Default False.</span>
<span class="sd">            span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">                `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">                containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">                modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">                in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
            <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of ConTextRules available to context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of categories available that Context might produce.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds ConTextRules to Context.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
            <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Check custom termination points</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The edges of the ContextGraph to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the ConText algorithm to a Doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>
<span class="sd">            targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed spaCy Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># Store data in ConTextGraph object</span>
        <span class="c1"># TODO: move some of this over to ConTextGraph</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
            <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
        <span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="c1"># Get the ConTextRule object defining this modifier</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
            <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

        <span class="c1"># Link targets to their modifiers</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

        <span class="c1"># If attributes need to be modified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConText.categories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">categories</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns list of categories available that Context might produce.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConText.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConText.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns list of ConTextRules available to context.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConText.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Applies the ConText algorithm to a Doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed spaCy Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the ConText algorithm to a Doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>
<span class="sd">        targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed spaCy Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="c1"># Store data in ConTextGraph object</span>
    <span class="c1"># TODO: move some of this over to ConTextGraph</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
        <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
    <span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="c1"># Get the ConTextRule object defining this modifier</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
    <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

    <span class="c1"># Link targets to their modifiers</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

    <span class="c1"># If attributes need to be modified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_context&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminating_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prune_on_target_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span_attrs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">input_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a new ConText object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.language.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SpaCy Language object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_context&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rules to load. Default is "default", loads rules packaged with medspaCy that are derived from
original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If
None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules
directly through <code>ConText.add</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language_code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language code to use (ISO code) as a default for loading resources.  See documentation
and also the /resources directory to see which resources might be available in each language.
Default is "en" for English.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phrase_matcher_attr</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token attribute to use for PhraseMatcher for rules where <code>pattern</code> is None. Default
is 'LOWER'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;LOWER&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types included by context. Rules will operate on only spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types excluded by context. Rules will not operate on spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminating_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Iterable">Iterable</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global map of types to the types that can terminate them. This can be used to apply
terminations to all rules of a particular type rather than adding to every rule individually in the
ContextRule object.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens around a modifier in a target can be modified. Default value is None,
Context will use the sentence boundaries. If a value greater than zero, applies the window globally.
Both options will be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets a modifier can modify. Default value is None, context will modify
all targets in its scope. If a value greater than zero, applies this value globally. Both options will
be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers which are substrings of another modifier. If True,
will drop substrings completely. For example, if "no history of"  and "history of" are both
ConTextRules,both will match the text "no history of afib", but only "no  history of" should modify
afib. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_target_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to remove any matched modifiers which overlap with target entities. If
False, any overlapping modifiers will not modify the overlapping entity but will still modify any other
targets in its scope. Default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_attrs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;default&#39;], <span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional span attributes to modify. Default option "default" uses attributes in
<code>DEFAULT_ATTRIBUTES</code>. If a dictionary, format is mapping context modifier categories to a dictionary
containing the attribute name and the value to set the attribute to when a  span is modified by a
modifier of that category. If None, no attributes will be modified.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_span_type</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"ents" or "group". Where to look for targets. "ents" will modify attributes of spans
in doc.ents. "group" will modify attributes of spans in the span group specified by <code>span_group_name</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the span group used when <code>input_span_type</code> is "group". Default is
"medspacy_spans".</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConText object.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A SpaCy Language object.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">            original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">            None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">            directly through `ConText.add`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">            terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">            ContextRule object.</span>
<span class="sd">        max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">            Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">            Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">            all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">            be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">            will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">            ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">            afib. Default True.</span>
<span class="sd">        prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">            False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">            targets in its scope. Default False.</span>
<span class="sd">        span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">            `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">            containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">            modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">            in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
        <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

    <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds ConTextRules to Context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds ConTextRules to Context.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
        <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Check custom termination points</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.register_default_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_default_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Registers the default values for the Span attributes defined in <code>DEFAULT_ATTRIBUTES</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.register_graph_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_graph_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Registers spaCy attribute extensions: Span.<em>.modifiers and Doc.</em>.context_graph.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConText.set_context_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Adds Span-level attributes to targets with modifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edges of the ContextGraph to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: The edges of the ContextGraph to modify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="medspacy.context.ConTextGraph" class="doc doc-heading">
            <code>ConTextGraph</code>


</h2>


    <div class="doc doc-contents ">


        <p>The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,
matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</p>
<p>Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of
of the graph.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,</span>
<span class="sd">    matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</span>

<span class="sd">    Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of</span>
<span class="sd">    of the graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConTextGraph object.</span>

<span class="sd">        Args:</span>
<span class="sd">            targets: A spans that context might modify.</span>
<span class="sd">            modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">            edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the scope of all ConTextModifier.</span>

<span class="sd">        For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">        modifier to see if one of the modifiers should update the other.</span>
<span class="sd">        This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">        scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
                <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
                <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
                <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">        create an edge between them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># Now do a second pass and reduce the number of targets</span>
        <span class="c1"># for any modifiers with a max_targets int</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextGraph&gt; with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span><span class="si">}</span><span class="s2"> targets and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span><span class="si">}</span><span class="s2"> modifiers&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the serialized representation of the ConTextGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the ConTextGraph from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextGraph.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a new ConTextGraph object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spans that context might modify.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modifiers</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.ConTextModifier" href="../../../#medspacy.context.ConTextModifier">ConTextModifier</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextModifiers that might modify the targets.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of edges between targets and modifiers representing the modification relationship.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers when one modifier completely covers another.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConTextGraph object.</span>

<span class="sd">    Args:</span>
<span class="sd">        targets: A spans that context might modify.</span>
<span class="sd">        modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">        edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextGraph.apply_modifiers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_modifiers</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks each target/modifier pair. If modifier modifies target,
create an edge between them.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">    create an edge between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># Now do a second pass and reduce the number of targets</span>
    <span class="c1"># for any modifiers with a max_targets int</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextGraph.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates the ConTextGraph from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the ConTextGraph from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextGraph.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the serialized representation of the ConTextGraph</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the serialized representation of the ConTextGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextGraph.update_scopes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scopes</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the scope of all ConTextModifier.</p>
<p>For each modifier in a list of ConTextModifiers, check against each other
modifier to see if one of the modifiers should update the other.
This allows neighboring similar modifiers to extend each other's
scope and allows "terminate" modifiers to end a modifier's scope.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the scope of all ConTextModifier.</span>

<span class="sd">    For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">    modifier to see if one of the modifiers should update the other.</span>
<span class="sd">    This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">    scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
            <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
            <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
            <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="medspacy.context.ConTextModifier" class="doc doc-heading">
            <code>ConTextModifier</code>


</h2>


    <div class="doc doc-contents ">


        <p>Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching
text in a Doc.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching</span>
<span class="sd">    text in a Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
        <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">        window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">        this ConTextModifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">            start: The start token index.</span>
<span class="sd">            end: The end token index (non-inclusive).</span>
<span class="sd">            doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">                maintained.</span>
<span class="sd">            scope_start: The start token index of the scope.</span>
<span class="sd">            scope_end: The end index of the scope.</span>
<span class="sd">            max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifier_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The spaCy Span object, which is a view of self.doc, covered by this match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rule</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated context rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">direction</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scope_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allowed_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated allowed types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">allowed_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">excluded_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated excluded types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">excluded_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">        self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">        self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">        direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">        If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">        reduced to self.max_scope.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy doc to use to set scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
                <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">)</span>
        <span class="c1"># Otherwise, use the sentence</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
            <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                    <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                    <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Set the max scope on either side</span>
            <span class="c1"># Backwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="c1"># Forwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the scope of self to be the given spaCy span.</span>

<span class="sd">        Args:</span>
<span class="sd">            span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">        to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">        modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">        &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">        CHF, but there is pneumonia&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            other: The modifier to check against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the other modifier modified the scope of self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check if the other modifier is a type which can modify self</span>
        <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If two modifiers have the same category but modify different target types,</span>
        <span class="c1"># don&#39;t limit scope.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: a spaCy span representing a target concept.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
        <span class="c1"># one extracted as both a target and modifier, return False</span>
        <span class="c1"># to avoid self-modifying concepts</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_label: The target type to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">            `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">        either True or False.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to evaluate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Find the span in between the target and modifier</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
                <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">rslt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">        `self.max_targets` is None, no pruning is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
            <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
        <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextModifier&gt; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialized Representation of the modifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

        <span class="k">return</span> <span class="n">dict_repr</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the class from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.allowed_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allowed_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated allowed types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">category</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated category.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.direction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">direction</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated direction.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.excluded_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">excluded_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated excluded types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.max_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_scope</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum scope.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.max_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.modifier_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifier_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The spaCy Span object, which is a view of self.doc, covered by this match.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.num_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.rule" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated context rule.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="medspacy.context.ConTextModifier.scope_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the associated scope.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">context_rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">scope_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding
window. Spans such as entities or other members of span groups that occur within this window can be modified by
this ConTextModifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context_rule</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="../../../#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule object which defines the modifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end token index (non-inclusive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc which contains this span. This is needed to initialize the modifier but is not
maintained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_start</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use scope values rather than sentence boundaries for modifications.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
    <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">    window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">    this ConTextModifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">        start: The start token index.</span>
<span class="sd">        end: The end token index (non-inclusive).</span>
<span class="sd">        doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">            maintained.</span>
<span class="sd">        scope_start: The start token index of the scope.</span>
<span class="sd">        scope_end: The end index of the scope.</span>
<span class="sd">        max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.__set_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If
self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by
self.direction. For example, if the direction is "forward", the scope will be [self.end: sentence.end]. If the
direction is "backward", it will be [self.start: sentence.start].</p>
<p>If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be
reduced to self.max_scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy doc to use to set scope.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">    self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">    self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">    direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">    If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">    reduced to self.max_scope.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy doc to use to set scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">)</span>
    <span class="c1"># Otherwise, use the sentence</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
        <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Set the max scope on either side</span>
        <span class="c1"># Backwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="c1"># Forwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.allows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allows</span><span class="p">(</span><span class="n">target_label</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns whether if a modifier is able to modify a target type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_label</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target type to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the modifier is allowed to modify a target of the specified type. True if <code>target_label</code> in</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>self.allowed_types</code> or if <code>target_label</code> not in <code>self.excluded_tupes</code>. False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_label: The target type to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">        `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Instantiates the class from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the class from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.limit_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">limit_scope</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>If self and other have the same category or if other has a directionality of 'terminate', use the span of other
to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of
modifiers. For example, in 'no evidence of CHF, no pneumonia', 'pneumonia' will only be modified by 'no', not
'no evidence of'. 'terminate' modifiers limit the scope of a modifier like 'no evidence of' in 'no evidence of
CHF, but there is pneumonia'</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_modifier.ConTextModifier" href="../../../#medspacy.context.context_modifier.ConTextModifier">ConTextModifier</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modifier to check against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the other modifier modified the scope of self.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">    to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">    modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">    &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">    CHF, but there is pneumonia&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        other: The modifier to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the other modifier modified the scope of self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check if the other modifier is a type which can modify self</span>
    <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># If two modifiers have the same category but modify different target types,</span>
    <span class="c1"># don&#39;t limit scope.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks whether the target is within the modifier scope and if self is allowed to modify target.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy span representing a target concept.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the target is within <code>modifier_scope</code> and if self is allowed to modify the target.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: a spaCy span representing a target concept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
    <span class="c1"># one extracted as both a target and modifier, return False</span>
    <span class="c1"># to avoid self-modifying concepts</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
    <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.modify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Add target to the list of self._targets and increment self._num_targets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.on_modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>If the ConTextRule used to define a ConTextModifier has an <code>on_modifies</code> callback function, evaluate and return
either True or False.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the <code>on_modifies</code> callback for the rule. True if the callback is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">    either True or False.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to evaluate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Find the span in between the target and modifier</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
            <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">rslt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.reduce_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_targets</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reduces the number of targets to the n-closest targets based on the value of <code>self.max_targets</code>. If
<code>self.max_targets</code> is None, no pruning is done.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">    `self.max_targets` is None, no pruning is done.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
        <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
    <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Serialized Representation of the modifier</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialized Representation of the modifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="k">return</span> <span class="n">dict_repr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextModifier.update_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scope</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Changes the scope of self to be the given spaCy span.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy Span which contains the scope which a modifier should cover.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the scope of self to be the given spaCy span.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="medspacy.context.ConTextRule" class="doc doc-heading">
            <code>ConTextRule</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="../../../#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers
and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in
the text, and what types of target spans can be modified.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers</span>
<span class="sd">    and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in</span>
<span class="sd">    the text, and what types of target spans can be modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_DIRECTIONS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PSEUDO&quot;</span>
    <span class="p">)</span>
    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ConTextRule object.</span>

<span class="sd">        The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">        semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">        Other arguments specify additional custom logic such as:</span>
<span class="sd">            - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">            - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">            - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">            - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">            terminated_by)</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">                include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">                Valid values are:</span>
<span class="sd">                - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">                - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">                - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">                - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                    &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                    &quot;pneumonia&quot;</span>
<span class="sd">                - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                    superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                    phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                    modifier.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">                specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">                callable should take 3 arguments:</span>
<span class="sd">                    target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                    modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                    span_between: The Span between the target and modifier in question.</span>
<span class="sd">                Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">            allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">                not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">                An error will be thrown if both are not None.</span>
<span class="sd">            excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">                target types unless allowed_types is not None.</span>
<span class="sd">            max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">                include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">                This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">                modifier ranges caused by sentence splitting problems.</span>
<span class="sd">            max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">                its scope.</span>
<span class="sd">            terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">                modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">                terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">                positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">                This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
                <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">                JSONs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of ConTextRules objects read from the JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
            <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">context_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a dictionary into a ConTextRule.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: The dictionary to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ConTextRule created from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dictionary containing the ConTextRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">            Args:</span>
<span class="sd">            context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">            filepath: the .json file to contain modifier rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ConTextRule(literal=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&#39;, category=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;direction=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;BIDIRECTIONAL&#39;</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_modifies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminated_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a ConTextRule object.</p>
<p>The primary arguments of <code>literal</code> <code>category</code>, and <code>direction</code> define the span of text to be matched, the
semantic category, and the direction within the sentence in which the modifier operates.
Other arguments specify additional custom logic such as:
    - Additional control over what text can be matched as a modifier (pattern and on_match)
    - Which types of targets can be modified (allowed_types, excluded_types)
    - The scope size and number of targets that a modifier can modify (max_targets, max_scope)
    - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,
    terminated_by)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directionality or action of a modifier. This defines which part of a sentence a modifier will
include as its scope. Entities within the scope will be considered to be modified.
Valid values are:
- "FORWARD": Scope will begin after the end of a modifier and move to the right
- "BACKWARD": Scope will begin before the beginning of a modifier and move to the left
- "BIDIRECTIONAL": Scope will expand on either side of a modifier
- "TERMINATE": A special direction to limit any other modifiers if this phrase is in its scope. Example:
    "no evidence of chf but there is pneumonia": "but" will prevent "no evidence of" from modifying
    "pneumonia"
- "PSEUDO": A special direction which will not modify any targets. This can be used for differentiating
    superstrings of modifiers. Example: A modifier with literal="negative attitude" will prevent the
    phrase "negative" in "She has a negative attitude about her treatment" from being extracted as a
    modifier.</p>
              </div>
            </td>
            <td>
                  <code>&#39;BIDIRECTIONAL&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_modifies</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>], bool]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callback function to run when building an edge between a target and a modifier. This allows
specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The
callable should take 3 arguments:
    target: The spaCy Span from doc.ents (ie., 'Evidence of pneumonia')
    modifier: The spaCy Span covered in a resulting modifier (ie., 'no evidence of')
    span_between: The Span between the target and modifier in question.
Should return either True or False. If returns False, then the modifier will not modify the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels to allow a modifier to modify. If None, will apply to any type
not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.
An error will be thrown if both are not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels which this modifier cannot modify. If None, will apply to all
target types unless allowed_types is not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number of tokens to explicitly limit the size of the modifier's scope. If None, the scope will
include the entire sentence in the direction of <code>direction</code> and the entire sentence for "BIDIRECTIONAL".
This is useful for requiring modifiers be very close to a concept in the text or for preventing long
modifier ranges caused by sentence splitting problems.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets which a modifier can modify. If None, will modify all targets in
its scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminated_by</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional collection of other modifier categories which will terminate the scope of this
modifier. If None, only "TERMINATE" will do this. Example: if a ConTextRule defining "positive for" has
terminated_by={"NEGATED_EXISTENCE"}, then in the sentence "positive for flu, negative for RSV", the
positive modifier will modify "flu" but will be terminated by "negative for" and will not modify "RSV".
This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a ConTextRule object.</span>

<span class="sd">    The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">    semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">    Other arguments specify additional custom logic such as:</span>
<span class="sd">        - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">        - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">        - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">        - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">        terminated_by)</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">            include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">            Valid values are:</span>
<span class="sd">            - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">            - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">            - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">            - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                &quot;pneumonia&quot;</span>
<span class="sd">            - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                modifier.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">            specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">            callable should take 3 arguments:</span>
<span class="sd">                target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                span_between: The Span between the target and modifier in question.</span>
<span class="sd">            Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">        allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">            not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">            An error will be thrown if both are not None.</span>
<span class="sd">        excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">            target types unless allowed_types is not None.</span>
<span class="sd">        max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">            include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">            This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">            modifier ranges caused by sentence splitting problems.</span>
<span class="sd">        max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">            its scope.</span>
<span class="sd">        terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">            modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">            terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">            positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">            This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
            <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

    <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a ConTextRule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="../../../#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule created from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a dictionary into a ConTextRule.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: The dictionary to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ConTextRule created from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Reads in a lexicon of modifiers from a JSON file under the key <code>context_rules</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The .json file containing modifier rules. Must contain <code>context_rules</code> key containing the rule
JSONs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="../../../#medspacy.context.context_rule.ConTextRule">ConTextRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextRules objects read from the JSON.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">            JSONs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of ConTextRules objects read from the JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
        <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">context_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary containing the ConTextRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary containing the ConTextRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.context.ConTextRule.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">context_rules</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Writes ConTextItems to a json file.</p>
<p>Args:
context_rules: a list of ContextRules that will be written to a file.
filepath: the .json file to contain modifier rules</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">        context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">        filepath: the .json file to contain modifier rules</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>