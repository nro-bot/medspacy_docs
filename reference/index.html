<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Reference - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Welcome to MkDocs</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Reference</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy" class="nav-link">medspacy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy._extensions" class="nav-link">_extensions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.common" class="nav-link">common</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.context" class="nav-link">context</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.custom_tokenizer" class="nav-link">custom_tokenizer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.io" class="nav-link">io</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.postprocess" class="nav-link">postprocess</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.preprocess" class="nav-link">preprocess</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.section_detection" class="nav-link">section_detection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.sentence_splitting" class="nav-link">sentence_splitting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.target_matcher" class="nav-link">target_matcher</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.util" class="nav-link">util</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="2"><a href="#medspacy.visualization" class="nav-link">visualization</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="doc doc-object doc-module">



<a id="medspacy"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="medspacy._extensions" class="doc doc-heading">
            <code>_extensions</code>


</h2>

    <div class="doc doc-contents ">

        <p>This module will set extension attributes and methods for medspaCy. Examples include custom methods like span._.window()</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.any_context_attribute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">any_context_attribute</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return True if any of the ConText assertion attributes (is_negated, is_historical, etc.) is True.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">any_context_attribute</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
    <span class="s2">&quot;Return True if any of the ConText assertion attributes (is_negated, is_historical, etc.) is True.&quot;</span>
    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_attributes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.data_to_rows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">data_to_rows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Unzip column-wise data from doc._.data into rows</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">data_to_rows</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unzip column-wise data from doc._.data into rows&quot;&quot;&quot;</span>
    <span class="n">col_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="n">row_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">col_data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">row_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.get_context_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_context_attributes</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return a dict of all ConText assertion attributes (is_negated, is_historical, etc.)
and their values.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_context_attributes</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a dict of all ConText assertion attributes (is_negated, is_historical, etc.)</span>
<span class="sd">    and their values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attr_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">_context_attributes</span><span class="p">:</span>
        <span class="n">attr_dict</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">attr_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.get_extensions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_extensions</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a list of medspaCy extensions for Token, Span, and Doc classes.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_extensions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of medspaCy extensions for Token, Span, and Doc classes.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;Token&quot;</span><span class="p">:</span> <span class="n">get_token_extensions</span><span class="p">(),</span>
        <span class="s2">&quot;Span&quot;</span><span class="p">:</span> <span class="n">get_span_extensions</span><span class="p">(),</span>
        <span class="s2">&quot;Doc&quot;</span><span class="p">:</span> <span class="n">get_doc_extensions</span><span class="p">(),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.get_span_literal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_span_literal</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the literal value from an entity's TargetRule, which is set when an entity is extracted by TargetMatcher.
If the span does not have a TargetRule, it returns the lower-cased text.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_span_literal</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the literal value from an entity&#39;s TargetRule, which is set when an entity is extracted by TargetMatcher.</span>
<span class="sd">    If the span does not have a TargetRule, it returns the lower-cased text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_rule</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">target_rule</span>
    <span class="k">if</span> <span class="n">target_rule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">target_rule</span><span class="o">.</span><span class="n">literal</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.get_window_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_window_span</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a Span of a window of text containing a span.
Args:
    n (int): Number of tokens on each side of a span to return.
        Default 1.
    left (bool): Whether to include the span precedinga span.
        Default True.
    right (bool): Whether to include the span following a span.
        Default True.
Returns:
    a spaCy Span</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_window_span</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a Span of a window of text containing a span.</span>
<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of tokens on each side of a span to return.</span>
<span class="sd">            Default 1.</span>
<span class="sd">        left (bool): Whether to include the span precedinga span.</span>
<span class="sd">            Default True.</span>
<span class="sd">        right (bool): Whether to include the span following a span.</span>
<span class="sd">            Default True.</span>
<span class="sd">    Returns:</span>
<span class="sd">        a spaCy Span</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">span</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
    <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">span</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">doc</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.get_window_token" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_window_token</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a Span of a window of text containing a token.
Args:
    n (int): Number of tokens on each side of token to return.
        Default 1.
    left (bool): Whether to include the span preceding token.
        Default True.
    right (bool): Whether to include the span following token.
        Default True.
Returns:
    a spaCy Span</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_window_token</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a Span of a window of text containing a token.</span>
<span class="sd">    Args:</span>
<span class="sd">        n (int): Number of tokens on each side of token to return.</span>
<span class="sd">            Default 1.</span>
<span class="sd">        left (bool): Whether to include the span preceding token.</span>
<span class="sd">            Default True.</span>
<span class="sd">        right (bool): Whether to include the span following token.</span>
<span class="sd">            Default True.</span>
<span class="sd">    Returns:</span>
<span class="sd">        a spaCy Span</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span>
    <span class="k">if</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">token</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy._extensions.set_extensions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_extensions</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set custom medspaCy extensions for Token, Span, and Doc classes.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/_extensions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_extensions</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set custom medspaCy extensions for Token, Span, and Doc classes.&quot;&quot;&quot;</span>
    <span class="n">set_token_extensions</span><span class="p">()</span>
    <span class="n">set_span_extensions</span><span class="p">()</span>
    <span class="n">set_doc_extensions</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.common" class="doc doc-heading">
            <code>common</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="medspacy.common.base_rule" class="doc doc-heading">
            <code>base_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.common.base_rule.BaseRule" class="doc doc-heading">
            <code>BaseRule</code>


</h4>


    <div class="doc doc-contents ">


        <p>BaseRule is the basic class for the rules contained in the MedspacyMatcher class. It contains the basic structure
for a rule to be used by the spaCy matchers or by the RegexMatcher class in order to produce match tuples for
processing by a component such as the Sectionizer, ContextComponent or TargetMatcher</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/common/base_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BaseRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    BaseRule is the basic class for the rules contained in the MedspacyMatcher class. It contains the basic structure</span>
<span class="sd">    for a rule to be used by the spaCy matchers or by the RegexMatcher class in order to produce match tuples for</span>
<span class="sd">    processing by a component such as the Sectionizer, ContextComponent or TargetMatcher</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Base class for medspaCy rules such as TargetRule and ConTextRule.</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The plaintext form of the pattern. Can be a human-readable form of a more complex pattern or, if</span>
<span class="sd">                `pattern` is None, the literal is used in a spaCy PhraseMatcher by the MedspacyMatcher.</span>
<span class="sd">            category: The category for the match. Corresponds to ent.label_ for entities.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">literal</span> <span class="o">=</span> <span class="n">literal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_match</span> <span class="o">=</span> <span class="n">on_match</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.common.base_rule.BaseRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Base class for medspaCy rules such as TargetRule and ConTextRule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The plaintext form of the pattern. Can be a human-readable form of a more complex pattern or, if
<code>pattern</code> is None, the literal is used in a spaCy PhraseMatcher by the MedspacyMatcher.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category for the match. Corresponds to ent.label_ for entities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/base_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for medspaCy rules such as TargetRule and ConTextRule.</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The plaintext form of the pattern. Can be a human-readable form of a more complex pattern or, if</span>
<span class="sd">            `pattern` is None, the literal is used in a spaCy PhraseMatcher by the MedspacyMatcher.</span>
<span class="sd">        category: The category for the match. Corresponds to ent.label_ for entities.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">literal</span> <span class="o">=</span> <span class="n">literal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">pattern</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_match</span> <span class="o">=</span> <span class="n">on_match</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.common.medspacy_matcher" class="doc doc-heading">
            <code>medspacy_matcher</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.common.medspacy_matcher.MedspacyMatcher" class="doc doc-heading">
            <code>MedspacyMatcher</code>


</h4>


    <div class="doc doc-contents ">


        <p>MedspacyMatcher is a class which combines spaCy's Matcher and PhraseMatcher classes along with medspaCy's
RegexMatcher and acts as one single matcher using 3 different types of rules:
    - Exact phrases
    - List of dictionaries for matching on token attributes (see https://spacy.io/usage/rule-based-matching#matcher)
    - Regular expression matches. Note that regular-expression matching is not natively supported by spaCy and could
            result in unexpected matched spans if match boundaries do not align with token boundaries.
Rules can be defined by any class which inherits from medspacy.common.BaseRule, such as:
    medspacy.target_matcher.TargetRule
    medspacy.context.ConTextRule</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/common/medspacy_matcher.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MedspacyMatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MedspacyMatcher is a class which combines spaCy&#39;s Matcher and PhraseMatcher classes along with medspaCy&#39;s</span>
<span class="sd">    RegexMatcher and acts as one single matcher using 3 different types of rules:</span>
<span class="sd">        - Exact phrases</span>
<span class="sd">        - List of dictionaries for matching on token attributes (see https://spacy.io/usage/rule-based-matching#matcher)</span>
<span class="sd">        - Regular expression matches. Note that regular-expression matching is not natively supported by spaCy and could</span>
<span class="sd">                result in unexpected matched spans if match boundaries do not align with token boundaries.</span>
<span class="sd">    Rules can be defined by any class which inherits from medspacy.common.BaseRule, such as:</span>
<span class="sd">        medspacy.target_matcher.TargetRule</span>
<span class="sd">        medspacy.context.ConTextRule</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;medspacy_matcher&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_matcher&quot;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span> <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a MedspacyMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A spaCy Language model.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            phrase_matcher_attr: The attribute to use for spaCy&#39;s PhraseMatcher. Default is &#39;LOWER&#39;.</span>
<span class="sd">            prune: Whether to prune matches that overlap or are substrings of another match. For example, if &quot;no history</span>
<span class="sd">                of&quot; and &quot;history of&quot; are both matches, setting prune to True would drop &quot;history of&quot;. Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span> <span class="c1"># preserve only the tokenizer for creating phrasematcher rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span> <span class="o">=</span> <span class="n">prune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">Matcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span> <span class="o">=</span> <span class="n">PhraseMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span> <span class="o">=</span> <span class="n">RegexMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher_attr</span> <span class="o">=</span> <span class="n">phrase_matcher_attr</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The list of rules used by the MedspacyMatcher.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of rules, all of which inherit from BaseRule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rule_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BaseRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The dictionary mapping a rule&#39;s id to the rule object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary mapping the rule&#39;s id to the rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The set of labels available to the matcher.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A set of labels containing the labels for all the rules added to the matcher.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseRule</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a collection of rules to the matcher. Rules must inherit from `medspacy.common.BaseRule`.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A collection of rules. Each rule must inherit from `medspacy.common.BaseRule`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">BaseRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must inherit from medspacy.common.BaseRule.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
            <span class="n">rule_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">_rule_id</span> <span class="o">=</span> <span class="n">rule_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># If it&#39;s a string, add a RegEx</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">],</span> <span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">)</span>
                <span class="c1"># If it&#39;s a list, add a pattern dictionary</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">],</span> <span class="n">on_match</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The pattern argument must be either a string or a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher_attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
                    <span class="c1"># only lowercase when the phrase matcher is looking for lowercase matches.</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">literal</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># otherwise, expect users to handle phrases as aligned with their non-default phrase matching scheme</span>
                    <span class="c1"># this prevents .lower() from blocking matches on attrs like ORTH or UPPER</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">literal</span>
                <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">rule_id</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">doc</span><span class="p">],</span>
                    <span class="n">on_match</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call MedspacyMatcher on a doc and return a single list of matches. If self.prune is True,</span>
<span class="sd">        in the case of overlapping matches the longest will be returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tuples, each containing 3 ints representing the individual match (match_id, start, end).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">prune_overlapping_matches</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">labels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The set of labels available to the matcher.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Set">Set</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A set of labels containing the labels for all the rules added to the matcher.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.rule_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rule_map</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The dictionary mapping a rule's id to the rule object.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary mapping the rule's id to the rule.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The list of rules used by the MedspacyMatcher.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of rules, all of which inherit from BaseRule.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call MedspacyMatcher on a doc and return a single list of matches. If self.prune is True,
in the case of overlapping matches the longest will be returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tuples, each containing 3 ints representing the individual match (match_id, start, end).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/medspacy_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call MedspacyMatcher on a doc and return a single list of matches. If self.prune is True,</span>
<span class="sd">    in the case of overlapping matches the longest will be returned.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples, each containing 3 ints representing the individual match (match_id, start, end).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">matches</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">prune_overlapping_matches</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_matcher&#39;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a MedspacyMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy Language model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_matcher&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phrase_matcher_attr</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attribute to use for spaCy's PhraseMatcher. Default is 'LOWER'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;LOWER&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune matches that overlap or are substrings of another match. For example, if "no history
of" and "history of" are both matches, setting prune to True would drop "history of". Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/medspacy_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_matcher&quot;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span> <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a MedspacyMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A spaCy Language model.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        phrase_matcher_attr: The attribute to use for spaCy&#39;s PhraseMatcher. Default is &#39;LOWER&#39;.</span>
<span class="sd">        prune: Whether to prune matches that overlap or are substrings of another match. For example, if &quot;no history</span>
<span class="sd">            of&quot; and &quot;history of&quot; are both matches, setting prune to True would drop &quot;history of&quot;. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span> <span class="c1"># preserve only the tokenizer for creating phrasematcher rules</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rule_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span> <span class="o">=</span> <span class="n">prune</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">Matcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span> <span class="o">=</span> <span class="n">PhraseMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span> <span class="o">=</span> <span class="n">RegexMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher_attr</span> <span class="o">=</span> <span class="n">phrase_matcher_attr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.common.medspacy_matcher.MedspacyMatcher.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds a collection of rules to the matcher. Rules must inherit from <code>medspacy.common.BaseRule</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of rules. Each rule must inherit from <code>medspacy.common.BaseRule</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/medspacy_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">BaseRule</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a collection of rules to the matcher. Rules must inherit from `medspacy.common.BaseRule`.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A collection of rules. Each rule must inherit from `medspacy.common.BaseRule`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">BaseRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must inherit from medspacy.common.BaseRule.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
        <span class="n">rule_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">rule</span><span class="o">.</span><span class="n">_rule_id</span> <span class="o">=</span> <span class="n">rule_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_map</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If it&#39;s a string, add a RegEx</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__regex_matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">],</span> <span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">)</span>
            <span class="c1"># If it&#39;s a list, add a pattern dictionary</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">],</span> <span class="n">on_match</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The pattern argument must be either a string or a list, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher_attr</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lower&quot;</span><span class="p">:</span>
                <span class="c1"># only lowercase when the phrase matcher is looking for lowercase matches.</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">literal</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># otherwise, expect users to handle phrases as aligned with their non-default phrase matching scheme</span>
                <span class="c1"># this prevents .lower() from blocking matches on attrs like ORTH or UPPER</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">literal</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__phrase_matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">rule_id</span><span class="p">,</span>
                <span class="p">[</span><span class="n">doc</span><span class="p">],</span>
                <span class="n">on_match</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">on_match</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rule_count</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.common.regex_matcher" class="doc doc-heading">
            <code>regex_matcher</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.common.regex_matcher.RegexMatcher" class="doc doc-heading">
            <code>RegexMatcher</code>


</h4>


    <div class="doc doc-contents ">


        <p>The RegexMatcher is an alternative to spaCy's native Matcher and PhraseMatcher classes and allows matching based on
typical regular expressions over the underlying doc text rather than spacy token attributes.</p>
<p>This can be useful for allowing more traditional text matching methods, but can lead to issues if the matched spans
in the text do not line up with spacy token boundaries. In this case, the RegexMatcher will by default resolve to
the nearest token  boundaries by expanding to the left and right. This behavior can be configured using
<code>resolve_start</code> and <code>resolve_end</code>. To avoid this, consider using a list of dicts, such as in a spacy Matcher.
For more information, see: https://spacy.io/usage/rule-based-matching</p>
<p>Examples of resolve_start/resolve_end:
In the string 'SERVICE: Radiology' the pattern 'ICE: Rad' would match in the middle of the tokens
'SERVICE' and 'RADIOLOGY'. SpaCy would normally return None. The RegexMatcher will expand in the following ways:
resolve_start='left': The resulting span will start at 'SERVICE' -&gt; 'SERVICE: Radiology'
resolve_start='right': The resulting span will start at ':' -&gt; ': Radiology'
resolve_end='left': The resulting span will end at ':': -&gt; 'SERVICE:'
resolve_end='right': The resulting span will end at 'RADIOLOGY' -&gt; 'SERVICE: Radiology'</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/common/regex_matcher.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RegexMatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The RegexMatcher is an alternative to spaCy&#39;s native Matcher and PhraseMatcher classes and allows matching based on</span>
<span class="sd">    typical regular expressions over the underlying doc text rather than spacy token attributes.</span>

<span class="sd">    This can be useful for allowing more traditional text matching methods, but can lead to issues if the matched spans</span>
<span class="sd">    in the text do not line up with spacy token boundaries. In this case, the RegexMatcher will by default resolve to</span>
<span class="sd">    the nearest token  boundaries by expanding to the left and right. This behavior can be configured using</span>
<span class="sd">    `resolve_start` and `resolve_end`. To avoid this, consider using a list of dicts, such as in a spacy Matcher.</span>
<span class="sd">    For more information, see: https://spacy.io/usage/rule-based-matching</span>

<span class="sd">    Examples of resolve_start/resolve_end:</span>
<span class="sd">    In the string &#39;SERVICE: Radiology&#39; the pattern &#39;ICE: Rad&#39; would match in the middle of the tokens</span>
<span class="sd">    &#39;SERVICE&#39; and &#39;RADIOLOGY&#39;. SpaCy would normally return None. The RegexMatcher will expand in the following ways:</span>
<span class="sd">    resolve_start=&#39;left&#39;: The resulting span will start at &#39;SERVICE&#39; -&gt; &#39;SERVICE: Radiology&#39;</span>
<span class="sd">    resolve_start=&#39;right&#39;: The resulting span will start at &#39;:&#39; -&gt; &#39;: Radiology&#39;</span>
<span class="sd">    resolve_end=&#39;left&#39;: The resulting span will end at &#39;:&#39;: -&gt; &#39;SERVICE:&#39;</span>
<span class="sd">    resolve_end=&#39;right&#39;: The resulting span will end at &#39;RADIOLOGY&#39; -&gt; &#39;SERVICE: Radiology&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vocab</span><span class="p">:</span> <span class="n">Vocab</span><span class="p">,</span>
        <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
        <span class="n">resolve_start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">resolve_end</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new RegexMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            vocab: A spaCy model vocabulary</span>
<span class="sd">            flags: Regular expression flag. Default re.IGNORECASE</span>
<span class="sd">            resolve_start: How to resolve if the start character index of a match does not align with spacy token</span>
<span class="sd">                boundaries. If &#39;left&#39;, will find the nearest token boundary to the left of the unmatched character</span>
<span class="sd">                index, leading to a longer than expected span. If &#39;right&#39;, will find the nearest token boundary to the</span>
<span class="sd">                right of the unmatched character index, leading to a shorter than expected span.  Default &#39;left&#39;.</span>
<span class="sd">            resolve_end: How to resolve if the end character index of a match does not align with spacy token</span>
<span class="sd">                boundaries. If &#39;left&#39;, will find the nearest token boundary to the left of the unmatched character</span>
<span class="sd">                index, leading to a shorter than expected span. If &#39;right&#39;, will find the nearest token boundary to the</span>
<span class="sd">                right of the unmatched character index, leading to a longer than expected span. Default &#39;right&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolve_start</span> <span class="o">=</span> <span class="n">resolve_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolve_end</span> <span class="o">=</span> <span class="n">resolve_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_item_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">match_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">regex_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a rule with one or more regex patterns to one match id.</span>

<span class="sd">        Args:</span>
<span class="sd">            match_id: The name of the pattern.</span>
<span class="sd">            regex_rules: The list of regex strings to associate with `match_id`.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># i am not sure if these warnings are more annoying than useful.</span>
        <span class="c1"># warnings.warn(</span>
        <span class="c1">#     &quot;You are using a TargetRule with a regex pattern, which is not &quot;</span>
        <span class="c1">#     &quot;natively supported in spacy and may lead to unexpected match spans. &quot;</span>
        <span class="c1">#     &quot;Consider using a list of dicts pattern instead. &quot;</span>
        <span class="c1">#     &quot;See https://spacy.io/usage/rule-based-matching&quot;,</span>
        <span class="c1">#     RuntimeWarning,</span>
        <span class="c1"># )</span>
        <span class="k">if</span> <span class="n">match_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">],</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">regex_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span> <span class="o">=</span> <span class="n">on_match</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">[])</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the RegexMatcher on a spaCy Doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of match tuples (match_id, start, end).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
                <span class="n">on_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">re_match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">):</span>
                    <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">char_span</span><span class="p">(</span><span class="n">re_match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">re_match</span><span class="o">.</span><span class="n">end</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">get_token_for_char</span><span class="p">(</span>
                            <span class="n">doc</span><span class="p">,</span> <span class="n">re_match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">resolve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_start</span>
                        <span class="p">)</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">get_token_for_char</span><span class="p">(</span>
                            <span class="n">doc</span><span class="p">,</span> <span class="n">re_match</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">resolve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_end</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">end_index</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">i</span>
                        <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="o">.</span><span class="n">i</span> <span class="p">:</span> <span class="n">end_index</span><span class="p">]</span>
                    <span class="c1"># If it&#39;s an empty span, then that means that the token resolution</span>
                    <span class="c1"># must have resulted in no tokens being included.</span>
                    <span class="c1"># Don&#39;t add the match</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
                        <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                    <span class="c1"># If a callback function was defined,</span>
                    <span class="c1"># call it according to the spaCy API:</span>
                    <span class="c1"># https://spacy.io/usage/rule-based-matching#on_match</span>
                    <span class="k">if</span> <span class="n">on_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">on_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.common.regex_matcher.RegexMatcher.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call the RegexMatcher on a spaCy Doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of match tuples (match_id, start, end).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/regex_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the RegexMatcher on a spaCy Doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of match tuples (match_id, start, end).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">patterns</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
            <span class="n">on_match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">re_match</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">):</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">char_span</span><span class="p">(</span><span class="n">re_match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">re_match</span><span class="o">.</span><span class="n">end</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">get_token_for_char</span><span class="p">(</span>
                        <span class="n">doc</span><span class="p">,</span> <span class="n">re_match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">resolve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_start</span>
                    <span class="p">)</span>
                    <span class="n">end</span> <span class="o">=</span> <span class="n">get_token_for_char</span><span class="p">(</span>
                        <span class="n">doc</span><span class="p">,</span> <span class="n">re_match</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">resolve</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolve_end</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">end_index</span> <span class="o">=</span> <span class="n">end</span><span class="o">.</span><span class="n">i</span>
                    <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="o">.</span><span class="n">i</span> <span class="p">:</span> <span class="n">end_index</span><span class="p">]</span>
                <span class="c1"># If it&#39;s an empty span, then that means that the token resolution</span>
                <span class="c1"># must have resulted in no tokens being included.</span>
                <span class="c1"># Don&#39;t add the match</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
                    <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
                <span class="c1"># If a callback function was defined,</span>
                <span class="c1"># call it according to the spaCy API:</span>
                <span class="c1"># https://spacy.io/usage/rule-based-matching#on_match</span>
                <span class="k">if</span> <span class="n">on_match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">on_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matches</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.common.regex_matcher.RegexMatcher.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span> <span class="n">resolve_start</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">resolve_end</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new RegexMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vocab</code>
            </td>
            <td>
                  <code><span title="spacy.Vocab">Vocab</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy model vocabulary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flags</code>
            </td>
            <td>
                  <code><span title="re.RegexFlag">RegexFlag</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Regular expression flag. Default re.IGNORECASE</p>
              </div>
            </td>
            <td>
                  <code><span title="re.IGNORECASE">IGNORECASE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolve_start</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to resolve if the start character index of a match does not align with spacy token
boundaries. If 'left', will find the nearest token boundary to the left of the unmatched character
index, leading to a longer than expected span. If 'right', will find the nearest token boundary to the
right of the unmatched character index, leading to a shorter than expected span.  Default 'left'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;left&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolve_end</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to resolve if the end character index of a match does not align with spacy token
boundaries. If 'left', will find the nearest token boundary to the left of the unmatched character
index, leading to a shorter than expected span. If 'right', will find the nearest token boundary to the
right of the unmatched character index, leading to a longer than expected span. Default 'right'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;right&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/regex_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">vocab</span><span class="p">:</span> <span class="n">Vocab</span><span class="p">,</span>
    <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
    <span class="n">resolve_start</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
    <span class="n">resolve_end</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new RegexMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        vocab: A spaCy model vocabulary</span>
<span class="sd">        flags: Regular expression flag. Default re.IGNORECASE</span>
<span class="sd">        resolve_start: How to resolve if the start character index of a match does not align with spacy token</span>
<span class="sd">            boundaries. If &#39;left&#39;, will find the nearest token boundary to the left of the unmatched character</span>
<span class="sd">            index, leading to a longer than expected span. If &#39;right&#39;, will find the nearest token boundary to the</span>
<span class="sd">            right of the unmatched character index, leading to a shorter than expected span.  Default &#39;left&#39;.</span>
<span class="sd">        resolve_end: How to resolve if the end character index of a match does not align with spacy token</span>
<span class="sd">            boundaries. If &#39;left&#39;, will find the nearest token boundary to the left of the unmatched character</span>
<span class="sd">            index, leading to a shorter than expected span. If &#39;right&#39;, will find the nearest token boundary to the</span>
<span class="sd">            right of the unmatched character index, leading to a longer than expected span. Default &#39;right&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolve_start</span> <span class="o">=</span> <span class="n">resolve_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolve_end</span> <span class="o">=</span> <span class="n">resolve_end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rule_item_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.common.regex_matcher.RegexMatcher.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">regex_rules</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Add a rule with one or more regex patterns to one match id.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>match_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the pattern.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex_rules</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of regex strings to associate with <code>match_id</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/regex_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">match_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">regex_rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a rule with one or more regex patterns to one match id.</span>

<span class="sd">    Args:</span>
<span class="sd">        match_id: The name of the pattern.</span>
<span class="sd">        regex_rules: The list of regex strings to associate with `match_id`.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># i am not sure if these warnings are more annoying than useful.</span>
    <span class="c1"># warnings.warn(</span>
    <span class="c1">#     &quot;You are using a TargetRule with a regex pattern, which is not &quot;</span>
    <span class="c1">#     &quot;natively supported in spacy and may lead to unexpected match spans. &quot;</span>
    <span class="c1">#     &quot;Consider using a list of dicts pattern instead. &quot;</span>
    <span class="c1">#     &quot;See https://spacy.io/usage/rule-based-matching&quot;,</span>
    <span class="c1">#     RuntimeWarning,</span>
    <span class="c1"># )</span>
    <span class="k">if</span> <span class="n">match_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">match_id</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">],</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">regex_rules</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_patterns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span> <span class="o">=</span> <span class="n">on_match</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.common.util" class="doc doc-heading">
            <code>util</code>


</h3>

    <div class="doc doc-contents ">

        <p>This module will contain helper functions and classes for common clinical processing tasks
which will be used in medspaCy's matcher objects.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.common.util.get_token_for_char" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_token_for_char</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">char_idx</span><span class="p">,</span> <span class="n">resolve</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get the token index that best matches a particular character index. Because regex find returns a character index and
spaCy matches must align with token boundaries, each character index must be converted into a token index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to search in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>char_idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The character index to find the corresponding token for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolve</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution type. "left" will snap character to the token index to the left which precede the</p>
              </div>
            </td>
            <td>
                  <code>&#39;left&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="spacy.tokens.Token">Token</span>, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token that best fits the character index based on the resolution type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_token_for_char</span><span class="p">(</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">char_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">resolve</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Token</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the token index that best matches a particular character index. Because regex find returns a character index and</span>
<span class="sd">    spaCy matches must align with token boundaries, each character index must be converted into a token index.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to search in.</span>
<span class="sd">        char_idx: The character index to find the corresponding token for.</span>
<span class="sd">        resolve: The resolution type. &quot;left&quot; will snap character to the token index to the left which precede the</span>
<span class="sd">        `char_idx`. &quot;right&quot; will snap character to the token index to the right, which follows the `char_idx`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The token that best fits the character index based on the resolution type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">char_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;char_idx must be &gt; 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">char_idx</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;char_idx </span><span class="si">{0}</span><span class="s2"> is out of range for text with length </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">char_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">char_idx</span> <span class="o">&gt;</span> <span class="n">token</span><span class="o">.</span><span class="n">idx</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">char_idx</span> <span class="o">==</span> <span class="n">token</span><span class="o">.</span><span class="n">idx</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">token</span>
        <span class="k">if</span> <span class="n">char_idx</span> <span class="o">&lt;</span> <span class="n">token</span><span class="o">.</span><span class="n">idx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resolve</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">resolve</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;resolve must be either &#39;left&#39; or &#39;right&#39;&quot;</span><span class="p">)</span>
    <span class="c1"># Otherwise, we&#39;ve reached the end of the doc, so this must be the final token</span>
    <span class="c1"># If resolving to the left, return the final token</span>
    <span class="c1"># If resolving to the right, return None, meaning it should go to the end of the doc</span>
    <span class="k">if</span> <span class="n">resolve</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">resolve</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.common.util.matches_to_spans" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">matches_to_spans</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">set_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts all identified matches to spans.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy doc corresponding to the matches.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>matches</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of match Tuples (match_id, start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>set_label</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to assign a label to the span based off the source rule. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of spacy spans corresponding to the input matches.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">matches_to_spans</span><span class="p">(</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">set_label</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts all identified matches to spans.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy doc corresponding to the matches.</span>
<span class="sd">        matches: The list of match Tuples (match_id, start, end).</span>
<span class="sd">        set_label: Whether to assign a label to the span based off the source rule. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of spacy spans corresponding to the input matches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">set_label</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Span</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">spans</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.common.util.overlaps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">overlaps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks whether two match Tuples out of spacy matchers overlap.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A match Tuple (match_id, start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A match Tuple (match_id, start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the tuples overlap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">overlaps</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether two match Tuples out of spacy matchers overlap.</span>

<span class="sd">    Args:</span>
<span class="sd">        a: A match Tuple (match_id, start, end).</span>
<span class="sd">        b: A match Tuple (match_id, start, end).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the tuples overlap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">b_start</span><span class="p">,</span> <span class="n">b_end</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">tuple_overlaps</span><span class="p">((</span><span class="n">a_start</span><span class="p">,</span> <span class="n">a_end</span><span class="p">),</span> <span class="p">(</span><span class="n">b_start</span><span class="p">,</span> <span class="n">b_end</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.common.util.prune_overlapping_matches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prune_overlapping_matches</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;longest&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Prunes overlapping matches from a list of spaCy match tuples (match_id, start, end).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>matches</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of match tuples of form (match_id, start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strategy</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pruning strategy to use. At this time, the only available option is "longest" and will keep the
longest of any two overlapping spans. Other behavior will be added in a future update.</p>
              </div>
            </td>
            <td>
                  <code>&#39;longest&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pruned list of matches.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prune_overlapping_matches</span><span class="p">(</span>
    <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;longest&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prunes overlapping matches from a list of spaCy match tuples (match_id, start, end).</span>

<span class="sd">    Args:</span>
<span class="sd">        matches: A list of match tuples of form (match_id, start, end).</span>
<span class="sd">        strategy: The pruning strategy to use. At this time, the only available option is &quot;longest&quot; and will keep the</span>
<span class="sd">            longest of any two overlapping spans. Other behavior will be added in a future update.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The pruned list of matches.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">strategy</span> <span class="o">!=</span> <span class="s2">&quot;longest&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;No other filtering strategy has been implemented. Coming in a future update.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Make a copy and sort</span>
    <span class="n">unpruned</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">pruned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_matches</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matches</span>
    <span class="n">curr_match</span> <span class="o">=</span> <span class="n">unpruned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unpruned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pruned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_match</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">next_match</span> <span class="o">=</span> <span class="n">unpruned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Check if they overlap</span>
        <span class="k">if</span> <span class="n">overlaps</span><span class="p">(</span><span class="n">curr_match</span><span class="p">,</span> <span class="n">next_match</span><span class="p">):</span>
            <span class="c1"># Choose the larger span</span>
            <span class="n">longer_span</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">curr_match</span><span class="p">,</span> <span class="n">next_match</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">pruned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">longer_span</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unpruned</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">curr_match</span> <span class="o">=</span> <span class="n">unpruned</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pruned</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curr_match</span><span class="p">)</span>
            <span class="n">curr_match</span> <span class="o">=</span> <span class="n">next_match</span>
    <span class="c1"># Recursive base point</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pruned</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_matches</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pruned</span>
    <span class="c1"># Recursive function call</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prune_overlapping_matches</span><span class="p">(</span><span class="n">pruned</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.common.util.span_contains" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_contains</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">case_insensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return True if a Span object contains a target phrase.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="spacy.tokens.Doc">Doc</span>, <span title="spacy.tokens.Span">Span</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy Doc or Span, such as an entity in doc.ents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A target phrase or iterable of phrases to check in span.text.lower().</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to search the span using a regular expression rather than
a literal string. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_insensitive</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the matching is case-insensitive. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/common/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">span_contains</span><span class="p">(</span>
    <span class="n">span</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span>
    <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">regex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">case_insensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return True if a Span object contains a target phrase.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: A spaCy Doc or Span, such as an entity in doc.ents</span>
<span class="sd">        target: A target phrase or iterable of phrases to check in span.text.lower().</span>
<span class="sd">        regex: Whether to search the span using a regular expression rather than</span>
<span class="sd">            a literal string. Default is True.</span>
<span class="sd">        case_insensitive: Whether the matching is case-insensitive. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">regex</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">case_insensitive</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">case_insensitive</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">text</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># If it&#39;s an iterable, check if any of the strings are in sent</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">func</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.context" class="doc doc-heading">
            <code>context</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.context.ConText" class="doc doc-heading">
            <code>ConText</code>


</h3>


    <div class="doc doc-contents ">


        <p>The ConText for spaCy processing.</p>
<p>This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.
Sets two spaCy extensions:
        - Span.<em>.modifiers: a list of ConTextModifier objects which modify a target Span
        - Doc.</em>.context_graph: a ConText graph object which contains the targets,
            modifiers, and edges between them.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_context&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConText for spaCy processing.</span>

<span class="sd">    This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.</span>
<span class="sd">    Sets two spaCy extensions:</span>
<span class="sd">            - Span._.modifiers: a list of ConTextModifier objects which modify a target Span</span>
<span class="sd">            - Doc._.context_graph: a ConText graph object which contains the targets,</span>
<span class="sd">                modifiers, and edges between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConText object.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A SpaCy Language object.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">                original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">                None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">                directly through `ConText.add`.</span>
<span class="sd">            language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">                and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">                Default is &quot;en&quot; for English.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">                terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">                ContextRule object.</span>
<span class="sd">            max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">                Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">                Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">                all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">                be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">                will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">                ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">                afib. Default True.</span>
<span class="sd">            prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">                False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">                targets in its scope. Default False.</span>
<span class="sd">            span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">                `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">                containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">                modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">                in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
            <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of ConTextRules available to context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of categories available that Context might produce.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds ConTextRules to Context.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
            <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Check custom termination points</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The edges of the ContextGraph to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the ConText algorithm to a Doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>
<span class="sd">            targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed spaCy Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># Store data in ConTextGraph object</span>
        <span class="c1"># TODO: move some of this over to ConTextGraph</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
            <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
        <span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="c1"># Get the ConTextRule object defining this modifier</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
            <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

        <span class="c1"># Link targets to their modifiers</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

        <span class="c1"># If attributes need to be modified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConText.categories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">categories</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns list of categories available that Context might produce.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConText.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConText.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns list of ConTextRules available to context.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConText.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Applies the ConText algorithm to a Doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed spaCy Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the ConText algorithm to a Doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>
<span class="sd">        targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed spaCy Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="c1"># Store data in ConTextGraph object</span>
    <span class="c1"># TODO: move some of this over to ConTextGraph</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
        <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
    <span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="c1"># Get the ConTextRule object defining this modifier</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
    <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

    <span class="c1"># Link targets to their modifiers</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

    <span class="c1"># If attributes need to be modified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_context&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminating_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prune_on_target_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span_attrs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">input_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a new ConText object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.language.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SpaCy Language object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_context&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rules to load. Default is "default", loads rules packaged with medspaCy that are derived from
original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If
None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules
directly through <code>ConText.add</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language_code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language code to use (ISO code) as a default for loading resources.  See documentation
and also the /resources directory to see which resources might be available in each language.
Default is "en" for English.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phrase_matcher_attr</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token attribute to use for PhraseMatcher for rules where <code>pattern</code> is None. Default
is 'LOWER'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;LOWER&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types included by context. Rules will operate on only spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types excluded by context. Rules will not operate on spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminating_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Iterable">Iterable</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global map of types to the types that can terminate them. This can be used to apply
terminations to all rules of a particular type rather than adding to every rule individually in the
ContextRule object.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens around a modifier in a target can be modified. Default value is None,
Context will use the sentence boundaries. If a value greater than zero, applies the window globally.
Both options will be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets a modifier can modify. Default value is None, context will modify
all targets in its scope. If a value greater than zero, applies this value globally. Both options will
be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers which are substrings of another modifier. If True,
will drop substrings completely. For example, if "no history of"  and "history of" are both
ConTextRules,both will match the text "no history of afib", but only "no  history of" should modify
afib. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_target_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to remove any matched modifiers which overlap with target entities. If
False, any overlapping modifiers will not modify the overlapping entity but will still modify any other
targets in its scope. Default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_attrs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;default&#39;], <span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional span attributes to modify. Default option "default" uses attributes in
<code>DEFAULT_ATTRIBUTES</code>. If a dictionary, format is mapping context modifier categories to a dictionary
containing the attribute name and the value to set the attribute to when a  span is modified by a
modifier of that category. If None, no attributes will be modified.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_span_type</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"ents" or "group". Where to look for targets. "ents" will modify attributes of spans
in doc.ents. "group" will modify attributes of spans in the span group specified by <code>span_group_name</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the span group used when <code>input_span_type</code> is "group". Default is
"medspacy_spans".</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConText object.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A SpaCy Language object.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">            original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">            None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">            directly through `ConText.add`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">            terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">            ContextRule object.</span>
<span class="sd">        max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">            Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">            Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">            all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">            be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">            will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">            ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">            afib. Default True.</span>
<span class="sd">        prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">            False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">            targets in its scope. Default False.</span>
<span class="sd">        span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">            `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">            containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">            modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">            in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
        <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

    <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds ConTextRules to Context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds ConTextRules to Context.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
        <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Check custom termination points</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.register_default_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_default_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Registers the default values for the Span attributes defined in <code>DEFAULT_ATTRIBUTES</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.register_graph_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_graph_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Registers spaCy attribute extensions: Span.<em>.modifiers and Doc.</em>.context_graph.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConText.set_context_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds Span-level attributes to targets with modifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edges of the ContextGraph to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: The edges of the ContextGraph to modify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.context.ConTextGraph" class="doc doc-heading">
            <code>ConTextGraph</code>


</h3>


    <div class="doc doc-contents ">


        <p>The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,
matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</p>
<p>Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of
of the graph.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,</span>
<span class="sd">    matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</span>

<span class="sd">    Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of</span>
<span class="sd">    of the graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConTextGraph object.</span>

<span class="sd">        Args:</span>
<span class="sd">            targets: A spans that context might modify.</span>
<span class="sd">            modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">            edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the scope of all ConTextModifier.</span>

<span class="sd">        For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">        modifier to see if one of the modifiers should update the other.</span>
<span class="sd">        This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">        scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
                <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
                <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
                <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">        create an edge between them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># Now do a second pass and reduce the number of targets</span>
        <span class="c1"># for any modifiers with a max_targets int</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextGraph&gt; with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span><span class="si">}</span><span class="s2"> targets and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span><span class="si">}</span><span class="s2"> modifiers&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the serialized representation of the ConTextGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the ConTextGraph from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextGraph.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a new ConTextGraph object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spans that context might modify.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modifiers</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.ConTextModifier" href="#medspacy.context.ConTextModifier">ConTextModifier</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextModifiers that might modify the targets.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of edges between targets and modifiers representing the modification relationship.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers when one modifier completely covers another.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConTextGraph object.</span>

<span class="sd">    Args:</span>
<span class="sd">        targets: A spans that context might modify.</span>
<span class="sd">        modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">        edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextGraph.apply_modifiers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_modifiers</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks each target/modifier pair. If modifier modifies target,
create an edge between them.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">    create an edge between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># Now do a second pass and reduce the number of targets</span>
    <span class="c1"># for any modifiers with a max_targets int</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextGraph.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Creates the ConTextGraph from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the ConTextGraph from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextGraph.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the serialized representation of the ConTextGraph</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the serialized representation of the ConTextGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextGraph.update_scopes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scopes</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Update the scope of all ConTextModifier.</p>
<p>For each modifier in a list of ConTextModifiers, check against each other
modifier to see if one of the modifiers should update the other.
This allows neighboring similar modifiers to extend each other's
scope and allows "terminate" modifiers to end a modifier's scope.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the scope of all ConTextModifier.</span>

<span class="sd">    For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">    modifier to see if one of the modifiers should update the other.</span>
<span class="sd">    This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">    scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
            <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
            <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
            <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.context.ConTextModifier" class="doc doc-heading">
            <code>ConTextModifier</code>


</h3>


    <div class="doc doc-contents ">


        <p>Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching
text in a Doc.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching</span>
<span class="sd">    text in a Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
        <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">        window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">        this ConTextModifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">            start: The start token index.</span>
<span class="sd">            end: The end token index (non-inclusive).</span>
<span class="sd">            doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">                maintained.</span>
<span class="sd">            scope_start: The start token index of the scope.</span>
<span class="sd">            scope_end: The end index of the scope.</span>
<span class="sd">            max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifier_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The spaCy Span object, which is a view of self.doc, covered by this match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rule</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated context rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">direction</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scope_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allowed_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated allowed types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">allowed_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">excluded_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated excluded types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">excluded_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">        self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">        self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">        direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">        If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">        reduced to self.max_scope.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy doc to use to set scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
                <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">)</span>
        <span class="c1"># Otherwise, use the sentence</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
            <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                    <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                    <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Set the max scope on either side</span>
            <span class="c1"># Backwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="c1"># Forwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the scope of self to be the given spaCy span.</span>

<span class="sd">        Args:</span>
<span class="sd">            span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">        to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">        modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">        &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">        CHF, but there is pneumonia&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            other: The modifier to check against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the other modifier modified the scope of self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check if the other modifier is a type which can modify self</span>
        <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If two modifiers have the same category but modify different target types,</span>
        <span class="c1"># don&#39;t limit scope.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: a spaCy span representing a target concept.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
        <span class="c1"># one extracted as both a target and modifier, return False</span>
        <span class="c1"># to avoid self-modifying concepts</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_label: The target type to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">            `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">        either True or False.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to evaluate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Find the span in between the target and modifier</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
                <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">rslt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">        `self.max_targets` is None, no pruning is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
            <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
        <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextModifier&gt; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialized Representation of the modifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

        <span class="k">return</span> <span class="n">dict_repr</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the class from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.allowed_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allowed_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated allowed types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">category</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated category.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.direction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">direction</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated direction.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.excluded_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">excluded_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated excluded types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.max_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_scope</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum scope.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.max_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.modifier_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifier_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The spaCy Span object, which is a view of self.doc, covered by this match.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.num_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.rule" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated context rule.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.context.ConTextModifier.scope_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the associated scope.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">context_rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">scope_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding
window. Spans such as entities or other members of span groups that occur within this window can be modified by
this ConTextModifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context_rule</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule object which defines the modifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end token index (non-inclusive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc which contains this span. This is needed to initialize the modifier but is not
maintained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_start</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use scope values rather than sentence boundaries for modifications.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
    <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">    window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">    this ConTextModifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">        start: The start token index.</span>
<span class="sd">        end: The end token index (non-inclusive).</span>
<span class="sd">        doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">            maintained.</span>
<span class="sd">        scope_start: The start token index of the scope.</span>
<span class="sd">        scope_end: The end index of the scope.</span>
<span class="sd">        max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.__set_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If
self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by
self.direction. For example, if the direction is "forward", the scope will be [self.end: sentence.end]. If the
direction is "backward", it will be [self.start: sentence.start].</p>
<p>If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be
reduced to self.max_scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy doc to use to set scope.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">    self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">    self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">    direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">    If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">    reduced to self.max_scope.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy doc to use to set scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">)</span>
    <span class="c1"># Otherwise, use the sentence</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
        <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Set the max scope on either side</span>
        <span class="c1"># Backwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="c1"># Forwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.allows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allows</span><span class="p">(</span><span class="n">target_label</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether if a modifier is able to modify a target type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_label</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target type to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the modifier is allowed to modify a target of the specified type. True if <code>target_label</code> in</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>self.allowed_types</code> or if <code>target_label</code> not in <code>self.excluded_tupes</code>. False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_label: The target type to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">        `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Instantiates the class from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the class from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.limit_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">limit_scope</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>If self and other have the same category or if other has a directionality of 'terminate', use the span of other
to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of
modifiers. For example, in 'no evidence of CHF, no pneumonia', 'pneumonia' will only be modified by 'no', not
'no evidence of'. 'terminate' modifiers limit the scope of a modifier like 'no evidence of' in 'no evidence of
CHF, but there is pneumonia'</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_modifier.ConTextModifier" href="#medspacy.context.context_modifier.ConTextModifier">ConTextModifier</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modifier to check against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the other modifier modified the scope of self.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">    to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">    modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">    &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">    CHF, but there is pneumonia&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        other: The modifier to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the other modifier modified the scope of self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check if the other modifier is a type which can modify self</span>
    <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># If two modifiers have the same category but modify different target types,</span>
    <span class="c1"># don&#39;t limit scope.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks whether the target is within the modifier scope and if self is allowed to modify target.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy span representing a target concept.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the target is within <code>modifier_scope</code> and if self is allowed to modify the target.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: a spaCy span representing a target concept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
    <span class="c1"># one extracted as both a target and modifier, return False</span>
    <span class="c1"># to avoid self-modifying concepts</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
    <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.modify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add target to the list of self._targets and increment self._num_targets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.on_modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>If the ConTextRule used to define a ConTextModifier has an <code>on_modifies</code> callback function, evaluate and return
either True or False.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the <code>on_modifies</code> callback for the rule. True if the callback is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">    either True or False.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to evaluate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Find the span in between the target and modifier</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
            <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">rslt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.reduce_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_targets</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Reduces the number of targets to the n-closest targets based on the value of <code>self.max_targets</code>. If
<code>self.max_targets</code> is None, no pruning is done.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">    `self.max_targets` is None, no pruning is done.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
        <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
    <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Serialized Representation of the modifier</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialized Representation of the modifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="k">return</span> <span class="n">dict_repr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextModifier.update_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scope</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Changes the scope of self to be the given spaCy span.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy Span which contains the scope which a modifier should cover.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the scope of self to be the given spaCy span.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.context.ConTextRule" class="doc doc-heading">
            <code>ConTextRule</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers
and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in
the text, and what types of target spans can be modified.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers</span>
<span class="sd">    and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in</span>
<span class="sd">    the text, and what types of target spans can be modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_DIRECTIONS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PSEUDO&quot;</span>
    <span class="p">)</span>
    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ConTextRule object.</span>

<span class="sd">        The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">        semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">        Other arguments specify additional custom logic such as:</span>
<span class="sd">            - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">            - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">            - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">            - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">            terminated_by)</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">                include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">                Valid values are:</span>
<span class="sd">                - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">                - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">                - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">                - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                    &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                    &quot;pneumonia&quot;</span>
<span class="sd">                - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                    superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                    phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                    modifier.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">                specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">                callable should take 3 arguments:</span>
<span class="sd">                    target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                    modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                    span_between: The Span between the target and modifier in question.</span>
<span class="sd">                Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">            allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">                not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">                An error will be thrown if both are not None.</span>
<span class="sd">            excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">                target types unless allowed_types is not None.</span>
<span class="sd">            max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">                include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">                This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">                modifier ranges caused by sentence splitting problems.</span>
<span class="sd">            max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">                its scope.</span>
<span class="sd">            terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">                modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">                terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">                positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">                This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
                <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">                JSONs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of ConTextRules objects read from the JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
            <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">context_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a dictionary into a ConTextRule.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: The dictionary to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ConTextRule created from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dictionary containing the ConTextRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">            Args:</span>
<span class="sd">            context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">            filepath: the .json file to contain modifier rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ConTextRule(literal=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&#39;, category=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;direction=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;BIDIRECTIONAL&#39;</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_modifies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminated_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a ConTextRule object.</p>
<p>The primary arguments of <code>literal</code> <code>category</code>, and <code>direction</code> define the span of text to be matched, the
semantic category, and the direction within the sentence in which the modifier operates.
Other arguments specify additional custom logic such as:
    - Additional control over what text can be matched as a modifier (pattern and on_match)
    - Which types of targets can be modified (allowed_types, excluded_types)
    - The scope size and number of targets that a modifier can modify (max_targets, max_scope)
    - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,
    terminated_by)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directionality or action of a modifier. This defines which part of a sentence a modifier will
include as its scope. Entities within the scope will be considered to be modified.
Valid values are:
- "FORWARD": Scope will begin after the end of a modifier and move to the right
- "BACKWARD": Scope will begin before the beginning of a modifier and move to the left
- "BIDIRECTIONAL": Scope will expand on either side of a modifier
- "TERMINATE": A special direction to limit any other modifiers if this phrase is in its scope. Example:
    "no evidence of chf but there is pneumonia": "but" will prevent "no evidence of" from modifying
    "pneumonia"
- "PSEUDO": A special direction which will not modify any targets. This can be used for differentiating
    superstrings of modifiers. Example: A modifier with literal="negative attitude" will prevent the
    phrase "negative" in "She has a negative attitude about her treatment" from being extracted as a
    modifier.</p>
              </div>
            </td>
            <td>
                  <code>&#39;BIDIRECTIONAL&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_modifies</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>], bool]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callback function to run when building an edge between a target and a modifier. This allows
specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The
callable should take 3 arguments:
    target: The spaCy Span from doc.ents (ie., 'Evidence of pneumonia')
    modifier: The spaCy Span covered in a resulting modifier (ie., 'no evidence of')
    span_between: The Span between the target and modifier in question.
Should return either True or False. If returns False, then the modifier will not modify the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels to allow a modifier to modify. If None, will apply to any type
not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.
An error will be thrown if both are not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels which this modifier cannot modify. If None, will apply to all
target types unless allowed_types is not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number of tokens to explicitly limit the size of the modifier's scope. If None, the scope will
include the entire sentence in the direction of <code>direction</code> and the entire sentence for "BIDIRECTIONAL".
This is useful for requiring modifiers be very close to a concept in the text or for preventing long
modifier ranges caused by sentence splitting problems.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets which a modifier can modify. If None, will modify all targets in
its scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminated_by</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional collection of other modifier categories which will terminate the scope of this
modifier. If None, only "TERMINATE" will do this. Example: if a ConTextRule defining "positive for" has
terminated_by={"NEGATED_EXISTENCE"}, then in the sentence "positive for flu, negative for RSV", the
positive modifier will modify "flu" but will be terminated by "negative for" and will not modify "RSV".
This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a ConTextRule object.</span>

<span class="sd">    The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">    semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">    Other arguments specify additional custom logic such as:</span>
<span class="sd">        - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">        - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">        - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">        - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">        terminated_by)</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">            include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">            Valid values are:</span>
<span class="sd">            - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">            - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">            - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">            - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                &quot;pneumonia&quot;</span>
<span class="sd">            - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                modifier.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">            specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">            callable should take 3 arguments:</span>
<span class="sd">                target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                span_between: The Span between the target and modifier in question.</span>
<span class="sd">            Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">        allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">            not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">            An error will be thrown if both are not None.</span>
<span class="sd">        excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">            target types unless allowed_types is not None.</span>
<span class="sd">        max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">            include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">            This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">            modifier ranges caused by sentence splitting problems.</span>
<span class="sd">        max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">            its scope.</span>
<span class="sd">        terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">            modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">            terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">            positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">            This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
            <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

    <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a ConTextRule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule created from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a dictionary into a ConTextRule.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: The dictionary to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ConTextRule created from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Reads in a lexicon of modifiers from a JSON file under the key <code>context_rules</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The .json file containing modifier rules. Must contain <code>context_rules</code> key containing the rule
JSONs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextRules objects read from the JSON.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">            JSONs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of ConTextRules objects read from the JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
        <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">context_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary containing the ConTextRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary containing the ConTextRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.context.ConTextRule.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">context_rules</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Writes ConTextItems to a json file.</p>
<p>Args:
context_rules: a list of ContextRules that will be written to a file.
filepath: the .json file to contain modifier rules</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">        context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">        filepath: the .json file to contain modifier rules</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="medspacy.context.context" class="doc doc-heading">
            <code>context</code>


</h3>

    <div class="doc doc-contents ">

        <p>The ConText definiton.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.context.context.ConText" class="doc doc-heading">
            <code>ConText</code>


</h4>


    <div class="doc doc-contents ">


        <p>The ConText for spaCy processing.</p>
<p>This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.
Sets two spaCy extensions:
        - Span.<em>.modifiers: a list of ConTextModifier objects which modify a target Span
        - Doc.</em>.context_graph: a ConText graph object which contains the targets,
            modifiers, and edges between them.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_context&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConText for spaCy processing.</span>

<span class="sd">    This component matches modifiers in a Doc, defines their scope, and identifies edges between targets and modifiers.</span>
<span class="sd">    Sets two spaCy extensions:</span>
<span class="sd">            - Span._.modifiers: a list of ConTextModifier objects which modify a target Span</span>
<span class="sd">            - Doc._.context_graph: a ConText graph object which contains the targets,</span>
<span class="sd">                modifiers, and edges between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConText object.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A SpaCy Language object.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">                original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">                None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">                directly through `ConText.add`.</span>
<span class="sd">            language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">                and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">                Default is &quot;en&quot; for English.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">                labels.</span>
<span class="sd">            terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">                terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">                ContextRule object.</span>
<span class="sd">            max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">                Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">                Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">                all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">                be overridden by a more specific value in a ContextRule.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">                will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">                ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">                afib. Default True.</span>
<span class="sd">            prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">                False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">                targets in its scope. Default False.</span>
<span class="sd">            span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">                `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">                containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">                modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">                in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
            <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of ConTextRules available to context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">categories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns list of categories available that Context might produce.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds ConTextRules to Context.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
            <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
                <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
            <span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Check custom termination points</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                    <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">        Args:</span>
<span class="sd">            edges: The edges of the ContextGraph to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the ConText algorithm to a Doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>
<span class="sd">            targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed spaCy Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># Store data in ConTextGraph object</span>
        <span class="c1"># TODO: move some of this over to ConTextGraph</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
            <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
        <span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="c1"># Get the ConTextRule object defining this modifier</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
            <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

        <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

        <span class="c1"># Link targets to their modifiers</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

        <span class="c1"># If attributes need to be modified</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context.ConText.categories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">categories</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns list of categories available that Context might produce.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context.ConText.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context.ConText.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns list of ConTextRules available to context.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context.ConText.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Applies the ConText algorithm to a Doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed spaCy Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the ConText algorithm to a Doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>
<span class="sd">        targets: The optional custom attribute extension on doc to run over. Must contain an iterable of Span objects</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed spaCy Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">targets</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="c1"># Store data in ConTextGraph object</span>
    <span class="c1"># TODO: move some of this over to ConTextGraph</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span>
        <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span>
    <span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="c1"># Get the ConTextRule object defining this modifier</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">[</span><span class="n">match_id</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">]</span>
        <span class="n">modifier</span> <span class="o">=</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span><span class="p">)</span>
        <span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>

    <span class="n">context_graph</span><span class="o">.</span><span class="n">update_scopes</span><span class="p">()</span>
    <span class="n">context_graph</span><span class="o">.</span><span class="n">apply_modifiers</span><span class="p">()</span>

    <span class="c1"># Link targets to their modifiers</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">+=</span> <span class="p">(</span><span class="n">modifier</span><span class="p">,)</span>

    <span class="c1"># If attributes need to be modified</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span> <span class="o">=</span> <span class="n">context_graph</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_context&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminating_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prune_on_target_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">span_attrs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">input_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new ConText object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.language.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A SpaCy Language object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the component.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_context&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The rules to load. Default is "default", loads rules packaged with medspaCy that are derived from
original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If
None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules
directly through <code>ConText.add</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>language_code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Language code to use (ISO code) as a default for loading resources.  See documentation
and also the /resources directory to see which resources might be available in each language.
Default is "en" for English.</p>
              </div>
            </td>
            <td>
                  <code>&#39;en&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phrase_matcher_attr</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token attribute to use for PhraseMatcher for rules where <code>pattern</code> is None. Default
is 'LOWER'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;LOWER&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types included by context. Rules will operate on only spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global list of types excluded by context. Rules will not operate on spans with these
labels.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminating_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Iterable">Iterable</span>[str]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global map of types to the types that can terminate them. This can be used to apply
terminations to all rules of a particular type rather than adding to every rule individually in the
ContextRule object.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens around a modifier in a target can be modified. Default value is None,
Context will use the sentence boundaries. If a value greater than zero, applies the window globally.
Both options will be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets a modifier can modify. Default value is None, context will modify
all targets in its scope. If a value greater than zero, applies this value globally. Both options will
be overridden by a more specific value in a ContextRule.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers which are substrings of another modifier. If True,
will drop substrings completely. For example, if "no history of"  and "history of" are both
ConTextRules,both will match the text "no history of afib", but only "no  history of" should modify
afib. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_target_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to remove any matched modifiers which overlap with target entities. If
False, any overlapping modifiers will not modify the overlapping entity but will still modify any other
targets in its scope. Default False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_attrs</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;default&#39;], <span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional span attributes to modify. Default option "default" uses attributes in
<code>DEFAULT_ATTRIBUTES</code>. If a dictionary, format is mapping context modifier categories to a dictionary
containing the attribute name and the value to set the attribute to when a  span is modified by a
modifier of that category. If None, no attributes will be modified.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_span_type</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"ents" or "group". Where to look for targets. "ents" will modify attributes of spans
in doc.ents. "group" will modify attributes of spans in the span group specified by <code>span_group_name</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the span group used when <code>input_span_type</code> is "group". Default is
"medspacy_spans".</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminating_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">prune_on_target_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConText object.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A SpaCy Language object.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">            original ConText rules and years of practical applications at the US Department of Veterans Affairs.  If</span>
<span class="sd">            None, no rules are loaded. Otherwise, must be a path to a json file containing rules. Add ConTextRules</span>
<span class="sd">            directly through `ConText.add`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        allowed_types: A global list of types included by context. Rules will operate on only spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        excluded_types: A global list of types excluded by context. Rules will not operate on spans with these</span>
<span class="sd">            labels.</span>
<span class="sd">        terminating_types: A global map of types to the types that can terminate them. This can be used to apply</span>
<span class="sd">            terminations to all rules of a particular type rather than adding to every rule individually in the</span>
<span class="sd">            ContextRule object.</span>
<span class="sd">        max_scope: The number of tokens around a modifier in a target can be modified. Default value is None,</span>
<span class="sd">            Context will use the sentence boundaries. If a value greater than zero, applies the window globally.</span>
<span class="sd">            Both options will be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        max_targets: The maximum number of targets a modifier can modify. Default value is None, context will modify</span>
<span class="sd">            all targets in its scope. If a value greater than zero, applies this value globally. Both options will</span>
<span class="sd">            be overridden by a more specific value in a ContextRule.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers which are substrings of another modifier. If True,</span>
<span class="sd">            will drop substrings completely. For example, if &quot;no history of&quot;  and &quot;history of&quot; are both</span>
<span class="sd">            ConTextRules,both will match the text &quot;no history of afib&quot;, but only &quot;no  history of&quot; should modify</span>
<span class="sd">            afib. Default True.</span>
<span class="sd">        prune_on_target_overlap: Whether to remove any matched modifiers which overlap with target entities. If</span>
<span class="sd">            False, any overlapping modifiers will not modify the overlapping entity but will still modify any other</span>
<span class="sd">            targets in its scope. Default False.</span>
<span class="sd">        span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">            `DEFAULT_ATTRIBUTES`. If a dictionary, format is mapping context modifier categories to a dictionary</span>
<span class="sd">            containing the attribute name and the value to set the attribute to when a  span is modified by a</span>
<span class="sd">            modifier of that category. If None, no attributes will be modified.</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for targets. &quot;ents&quot; will modify attributes of spans</span>
<span class="sd">            in doc.ents. &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_target_overlap</span> <span class="o">=</span> <span class="n">prune_on_target_overlap</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;context_rules.json&quot;</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span>
        <span class="n">prune</span><span class="o">=</span><span class="n">prune_on_modifier_overlap</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRIBUTES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_graph_attributes</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">max_scope</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;If &#39;max_scope&#39; must be a value greater than 0, not the current value: </span><span class="si">{</span><span class="n">max_scope</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="n">allowed_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="n">excluded_types</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">terminating_types</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">terminating_types</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

    <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds ConTextRules to Context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds ConTextRules to Context.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single ConTextRule or a collection of ConTextRules to add to the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">ConTextRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rules must type ConTextRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="c1"># If global attributes like allowed_types and max_scope are defined,</span>
        <span class="c1"># check if the ConTextRule has them defined. If not, set to the global</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># No global value set</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>  <span class="c1"># If the direction itself has it defined, don&#39;t override</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Check custom termination points</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">other_modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminating_types</span><span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()]:</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_modifier</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.register_default_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_default_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Registers the default values for the Span attributes defined in <code>DEFAULT_ATTRIBUTES</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.register_graph_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_graph_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Registers spaCy attribute extensions: Span.<em>.modifiers and Doc.</em>.context_graph.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_graph_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registers spaCy attribute extensions: Span._.modifiers and Doc._.context_graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;modifiers&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">Doc</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="s2">&quot;context_graph&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context.ConText.set_context_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_context_attributes</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds Span-level attributes to targets with modifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edges of the ContextGraph to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds Span-level attributes to targets with modifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        edges: The edges of the ContextGraph to modify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">:</span>
            <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_attributes_mapping</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.context.context_graph" class="doc doc-heading">
            <code>context_graph</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.context.context_graph.ConTextGraph" class="doc doc-heading">
            <code>ConTextGraph</code>


</h4>


    <div class="doc doc-contents ">


        <p>The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,
matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</p>
<p>Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of
of the graph.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ConTextGraph class defines the internal structure of the ConText algorithm. It stores a collection of modifiers,</span>
<span class="sd">    matched with ConTextRules, and targets from some other source such as the TargetMatcher or a spaCy NER model.</span>

<span class="sd">    Each modifier can have some number of associated targets that it modifies. This relationship is stored as edges of</span>
<span class="sd">    of the graph.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConTextGraph object.</span>

<span class="sd">        Args:</span>
<span class="sd">            targets: A spans that context might modify.</span>
<span class="sd">            modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">            edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">            prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the scope of all ConTextModifier.</span>

<span class="sd">        For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">        modifier to see if one of the modifiers should update the other.</span>
<span class="sd">        This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">        scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
                <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
                <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
                <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">        create an edge between them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

        <span class="c1"># Now do a second pass and reduce the number of targets</span>
        <span class="c1"># for any modifiers with a max_targets int</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
                <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextGraph&gt; with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span><span class="si">}</span><span class="s2"> targets and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span><span class="si">}</span><span class="s2"> modifiers&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the serialized representation of the ConTextGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the ConTextGraph from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_graph.ConTextGraph.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_on_modifier_overlap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new ConTextGraph object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spans that context might modify.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modifiers</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.ConTextModifier" href="#medspacy.context.ConTextModifier">ConTextModifier</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextModifiers that might modify the targets.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of edges between targets and modifiers representing the modification relationship.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_on_modifier_overlap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to prune modifiers when one modifier completely covers another.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modifiers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ConTextModifier</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prune_on_modifier_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConTextGraph object.</span>

<span class="sd">    Args:</span>
<span class="sd">        targets: A spans that context might modify.</span>
<span class="sd">        modifiers: A list of ConTextModifiers that might modify the targets.</span>
<span class="sd">        edges: A list of edges between targets and modifiers representing the modification relationship.</span>
<span class="sd">        prune_on_modifier_overlap: Whether to prune modifiers when one modifier completely covers another.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span> <span class="o">=</span> <span class="n">modifiers</span> <span class="k">if</span> <span class="n">modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">edges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span> <span class="o">=</span> <span class="n">prune_on_modifier_overlap</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_graph.ConTextGraph.apply_modifiers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_modifiers</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Checks each target/modifier pair. If modifier modifies target,
create an edge between them.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks each target/modifier pair. If modifier modifies target,</span>
<span class="sd">    create an edge between them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_on_modifier_overlap</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">modifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="n">modifier</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="c1"># Now do a second pass and reduce the number of targets</span>
    <span class="c1"># for any modifiers with a max_targets int</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="n">modifier</span><span class="o">.</span><span class="n">reduce_targets</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">modifier</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">modifier</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">edges</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_graph.ConTextGraph.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Creates the ConTextGraph from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates the ConTextGraph from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">context_graph</span> <span class="o">=</span> <span class="n">ConTextGraph</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">context_graph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_graph.ConTextGraph.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the serialized representation of the ConTextGraph</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the serialized representation of the ConTextGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_graph.ConTextGraph.update_scopes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scopes</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Update the scope of all ConTextModifier.</p>
<p>For each modifier in a list of ConTextModifiers, check against each other
modifier to see if one of the modifiers should update the other.
This allows neighboring similar modifiers to extend each other's
scope and allows "terminate" modifiers to end a modifier's scope.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_graph.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scopes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the scope of all ConTextModifier.</span>

<span class="sd">    For each modifier in a list of ConTextModifiers, check against each other</span>
<span class="sd">    modifier to see if one of the modifiers should update the other.</span>
<span class="sd">    This allows neighboring similar modifiers to extend each other&#39;s</span>
<span class="sd">    scope and allows &quot;terminate&quot; modifiers to end a modifier&#39;s scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">modifier1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">)):</span>
            <span class="n">modifier2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># TODO: Add modifier -&gt; modifier edges</span>
            <span class="n">modifier1</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier2</span><span class="p">)</span>
            <span class="n">modifier2</span><span class="o">.</span><span class="n">limit_scope</span><span class="p">(</span><span class="n">modifier1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.context.context_modifier" class="doc doc-heading">
            <code>context_modifier</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.context.context_modifier.ConTextModifier" class="doc doc-heading">
            <code>ConTextModifier</code>


</h4>


    <div class="doc doc-contents ">


        <p>Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching
text in a Doc.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a concept found by ConText in a document. An instance of this class is the result of ConTextRule matching</span>
<span class="sd">    text in a Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
        <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">        window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">        this ConTextModifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">            start: The start token index.</span>
<span class="sd">            end: The end token index (non-inclusive).</span>
<span class="sd">            doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">                maintained.</span>
<span class="sd">            scope_start: The start token index of the scope.</span>
<span class="sd">            scope_end: The end index of the scope.</span>
<span class="sd">            max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifier_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The spaCy Span object, which is a view of self.doc, covered by this match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rule</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated context rule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">direction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">direction</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scope_span</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allowed_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated allowed types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">allowed_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">excluded_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated excluded types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">excluded_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum number of targets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_targets</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">max_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the associated maximum scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">        self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">        self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">        direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">        If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">        reduced to self.max_scope.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy doc to use to set scope.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
                <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">)</span>
        <span class="c1"># Otherwise, use the sentence</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
            <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                    <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                    <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Set the max scope on either side</span>
            <span class="c1"># Backwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="c1"># Forwards</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the scope of self to be the given spaCy span.</span>

<span class="sd">        Args:</span>
<span class="sd">            span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">        to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">        modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">        &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">        CHF, but there is pneumonia&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            other: The modifier to check against.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the other modifier modified the scope of self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check if the other modifier is a type which can modify self</span>
        <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># If two modifiers have the same category but modify different target types,</span>
        <span class="c1"># don&#39;t limit scope.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: a spaCy span representing a target concept.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
        <span class="c1"># one extracted as both a target and modifier, return False</span>
        <span class="c1"># to avoid self-modifying concepts</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_label: The target type to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">            `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">        either True or False.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to evaluate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Find the span in between the target and modifier</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
        <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
            <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
                <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">rslt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">        Args:</span>
<span class="sd">            target: The spaCy span to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">        `self.max_targets` is None, no pruning is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
            <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
        <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;ConTextModifier&gt; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">]&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialized Representation of the modifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
        <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

        <span class="k">return</span> <span class="n">dict_repr</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates the class from the serialized representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.allowed_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allowed_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated allowed types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">category</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated category.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.direction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">direction</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated direction.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.excluded_types" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">excluded_types</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated excluded types.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.max_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_scope</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum scope.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.max_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">max_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated maximum number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.modifier_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifier_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The spaCy Span object, which is a view of self.doc, covered by this match.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.num_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_targets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated number of targets.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.rule" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rule</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated context rule.</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.context.context_modifier.ConTextModifier.scope_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scope_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Returns the associated scope.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">context_rule</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">scope_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scope_end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding
window. Spans such as entities or other members of span groups that occur within this window can be modified by
this ConTextModifier.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context_rule</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule object which defines the modifier.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end token index (non-inclusive).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc which contains this span. This is needed to initialize the modifier but is not
maintained.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_start</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start token index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scope_end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end index of the scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use scope values rather than sentence boundaries for modifications.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context_rule</span><span class="p">:</span> <span class="n">ConTextRule</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
    <span class="n">scope_start</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">scope_end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new ConTextModifier from a document span. Each modifier represents a span in the text and a surrounding</span>
<span class="sd">    window. Spans such as entities or other members of span groups that occur within this window can be modified by</span>
<span class="sd">    this ConTextModifier.</span>

<span class="sd">    Args:</span>
<span class="sd">        context_rule: The ConTextRule object which defines the modifier.</span>
<span class="sd">        start: The start token index.</span>
<span class="sd">        end: The end token index (non-inclusive).</span>
<span class="sd">        doc: The spaCy Doc which contains this span. This is needed to initialize the modifier but is not</span>
<span class="sd">            maintained.</span>
<span class="sd">        scope_start: The start token index of the scope.</span>
<span class="sd">        scope_end: The end index of the scope.</span>
<span class="sd">        max_scope: Whether to use scope values rather than sentence boundaries for modifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_context_rule</span> <span class="o">=</span> <span class="n">context_rule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">=</span> <span class="n">end</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">scope_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">scope_end</span>
    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.__set_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__set_scope</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If
self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by
self.direction. For example, if the direction is "forward", the scope will be [self.end: sentence.end]. If the
direction is "backward", it will be [self.start: sentence.start].</p>
<p>If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be
reduced to self.max_scope.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy doc to use to set scope.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the direction of the ConTextRule which generated this ConTextModifier to define a scope. If</span>
<span class="sd">    self._max_scope is None, then the default scope is the sentence which it occurs in whichever direction defined by</span>
<span class="sd">    self.direction. For example, if the direction is &quot;forward&quot;, the scope will be [self.end: sentence.end]. If the</span>
<span class="sd">    direction is &quot;backward&quot;, it will be [self.start: sentence.start].</span>

<span class="sd">    If self.max_scope is not None and the length of the default scope is longer than self.max_scope, it will be</span>
<span class="sd">    reduced to self.max_scope.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy doc to use to set scope.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If ConText is set to use defined windows, do that instead of sentence splitting</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">window</span><span class="p">(</span>
            <span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">)</span>
    <span class="c1"># Otherwise, use the sentence</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">full_scope_span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
        <span class="k">if</span> <span class="n">full_scope_span</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;ConText failed because sentence boundaries have not been set. Add an upstream component such as the &quot;</span>
                <span class="s2">&quot;dependency parser, Sentencizer, or PyRuSH to detect sentence boundaries or initialize ConText with &quot;</span>
                <span class="s2">&quot;`max_scope` set to a value greater than 0.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">,</span> <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># bidirectional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
            <span class="n">full_scope_span</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Set the max scope on either side</span>
        <span class="c1"># Backwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="c1"># Forwards</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.allows" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">allows</span><span class="p">(</span><span class="n">target_label</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Returns whether if a modifier is able to modify a target type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_label</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target type to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the modifier is allowed to modify a target of the specified type. True if <code>target_label</code> in</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>self.allowed_types</code> or if <code>target_label</code> not in <code>self.excluded_tupes</code>. False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether if a modifier is able to modify a target type.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_label: The target type to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the modifier is allowed to modify a target of the specified type. True if `target_label` in</span>
<span class="sd">        `self.allowed_types` or if `target_label` not in `self.excluded_tupes`. False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">target_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Instantiates the class from the serialized representation</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextModifier</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiates the class from the serialized representation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">])</span>

    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rule</span>
    <span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">ConTextModifier</span><span class="p">(</span><span class="o">**</span><span class="n">serialized_representation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.limit_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">limit_scope</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>If self and other have the same category or if other has a directionality of 'terminate', use the span of other
to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of
modifiers. For example, in 'no evidence of CHF, no pneumonia', 'pneumonia' will only be modified by 'no', not
'no evidence of'. 'terminate' modifiers limit the scope of a modifier like 'no evidence of' in 'no evidence of
CHF, but there is pneumonia'</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_modifier.ConTextModifier" href="#medspacy.context.context_modifier.ConTextModifier">ConTextModifier</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modifier to check against.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the other modifier modified the scope of self.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">limit_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If self and other have the same category or if other has a directionality of &#39;terminate&#39;, use the span of other</span>
<span class="sd">    to update the scope of self. Limiting the scope of two modifiers of the same category reduces the number of</span>
<span class="sd">    modifiers. For example, in &#39;no evidence of CHF, no pneumonia&#39;, &#39;pneumonia&#39; will only be modified by &#39;no&#39;, not</span>
<span class="sd">    &#39;no evidence of&#39;. &#39;terminate&#39; modifiers limit the scope of a modifier like &#39;no evidence of&#39; in &#39;no evidence of</span>
<span class="sd">    CHF, but there is pneumonia&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        other: The modifier to check against.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the other modifier modified the scope of self.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">scope_span</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Check if the other modifier is a type which can modify self</span>
    <span class="c1"># or if they are the same category. If not, don&#39;t reduce scope.</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;TERMINATE&quot;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">terminated_by</span><span class="p">)</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># If two modifiers have the same category but modify different target types,</span>
    <span class="c1"># don&#39;t limit scope.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">category</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">allowed_types</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">excluded_types</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">orig_scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;backward&quot;</span><span class="p">,</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">orig_scope</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Checks whether the target is within the modifier scope and if self is allowed to modify target.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy span representing a target concept.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the target is within <code>modifier_scope</code> and if self is allowed to modify the target.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks whether the target is within the modifier scope and if self is allowed to modify target.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: a spaCy span representing a target concept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the target is within `modifier_scope` and if self is allowed to modify the target.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the target and modifier overlap, meaning at least one token</span>
    <span class="c1"># one extracted as both a target and modifier, return False</span>
    <span class="c1"># to avoid self-modifying concepts</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
    <span class="p">):</span>  <span class="c1"># self.overlaps(target):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span> <span class="s2">&quot;PSEUDO&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allows</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">tuple_overlaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope_span</span><span class="p">,</span> <span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.modify" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modify</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Add target to the list of self._targets and increment self._num_targets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add target to the list of self._targets and increment self._num_targets.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.on_modifies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_modifies</span><span class="p">(</span><span class="n">target</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>If the ConTextRule used to define a ConTextModifier has an <code>on_modifies</code> callback function, evaluate and return
either True or False.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy span to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the <code>on_modifies</code> callback for the rule. True if the callback is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_modifies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If the ConTextRule used to define a ConTextModifier has an `on_modifies` callback function, evaluate and return</span>
<span class="sd">    either True or False.</span>

<span class="sd">    Args:</span>
<span class="sd">        target: The spaCy span to evaluate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The result of the `on_modifies` callback for the rule. True if the callback is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Find the span in between the target and modifier</span>
    <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">)</span>
    <span class="n">span_between</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">on_modifies</span><span class="p">(</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">],</span> <span class="n">span_between</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">rslt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The on_modifies function must return either True or False indicating &quot;</span>
            <span class="s2">&quot;whether a modify modifies a target. Actual value: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rslt</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">rslt</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.reduce_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reduce_targets</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Reduces the number of targets to the n-closest targets based on the value of <code>self.max_targets</code>. If
<code>self.max_targets</code> is None, no pruning is done.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reduce_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduces the number of targets to the n-closest targets based on the value of `self.max_targets`. If</span>
<span class="sd">    `self.max_targets` is None, no pruning is done.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_targets</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">target_dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_start</span> <span class="o">-</span> <span class="n">target</span><span class="o">.</span><span class="n">end</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span><span class="p">))</span>
        <span class="n">target_dists</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">))</span>
    <span class="n">srtd_targets</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">target_dists</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_targets</span> <span class="o">=</span> <span class="n">srtd_targets</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_num_targets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_targets</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Serialized Representation of the modifier</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialized Representation of the modifier</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dict_repr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;context_rule&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;max_scope&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_scope</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span>
    <span class="n">dict_repr</span><span class="p">[</span><span class="s2">&quot;scope_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span>

    <span class="k">return</span> <span class="n">dict_repr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_modifier.ConTextModifier.update_scope" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_scope</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Changes the scope of self to be the given spaCy span.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a spaCy Span which contains the scope which a modifier should cover.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_modifier.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the scope of self to be the given spaCy span.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: a spaCy Span which contains the scope which a modifier should cover.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_start</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_scope_end</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.context.context_rule" class="doc doc-heading">
            <code>context_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.context.context_rule.ConTextRule" class="doc doc-heading">
            <code>ConTextRule</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers
and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in
the text, and what types of target spans can be modified.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ConTextRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ConTextRule defines a ConText modifier. ConTextRules are rules which define which spans are extracted as modifiers</span>
<span class="sd">    and how they behave, such as the phrase to be matched, the category/semantic class, the direction of the modifier in</span>
<span class="sd">    the text, and what types of target spans can be modified.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_DIRECTIONS</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TERMINATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PSEUDO&quot;</span>
    <span class="p">)</span>
    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;allowed_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;excluded_types&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_targets&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a ConTextRule object.</span>

<span class="sd">        The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">        semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">        Other arguments specify additional custom logic such as:</span>
<span class="sd">            - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">            - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">            - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">            - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">            terminated_by)</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">                include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">                Valid values are:</span>
<span class="sd">                - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">                - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">                - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">                - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                    &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                    &quot;pneumonia&quot;</span>
<span class="sd">                - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                    superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                    phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                    modifier.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">                specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">                callable should take 3 arguments:</span>
<span class="sd">                    target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                    modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                    span_between: The Span between the target and modifier in question.</span>
<span class="sd">                Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">            allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">                not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">                An error will be thrown if both are not None.</span>
<span class="sd">            excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">                target types unless allowed_types is not None.</span>
<span class="sd">            max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">                include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">                This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">                modifier ranges caused by sentence splitting problems.</span>
<span class="sd">            max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">                its scope.</span>
<span class="sd">            terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">                modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">                terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">                positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">                This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
                <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
        <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

        <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">                JSONs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of ConTextRules objects read from the JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
            <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">context_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a dictionary into a ConTextRule.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: The dictionary to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ConTextRule created from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dictionary containing the ConTextRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">            Args:</span>
<span class="sd">            context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">            filepath: the .json file to contain modifier rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ConTextRule(literal=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&#39;, category=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&#39;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;direction=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_rule.ConTextRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;BIDIRECTIONAL&#39;</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_modifies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">excluded_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">terminated_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a ConTextRule object.</p>
<p>The primary arguments of <code>literal</code> <code>category</code>, and <code>direction</code> define the span of text to be matched, the
semantic category, and the direction within the sentence in which the modifier operates.
Other arguments specify additional custom logic such as:
    - Additional control over what text can be matched as a modifier (pattern and on_match)
    - Which types of targets can be modified (allowed_types, excluded_types)
    - The scope size and number of targets that a modifier can modify (max_targets, max_scope)
    - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,
    terminated_by)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>direction</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directionality or action of a modifier. This defines which part of a sentence a modifier will
include as its scope. Entities within the scope will be considered to be modified.
Valid values are:
- "FORWARD": Scope will begin after the end of a modifier and move to the right
- "BACKWARD": Scope will begin before the beginning of a modifier and move to the left
- "BIDIRECTIONAL": Scope will expand on either side of a modifier
- "TERMINATE": A special direction to limit any other modifiers if this phrase is in its scope. Example:
    "no evidence of chf but there is pneumonia": "but" will prevent "no evidence of" from modifying
    "pneumonia"
- "PSEUDO": A special direction which will not modify any targets. This can be used for differentiating
    superstrings of modifiers. Example: A modifier with literal="negative attitude" will prevent the
    phrase "negative" in "She has a negative attitude about her treatment" from being extracted as a
    modifier.</p>
              </div>
            </td>
            <td>
                  <code>&#39;BIDIRECTIONAL&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_modifies</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>, <span title="spacy.tokens.Span">Span</span>], bool]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callback function to run when building an edge between a target and a modifier. This allows
specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The
callable should take 3 arguments:
    target: The spaCy Span from doc.ents (ie., 'Evidence of pneumonia')
    modifier: The spaCy Span covered in a resulting modifier (ie., 'no evidence of')
    span_between: The Span between the target and modifier in question.
Should return either True or False. If returns False, then the modifier will not modify the target.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allowed_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels to allow a modifier to modify. If None, will apply to any type
not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.
An error will be thrown if both are not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>excluded_types</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A collection of target labels which this modifier cannot modify. If None, will apply to all
target types unless allowed_types is not None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number of tokens to explicitly limit the size of the modifier's scope. If None, the scope will
include the entire sentence in the direction of <code>direction</code> and the entire sentence for "BIDIRECTIONAL".
This is useful for requiring modifiers be very close to a concept in the text or for preventing long
modifier ranges caused by sentence splitting problems.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_targets</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum number of targets which a modifier can modify. If None, will modify all targets in
its scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>terminated_by</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional collection of other modifier categories which will terminate the scope of this
modifier. If None, only "TERMINATE" will do this. Example: if a ConTextRule defining "positive for" has
terminated_by={"NEGATED_EXISTENCE"}, then in the sentence "positive for flu, negative for RSV", the
positive modifier will modify "flu" but will be terminated by "negative for" and will not modify "RSV".
This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BIDIRECTIONAL&quot;</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_modifies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">,</span> <span class="n">Span</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">allowed_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">excluded_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_targets</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">terminated_by</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a ConTextRule object.</span>

<span class="sd">    The primary arguments of `literal` `category`, and `direction` define the span of text to be matched, the</span>
<span class="sd">    semantic category, and the direction within the sentence in which the modifier operates.</span>
<span class="sd">    Other arguments specify additional custom logic such as:</span>
<span class="sd">        - Additional control over what text can be matched as a modifier (pattern and on_match)</span>
<span class="sd">        - Which types of targets can be modified (allowed_types, excluded_types)</span>
<span class="sd">        - The scope size and number of targets that a modifier can modify (max_targets, max_scope)</span>
<span class="sd">        - Other logic for terminating a span or for allowing a modifier to modify a target (on_modifies,</span>
<span class="sd">        terminated_by)</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        direction: The directionality or action of a modifier. This defines which part of a sentence a modifier will</span>
<span class="sd">            include as its scope. Entities within the scope will be considered to be modified.</span>
<span class="sd">            Valid values are:</span>
<span class="sd">            - &quot;FORWARD&quot;: Scope will begin after the end of a modifier and move to the right</span>
<span class="sd">            - &quot;BACKWARD&quot;: Scope will begin before the beginning of a modifier and move to the left</span>
<span class="sd">            - &quot;BIDIRECTIONAL&quot;: Scope will expand on either side of a modifier</span>
<span class="sd">            - &quot;TERMINATE&quot;: A special direction to limit any other modifiers if this phrase is in its scope. Example:</span>
<span class="sd">                &quot;no evidence of chf but there is pneumonia&quot;: &quot;but&quot; will prevent &quot;no evidence of&quot; from modifying</span>
<span class="sd">                &quot;pneumonia&quot;</span>
<span class="sd">            - &quot;PSEUDO&quot;: A special direction which will not modify any targets. This can be used for differentiating</span>
<span class="sd">                superstrings of modifiers. Example: A modifier with literal=&quot;negative attitude&quot; will prevent the</span>
<span class="sd">                phrase &quot;negative&quot; in &quot;She has a negative attitude about her treatment&quot; from being extracted as a</span>
<span class="sd">                modifier.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        on_modifies: Callback function to run when building an edge between a target and a modifier. This allows</span>
<span class="sd">            specifying custom logic for allowing or preventing certain modifiers from modifying certain targets. The</span>
<span class="sd">            callable should take 3 arguments:</span>
<span class="sd">                target: The spaCy Span from doc.ents (ie., &#39;Evidence of pneumonia&#39;)</span>
<span class="sd">                modifier: The spaCy Span covered in a resulting modifier (ie., &#39;no evidence of&#39;)</span>
<span class="sd">                span_between: The Span between the target and modifier in question.</span>
<span class="sd">            Should return either True or False. If returns False, then the modifier will not modify the target.</span>
<span class="sd">        allowed_types: A collection of target labels to allow a modifier to modify. If None, will apply to any type</span>
<span class="sd">            not specifically excluded in excluded_types. Only one of allowed_types and excluded_types can be used.</span>
<span class="sd">            An error will be thrown if both are not None.</span>
<span class="sd">        excluded_types: A collection of target labels which this modifier cannot modify. If None, will apply to all</span>
<span class="sd">            target types unless allowed_types is not None.</span>
<span class="sd">        max_scope: A number of tokens to explicitly limit the size of the modifier&#39;s scope. If None, the scope will</span>
<span class="sd">            include the entire sentence in the direction of `direction` and the entire sentence for &quot;BIDIRECTIONAL&quot;.</span>
<span class="sd">            This is useful for requiring modifiers be very close to a concept in the text or for preventing long</span>
<span class="sd">            modifier ranges caused by sentence splitting problems.</span>
<span class="sd">        max_targets: The maximum number of targets which a modifier can modify. If None, will modify all targets in</span>
<span class="sd">            its scope.</span>
<span class="sd">        terminated_by: An optional collection of other modifier categories which will terminate the scope of this</span>
<span class="sd">            modifier. If None, only &quot;TERMINATE&quot; will do this. Example: if a ConTextRule defining &quot;positive for&quot; has</span>
<span class="sd">            terminated_by={&quot;NEGATED_EXISTENCE&quot;}, then in the sentence &quot;positive for flu, negative for RSV&quot;, the</span>
<span class="sd">            positive modifier will modify &quot;flu&quot; but will be terminated by &quot;negative for&quot; and will not modify &quot;RSV&quot;.</span>
<span class="sd">            This helps prevent multiple conflicting modifiers from distributing too far across a sentence.</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">on_modifies</span> <span class="o">=</span> <span class="n">on_modifies</span>

    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;A ConTextRule was instantiated with non-null values for both allowed_types and excluded_types. &quot;</span>
            <span class="s2">&quot;Only one of these can be non-null.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">allowed_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">allowed_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">excluded_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">excluded_types</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_types</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">max_targets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_targets</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_targets must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_targets</span> <span class="o">=</span> <span class="n">max_targets</span>
    <span class="k">if</span> <span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_scope</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_scope must be &gt;= 0 or None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="k">if</span> <span class="n">terminated_by</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">terminated_by</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;terminated_by must be an iterable, such as a list or set, not </span><span class="si">{</span><span class="n">terminated_by</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="n">terminated_by</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">terminated_by</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">terminated_by</span> <span class="o">=</span> <span class="n">terminated_by</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>

    <span class="k">if</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Direction </span><span class="si">{0}</span><span class="s2"> not recognized. Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_DIRECTIONS</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_rule.ConTextRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a ConTextRule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule created from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConTextRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a dictionary into a ConTextRule.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: The dictionary to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ConTextRule created from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">ConTextRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_rule.ConTextRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Reads in a lexicon of modifiers from a JSON file under the key <code>context_rules</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The .json file containing modifier rules. Must contain <code>context_rules</code> key containing the rule
JSONs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.context.context_rule.ConTextRule" href="#medspacy.context.context_rule.ConTextRule">ConTextRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextRules objects read from the JSON.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in a lexicon of modifiers from a JSON file under the key `context_rules`.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The .json file containing modifier rules. Must contain `context_rules` key containing the rule</span>
<span class="sd">            JSONs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of ConTextRules objects read from the JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">context_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;context_rules&quot;</span><span class="p">]:</span>
        <span class="n">context_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ConTextRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">context_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_rule.ConTextRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary containing the ConTextRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts ConTextItems to a python dictionary. Used when writing context rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary containing the ConTextRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.context.context_rule.ConTextRule.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">context_rules</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Writes ConTextItems to a json file.</p>
<p>Args:
context_rules: a list of ContextRules that will be written to a file.
filepath: the .json file to contain modifier rules</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/context_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">context_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConTextRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">        context_rules: a list of ContextRules that will be written to a file.</span>
<span class="sd">        filepath: the .json file to contain modifier rules</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;context_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">context_rules</span><span class="p">]}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.context.util" class="doc doc-heading">
            <code>util</code>


</h3>

    <div class="doc doc-contents ">

        <p>This module will contain helper functions and classes for common clinical processing tasks
which will be used in medspaCy's context implementation.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.context.util.is_modified_by" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_modified_by</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">modifier_label</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check whether a span has a modifier of a specific type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to examine.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modifier_label</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of modifier to check for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether there is a modifier of <code>modifier_label</code> that modifies <code>span</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/context/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_modified_by</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">modifier_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether a span has a modifier of a specific type.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to examine.</span>
<span class="sd">        modifier_label: The type of modifier to check for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether there is a modifier of `modifier_label` that modifies `span`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">modifier_label</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.custom_tokenizer" class="doc doc-heading">
            <code>custom_tokenizer</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="medspacy.custom_tokenizer.create_medspacy_tokenizer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_medspacy_tokenizer</span><span class="p">(</span><span class="n">nlp</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generates a custom tokenizer to augment the default spacy tokenizer
 for situations commonly seen in clinical text.
 This includes:
     * Punctuation infixes.
         For example, this allows the following examples to be more aggresively tokenized as :
             "Patient complains of c/o" -&gt; [..., 'c', '/', 'o']
             "chf+cp" -&gt; ['chf', '+', 'cp']
@param nlp: Spacy language model</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/custom_tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_medspacy_tokenizer</span><span class="p">(</span><span class="n">nlp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a custom tokenizer to augment the default spacy tokenizer</span>
<span class="sd">     for situations commonly seen in clinical text.</span>
<span class="sd">     This includes:</span>
<span class="sd">         * Punctuation infixes.</span>
<span class="sd">             For example, this allows the following examples to be more aggresively tokenized as :</span>
<span class="sd">                 &quot;Patient complains of c/o&quot; -&gt; [..., &#39;c&#39;, &#39;/&#39;, &#39;o&#39;]</span>
<span class="sd">                 &quot;chf+cp&quot; -&gt; [&#39;chf&#39;, &#39;+&#39;, &#39;cp&#39;]</span>
<span class="sd">    @param nlp: Spacy language model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># augment the defaults</span>
    <span class="c1"># this is not quite correct.  We do not want to break on uppercase and we do not</span>
    <span class="c1"># want to break on all punctuation (periods)</span>
    <span class="c1"># infixes = nlp.Defaults.infixes + (r&#39;&#39;&#39;[^a-z0-9]&#39;&#39;&#39;,)</span>
    <span class="c1"># escape all the punctuation we want to allow to allow to break up tokens</span>

    <span class="c1"># get all python punctuation</span>
    <span class="n">punctuation_chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span>
    <span class="c1"># remove periods so that we do not break up &#39;1.5 mg&#39; into &#39;1 . 5 mg&#39;</span>
    <span class="n">punctuation_chars</span> <span class="o">=</span> <span class="n">punctuation_chars</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">infixes</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">infixes</span> <span class="o">+</span> <span class="p">[</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;[{}]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">punctuation_chars</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">prefixes</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">prefixes</span>
    <span class="n">suffixes</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">suffixes</span>

    <span class="c1"># compile</span>
    <span class="n">infix_re</span> <span class="o">=</span> <span class="n">compile_infix_regex</span><span class="p">(</span><span class="n">infixes</span><span class="p">)</span>
    <span class="n">prefix_re</span> <span class="o">=</span> <span class="n">compile_prefix_regex</span><span class="p">(</span><span class="n">prefixes</span><span class="p">)</span>
    <span class="n">suffix_re</span> <span class="o">=</span> <span class="n">compile_suffix_regex</span><span class="p">(</span><span class="n">suffixes</span><span class="p">)</span>

    <span class="c1"># Default exceptions could be extended later</span>
    <span class="n">tokenizer_exceptions</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">Defaults</span><span class="o">.</span><span class="n">tokenizer_exceptions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># now create this</span>
    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="p">,</span>
        <span class="n">tokenizer_exceptions</span><span class="p">,</span>
        <span class="n">prefix_search</span><span class="o">=</span><span class="n">prefix_re</span><span class="o">.</span><span class="n">search</span><span class="p">,</span>
        <span class="n">suffix_search</span><span class="o">=</span><span class="n">suffix_re</span><span class="o">.</span><span class="n">search</span><span class="p">,</span>
        <span class="n">infix_finditer</span><span class="o">=</span><span class="n">infix_re</span><span class="o">.</span><span class="n">finditer</span><span class="p">,</span>
        <span class="n">token_match</span><span class="o">=</span><span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">token_match</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">tokenizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.io" class="doc doc-heading">
            <code>io</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.io.DbConnect" class="doc doc-heading">
            <code>DbConnect</code>


</h3>


    <div class="doc doc-contents ">


        <p>DbConnect is a wrapper for either a pyodbc or sqlite3 connection. It can then be
passed into the DbReader and DbWriter classes to retrieve/store document data.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/db_connect.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DbConnect</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DbConnect is a wrapper for either a pyodbc or sqlite3 connection. It can then be</span>
<span class="sd">    passed into the DbReader and DbWriter classes to retrieve/store document data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new DbConnect object. You can pass in either information for a pyodbc connection string</span>
<span class="sd">        or directly pass in a sqlite or pyodbc connection object.</span>

<span class="sd">        If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">            driver</span>
<span class="sd">            server</span>
<span class="sd">            db:</span>
<span class="sd">            user</span>
<span class="sd">            pwd</span>
<span class="sd">            conn</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;If you are not passing in a connection object, &quot;</span>
                    <span class="s2">&quot;you must pass in all other arguments to create a DB connection.&quot;</span>
                <span class="p">)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="s2">&quot;DRIVER=</span><span class="si">{0}</span><span class="s2">;SERVER=</span><span class="si">{1}</span><span class="s2">;DATABASE=</span><span class="si">{2}</span><span class="s2">;USER=</span><span class="si">{3}</span><span class="s2">;PWD=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c1"># according this thread, bulk insert for sqlserver need to set fast_executemany=True.</span>
        <span class="c1"># https://stackoverflow.com/questions/29638136/how-to-speed-up-bulk-insert-to-ms-sql-server-using-pyodbc</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">,</span> <span class="s1">&#39;fast_executemany&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fast_executemany</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;sqlite3&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">DatabaseError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;pyodbc&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">DatabaseError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;conn must be either a sqlite3 or pyodbc Connection object, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened connection to </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">drop_existing</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">drop_existing</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;drop table if exists </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span>
            <span class="c1"># except pyodbc.DatabaseError:</span>
            <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created table </span><span class="si">{0}</span><span class="s2"> with query: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># print(&quot;Wrote {0} rows with query: {1}&quot;.format(len(data), query))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># print(&quot;Read {0} rows with query: {1}&quot;.format(len(result), query))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connection closed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DbConnect.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new DbConnect object. You can pass in either information for a pyodbc connection string
or directly pass in a sqlite or pyodbc connection object.</p>
<p>If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_connect.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new DbConnect object. You can pass in either information for a pyodbc connection string</span>
<span class="sd">    or directly pass in a sqlite or pyodbc connection object.</span>

<span class="sd">    If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver</span>
<span class="sd">        server</span>
<span class="sd">        db:</span>
<span class="sd">        user</span>
<span class="sd">        pwd</span>
<span class="sd">        conn</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If you are not passing in a connection object, &quot;</span>
                <span class="s2">&quot;you must pass in all other arguments to create a DB connection.&quot;</span>
            <span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s2">&quot;DRIVER=</span><span class="si">{0}</span><span class="s2">;SERVER=</span><span class="si">{1}</span><span class="s2">;DATABASE=</span><span class="si">{2}</span><span class="s2">;USER=</span><span class="si">{3}</span><span class="s2">;PWD=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c1"># according this thread, bulk insert for sqlserver need to set fast_executemany=True.</span>
    <span class="c1"># https://stackoverflow.com/questions/29638136/how-to-speed-up-bulk-insert-to-ms-sql-server-using-pyodbc</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">,</span> <span class="s1">&#39;fast_executemany&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fast_executemany</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;sqlite3&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">DatabaseError</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;pyodbc&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">DatabaseError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;conn must be either a sqlite3 or pyodbc Connection object, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened connection to </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.io.DbWriter" class="doc doc-heading">
            <code>DbWriter</code>


</h3>


    <div class="doc doc-contents ">


        <p>DbWriter is a utility class for writing structured data back to a database.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DbWriter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DbWriter is a utility class for writing structured data back to a database.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">db_conn</span><span class="p">,</span>
            <span class="n">destination_table</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">doc_dtype</span><span class="o">=</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span>
            <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new DbWriter object.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_conn: A medspacy.io.DbConnect object</span>
<span class="sd">            destination_table: The name of the table to write to</span>
<span class="sd">            cols (opt): The names of the columns of the destination table. These should align with attributes extracted</span>
<span class="sd">                by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</span>
<span class="sd">                &gt;&gt;&gt; DbWriter.get_default_cols()</span>
<span class="sd">            col_types (opt): The sql data types of the table columns. They should correspond 1:1 with cols.</span>
<span class="sd">                A set of default values can be accesed by:</span>
<span class="sd">                &gt;&gt;&gt; DbWriter.get_default_col_types()</span>
<span class="sd">            doc_dtype: The type of data from DocConsumer to write from a doc.</span>
<span class="sd">                Either (&quot;ents&quot;, &quot;section&quot;, &quot;context&quot;, or &quot;doc&quot;)</span>
<span class="sd">            create_table (bool): Whether to create a table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span> <span class="o">=</span> <span class="n">destination_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_table</span> <span class="o">=</span> <span class="n">create_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span> <span class="o">=</span> <span class="n">drop_existing</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">DEFAULT_COLS</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">]</span>
            <span class="n">col_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEFAULT_COL_TYPES</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cols must be specified if col_types is not None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span>
        <span class="n">_validate_dtypes</span><span class="p">((</span><span class="n">doc_dtype</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span> <span class="o">=</span> <span class="n">doc_dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">write_batch_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_insert_query</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_col_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>

        <span class="n">_validate_dtypes</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
        <span class="n">dtype_col_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">col_types</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">col_types</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_col_types</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_cols</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
        <span class="n">_validate_dtypes</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>

        <span class="n">dtype_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">cols</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_cols</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;CREATE TABLE </span><span class="si">{0}</span><span class="s2"> (&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_insert_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">col_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
        <span class="n">q_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO </span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">) VALUES (</span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">,</span> <span class="n">col_list</span><span class="p">,</span> <span class="n">q_list</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Doc</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a list of docs or doc to a database.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">Doc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_doc</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a doc to a database.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;write a list of docs to database through bulk insert&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DbWriter.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc_dtype</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new DbWriter object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_conn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A medspacy.io.DbConnect object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_table</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the table to write to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cols</code>
            </td>
            <td>
                  <code>opt</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The names of the columns of the destination table. These should align with attributes extracted
by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</p>
<blockquote>
<blockquote>
<blockquote>
<p>DbWriter.get_default_cols()</p>
</blockquote>
</blockquote>
</blockquote>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>col_types</code>
            </td>
            <td>
                  <code>opt</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sql data types of the table columns. They should correspond 1:1 with cols.
A set of default values can be accesed by:</p>
<blockquote>
<blockquote>
<blockquote>
<p>DbWriter.get_default_col_types()</p>
</blockquote>
</blockquote>
</blockquote>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc_dtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of data from DocConsumer to write from a doc.
Either ("ents", "section", "context", or "doc")</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_table</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a table</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db_conn</span><span class="p">,</span>
        <span class="n">destination_table</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">doc_dtype</span><span class="o">=</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new DbWriter object.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_conn: A medspacy.io.DbConnect object</span>
<span class="sd">        destination_table: The name of the table to write to</span>
<span class="sd">        cols (opt): The names of the columns of the destination table. These should align with attributes extracted</span>
<span class="sd">            by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</span>
<span class="sd">            &gt;&gt;&gt; DbWriter.get_default_cols()</span>
<span class="sd">        col_types (opt): The sql data types of the table columns. They should correspond 1:1 with cols.</span>
<span class="sd">            A set of default values can be accesed by:</span>
<span class="sd">            &gt;&gt;&gt; DbWriter.get_default_col_types()</span>
<span class="sd">        doc_dtype: The type of data from DocConsumer to write from a doc.</span>
<span class="sd">            Either (&quot;ents&quot;, &quot;section&quot;, &quot;context&quot;, or &quot;doc&quot;)</span>
<span class="sd">        create_table (bool): Whether to create a table</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_conn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span> <span class="o">=</span> <span class="n">destination_table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_table</span> <span class="o">=</span> <span class="n">create_table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span> <span class="o">=</span> <span class="n">drop_existing</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">DEFAULT_COLS</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">]</span>
        <span class="n">col_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEFAULT_COL_TYPES</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cols must be specified if col_types is not None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span>
    <span class="n">_validate_dtypes</span><span class="p">((</span><span class="n">doc_dtype</span><span class="p">,))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span> <span class="o">=</span> <span class="n">doc_dtype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">write_batch_size</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_insert_query</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DbWriter.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Write a list of docs or doc to a database.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Doc</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a list of docs or doc to a database.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">Doc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_doc</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DbWriter.write_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Write a doc to a database.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a doc to a database.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DbWriter.write_docs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>write a list of docs to database through bulk insert</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;write a list of docs to database through bulk insert&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.io.DocConsumer" class="doc doc-heading">
            <code>DocConsumer</code>


</h3>


    <div class="doc doc-contents ">


        <p>A DocConsumer object will consume a spacy doc and output rows based on a configuration provided by the user.</p>
<p>This component extracts structured information from a Doc. Information is stored in doc._.data, which is a
    nested dictionary. The outer keys represent the data type of can one or more of:
        - "ents": data about the spans in doc.ents such as the text, label,
            context attributes, section information, or custom attributes
        - "group": data about spans in a span group with the name <code>span_group_attrs</code> section text and category
        - "context": data about entity-modifier pairs extracted by ConText
        - "doc": a single doc-level representation. By default only doc.text is extracted, but other attributes may
            be specified</p>
<pre><code>Once processed, a doc's data can be accessed either by:
    - doc._.data
    - doc._.get_data(dtype=...)
    - doc._.ent_data
    - doc._.to_dataframe(dtype=...)
</code></pre>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DocConsumer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A DocConsumer object will consume a spacy doc and output rows based on a configuration provided by the user.</span>

<span class="sd">    This component extracts structured information from a Doc. Information is stored in doc._.data, which is a</span>
<span class="sd">        nested dictionary. The outer keys represent the data type of can one or more of:</span>
<span class="sd">            - &quot;ents&quot;: data about the spans in doc.ents such as the text, label,</span>
<span class="sd">                context attributes, section information, or custom attributes</span>
<span class="sd">            - &quot;group&quot;: data about spans in a span group with the name `span_group_attrs` section text and category</span>
<span class="sd">            - &quot;context&quot;: data about entity-modifier pairs extracted by ConText</span>
<span class="sd">            - &quot;doc&quot;: a single doc-level representation. By default only doc.text is extracted, but other attributes may</span>
<span class="sd">                be specified</span>

<span class="sd">        Once processed, a doc&#39;s data can be accessed either by:</span>
<span class="sd">            - doc._.data</span>
<span class="sd">            - doc._.get_data(dtype=...)</span>
<span class="sd">            - doc._.ent_data</span>
<span class="sd">            - doc._.to_dataframe(dtype=...)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">,</span>
        <span class="n">dtypes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ents&quot;</span><span class="p">,),</span>
        <span class="n">dtype_attrs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new DocConsumer.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A spaCy model</span>
<span class="sd">            dtypes: Either a tuple of data types to collect or the string &quot;all&quot;. Default (&quot;ents&quot;,). Valid  options are:</span>
<span class="sd">                &quot;ents&quot;, &quot;group&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;.</span>
<span class="sd">            dtype_attrs: An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will</span>
<span class="sd">                set defaults for each dtype. Attributes for &quot;ents&quot;, &quot;group&quot;, and &quot;doc&quot; may be customized be adding either</span>
<span class="sd">                native or custom attributes (i.e., ent._....) &quot;context&quot; and &quot;section&quot; are not customizable at this time.</span>
<span class="sd">                Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</span>
<span class="sd">            span_group_name: the name of the span group used when dtypes contains &quot;group&quot;. At this time, only one span</span>
<span class="sd">                group is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dtypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ALLOWED_DATA_TYPES</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;dtypes must be either &#39;all&#39; or a tuple, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;section&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">dtype_attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="n">dtype_attrs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_attrs</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_attrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the default attributes available to each type specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            dtypes: Optional tuple containing &quot;ents&quot;, &quot;group&quot;, &quot;context&quot;, &quot;section&quot;, or &quot;doc&quot;. If None, all will be</span>
<span class="sd">                returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The attributes the doc consumer will output for each of the specified types in `dtypes`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="n">ALLOWED_DATA_TYPES</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
            <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid dtype,&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="n">dtype_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_ATTRS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_attrs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the default attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_section_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that section attributes are either not specified or are valid attribute names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ALLOWED_SECTION_ATTRS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid section dtype_attrs specified: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the doc consumer on a doc and assign the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;context&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_context_edge_attributes</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_section_attributes</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;doc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">doc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_context_edge_attributes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">modifier</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">,</span> <span class="n">context_data</span><span class="p">,</span> <span class="n">doc</span>
    <span class="p">):</span>
        <span class="n">span_tup</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
        <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">span_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">span_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">scope_tup</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">scope_span</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">scope_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">scope_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_text&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_label_&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_label_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_text&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_category&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_direction&quot;</span><span class="p">:</span>
               <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_direction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_scope_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_scope_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_scope_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_scope_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if specified attribute is not one of these standard values, check the entity to see if it&#39;s an entity value</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attributes for dtype &#39;context&#39; must be either &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;a registered custom Span attribute (i.e., Span._.attr) or one of these pre-defined values: &quot;</span>
                                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_CONTEXT_ATTRS</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">You passed in &#39;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">context_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_section_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">section_data</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="c1"># Allow for null sections</span>
        <span class="n">section_title_tup</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">title_span</span>
        <span class="n">section_body_tup</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">body_span</span>
        <span class="n">section_title</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">section_title_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">section_title_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">section_body</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">section_body_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">section_body_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s2">&quot;section_category&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_title</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">section_title</span><span class="o">.</span><span class="n">start_char</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_title</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_parent&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DocConsumer.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Call the doc consumer on a doc and assign the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the doc consumer on a doc and assign the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;context&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_context_edge_attributes</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_section_attributes</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;doc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DocConsumer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_doc_consumer&#39;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ents&#39;</span><span class="p">,),</span> <span class="n">dtype_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a new DocConsumer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtypes</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either a tuple of data types to collect or the string "all". Default ("ents",). Valid  options are:
"ents", "group", "section", "context", "doc".</p>
              </div>
            </td>
            <td>
                  <code>(&#39;ents&#39;,)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype_attrs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will
set defaults for each dtype. Attributes for "ents", "group", and "doc" may be customized be adding either
native or custom attributes (i.e., ent._....) "context" and "section" are not customizable at this time.
Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the span group used when dtypes contains "group". At this time, only one span
group is supported.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">,</span>
    <span class="n">dtypes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ents&quot;</span><span class="p">,),</span>
    <span class="n">dtype_attrs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new DocConsumer.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A spaCy model</span>
<span class="sd">        dtypes: Either a tuple of data types to collect or the string &quot;all&quot;. Default (&quot;ents&quot;,). Valid  options are:</span>
<span class="sd">            &quot;ents&quot;, &quot;group&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;.</span>
<span class="sd">        dtype_attrs: An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will</span>
<span class="sd">            set defaults for each dtype. Attributes for &quot;ents&quot;, &quot;group&quot;, and &quot;doc&quot; may be customized be adding either</span>
<span class="sd">            native or custom attributes (i.e., ent._....) &quot;context&quot; and &quot;section&quot; are not customizable at this time.</span>
<span class="sd">            Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</span>
<span class="sd">        span_group_name: the name of the span group used when dtypes contains &quot;group&quot;. At this time, only one span</span>
<span class="sd">            group is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ALLOWED_DATA_TYPES</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;dtypes must be either &#39;all&#39; or a tuple, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;section&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">dtype_attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="n">dtype_attrs</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_attrs</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DocConsumer._set_default_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_set_default_attrs</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the default attributes.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_set_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the default attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DocConsumer.get_default_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_default_attrs</span><span class="p">(</span><span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the default attributes available to each type specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dtypes</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tuple containing "ents", "group", "context", "section", or "doc". If None, all will be
returned.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attributes the doc consumer will output for each of the specified types in <code>dtypes</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_attrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the default attributes available to each type specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        dtypes: Optional tuple containing &quot;ents&quot;, &quot;group&quot;, &quot;context&quot;, &quot;section&quot;, or &quot;doc&quot;. If None, all will be</span>
<span class="sd">            returned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The attributes the doc consumer will output for each of the specified types in `dtypes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">ALLOWED_DATA_TYPES</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid dtype,&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">dtype_attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_ATTRS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dtype_attrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.DocConsumer.validate_section_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate that section attributes are either not specified or are valid attribute names.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_section_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that section attributes are either not specified or are valid attribute names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ALLOWED_SECTION_ATTRS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid section dtype_attrs specified: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.io.Pipeline" class="doc doc-heading">
            <code>Pipeline</code>


</h3>


    <div class="doc doc-contents ">


        <p>The Pipeline class executes a batch process of reading texts, processing them with a spaCy model, and writing
the results back to a database.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Pipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Pipeline class executes a batch process of reading texts, processing them with a spaCy model, and writing</span>
<span class="sd">    the results back to a database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Pipeline object.</span>
<span class="sd">        Args:</span>
<span class="sd">            reader: A DbReader object</span>
<span class="sd">            writer: A Dbwriter object</span>
<span class="sd">            nlp: A spaCy model</span>
<span class="sd">            dtype: The DocConsumer data type to write to a database.</span>
<span class="sd">                Default &quot;ent</span>
<span class="sd">                Valid options are (&quot;ent&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a pipeline by reading a set of texts from a source table, processing them with nlp,</span>
<span class="sd">        and writing doc._.data back to the destination table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">query_result</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">query_zip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">query_result</span><span class="p">))</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">texts</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
                    <span class="n">text_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="c1"># Get the data as rows of tuples</span>
                    <span class="n">doc_data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># Add the identifier column</span>
                    <span class="n">doc_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_id</span><span class="p">,)</span> <span class="o">+</span> <span class="n">row_data</span> <span class="k">for</span> <span class="n">row_data</span> <span class="ow">in</span> <span class="n">doc_data</span><span class="p">]</span>
                    <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>
                    <span class="c1"># doc_data = pd.DataFrame(data=doc._.get_data(self.dtype))</span>
                    <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>

                    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.io.Pipeline.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_pipeline&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;ent&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new Pipeline object.
Args:
    reader: A DbReader object
    writer: A Dbwriter object
    nlp: A spaCy model
    dtype: The DocConsumer data type to write to a database.
        Default "ent
        Valid options are ("ent", "section", "context", "doc")</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Pipeline object.</span>
<span class="sd">    Args:</span>
<span class="sd">        reader: A DbReader object</span>
<span class="sd">        writer: A Dbwriter object</span>
<span class="sd">        nlp: A spaCy model</span>
<span class="sd">        dtype: The DocConsumer data type to write to a database.</span>
<span class="sd">            Default &quot;ent</span>
<span class="sd">            Valid options are (&quot;ent&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.io.Pipeline.process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Run a pipeline by reading a set of texts from a source table, processing them with nlp,
and writing doc._.data back to the destination table.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a pipeline by reading a set of texts from a source table, processing them with nlp,</span>
<span class="sd">    and writing doc._.data back to the destination table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">query_result</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query_zip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">query_result</span><span class="p">))</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
                <span class="n">text_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Get the data as rows of tuples</span>
                <span class="n">doc_data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Add the identifier column</span>
                <span class="n">doc_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_id</span><span class="p">,)</span> <span class="o">+</span> <span class="n">row_data</span> <span class="k">for</span> <span class="n">row_data</span> <span class="ow">in</span> <span class="n">doc_data</span><span class="p">]</span>
                <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>
                <span class="c1"># doc_data = pd.DataFrame(data=doc._.get_data(self.dtype))</span>
                <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>

                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="medspacy.io.db_connect" class="doc doc-heading">
            <code>db_connect</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.io.db_connect.DbConnect" class="doc doc-heading">
            <code>DbConnect</code>


</h4>


    <div class="doc doc-contents ">


        <p>DbConnect is a wrapper for either a pyodbc or sqlite3 connection. It can then be
passed into the DbReader and DbWriter classes to retrieve/store document data.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/db_connect.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DbConnect</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DbConnect is a wrapper for either a pyodbc or sqlite3 connection. It can then be</span>
<span class="sd">    passed into the DbReader and DbWriter classes to retrieve/store document data.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new DbConnect object. You can pass in either information for a pyodbc connection string</span>
<span class="sd">        or directly pass in a sqlite or pyodbc connection object.</span>

<span class="sd">        If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">            driver</span>
<span class="sd">            server</span>
<span class="sd">            db:</span>
<span class="sd">            user</span>
<span class="sd">            pwd</span>
<span class="sd">            conn</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;If you are not passing in a connection object, &quot;</span>
                    <span class="s2">&quot;you must pass in all other arguments to create a DB connection.&quot;</span>
                <span class="p">)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="s2">&quot;DRIVER=</span><span class="si">{0}</span><span class="s2">;SERVER=</span><span class="si">{1}</span><span class="s2">;DATABASE=</span><span class="si">{2}</span><span class="s2">;USER=</span><span class="si">{3}</span><span class="s2">;PWD=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c1"># according this thread, bulk insert for sqlserver need to set fast_executemany=True.</span>
        <span class="c1"># https://stackoverflow.com/questions/29638136/how-to-speed-up-bulk-insert-to-ms-sql-server-using-pyodbc</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">,</span> <span class="s1">&#39;fast_executemany&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fast_executemany</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;sqlite3&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">DatabaseError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;pyodbc&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">DatabaseError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;conn must be either a sqlite3 or pyodbc Connection object, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened connection to </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">drop_existing</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">drop_existing</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;drop table if exists </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span>
            <span class="c1"># except pyodbc.DatabaseError:</span>
            <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created table </span><span class="si">{0}</span><span class="s2"> with query: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">query</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># print(&quot;Wrote {0} rows with query: {1}&quot;.format(len(data), query))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># print(&quot;Read {0} rows with query: {1}&quot;.format(len(result), query))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connection closed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.io.db_connect.DbConnect.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create a new DbConnect object. You can pass in either information for a pyodbc connection string
or directly pass in a sqlite or pyodbc connection object.</p>
<p>If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_connect.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conn</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new DbConnect object. You can pass in either information for a pyodbc connection string</span>
<span class="sd">    or directly pass in a sqlite or pyodbc connection object.</span>

<span class="sd">    If conn is None, all other arguments must be supplied. If conn is passed in, all other arguments will be ignored.</span>

<span class="sd">    Args:</span>
<span class="sd">        driver</span>
<span class="sd">        server</span>
<span class="sd">        db:</span>
<span class="sd">        user</span>
<span class="sd">        pwd</span>
<span class="sd">        conn</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;If you are not passing in a connection object, &quot;</span>
                <span class="s2">&quot;you must pass in all other arguments to create a DB connection.&quot;</span>
            <span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s2">&quot;DRIVER=</span><span class="si">{0}</span><span class="s2">;SERVER=</span><span class="si">{1}</span><span class="s2">;DATABASE=</span><span class="si">{2}</span><span class="s2">;USER=</span><span class="si">{3}</span><span class="s2">;PWD=</span><span class="si">{4}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">driver</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">pwd</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c1"># according this thread, bulk insert for sqlserver need to set fast_executemany=True.</span>
    <span class="c1"># https://stackoverflow.com/questions/29638136/how-to-speed-up-bulk-insert-to-ms-sql-server-using-pyodbc</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">,</span> <span class="s1">&#39;fast_executemany&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fast_executemany</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;sqlite3&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">DatabaseError</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pyodbc</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">Connection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_lib</span> <span class="o">=</span> <span class="s2">&quot;pyodbc&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_exception</span> <span class="o">=</span> <span class="n">pyodbc</span><span class="o">.</span><span class="n">DatabaseError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;conn must be either a sqlite3 or pyodbc Connection object, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Opened connection to </span><span class="si">{0}</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">db</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.io.db_writer" class="doc doc-heading">
            <code>db_writer</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.io.db_writer.DbWriter" class="doc doc-heading">
            <code>DbWriter</code>


</h4>


    <div class="doc doc-contents ">


        <p>DbWriter is a utility class for writing structured data back to a database.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DbWriter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DbWriter is a utility class for writing structured data back to a database.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">db_conn</span><span class="p">,</span>
            <span class="n">destination_table</span><span class="p">,</span>
            <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">doc_dtype</span><span class="o">=</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span>
            <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new DbWriter object.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_conn: A medspacy.io.DbConnect object</span>
<span class="sd">            destination_table: The name of the table to write to</span>
<span class="sd">            cols (opt): The names of the columns of the destination table. These should align with attributes extracted</span>
<span class="sd">                by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</span>
<span class="sd">                &gt;&gt;&gt; DbWriter.get_default_cols()</span>
<span class="sd">            col_types (opt): The sql data types of the table columns. They should correspond 1:1 with cols.</span>
<span class="sd">                A set of default values can be accesed by:</span>
<span class="sd">                &gt;&gt;&gt; DbWriter.get_default_col_types()</span>
<span class="sd">            doc_dtype: The type of data from DocConsumer to write from a doc.</span>
<span class="sd">                Either (&quot;ents&quot;, &quot;section&quot;, &quot;context&quot;, or &quot;doc&quot;)</span>
<span class="sd">            create_table (bool): Whether to create a table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_conn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span> <span class="o">=</span> <span class="n">destination_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_table</span> <span class="o">=</span> <span class="n">create_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span> <span class="o">=</span> <span class="n">drop_existing</span>
        <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">DEFAULT_COLS</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">]</span>
            <span class="n">col_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEFAULT_COL_TYPES</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cols must be specified if col_types is not None.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span>
        <span class="n">_validate_dtypes</span><span class="p">((</span><span class="n">doc_dtype</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span> <span class="o">=</span> <span class="n">doc_dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">write_batch_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_insert_query</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_col_types</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>

        <span class="n">_validate_dtypes</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
        <span class="n">dtype_col_types</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">col_types</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">col_types</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_col_types</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_cols</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
        <span class="n">_validate_dtypes</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>

        <span class="n">dtype_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">cols</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_COL_TYPES</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_cols</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;CREATE TABLE </span><span class="si">{0}</span><span class="s2"> (&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_insert_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">col_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
        <span class="n">q_list</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO </span><span class="si">{0}</span><span class="s2"> (</span><span class="si">{1}</span><span class="s2">) VALUES (</span><span class="si">{2}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span><span class="p">,</span> <span class="n">col_list</span><span class="p">,</span> <span class="n">q_list</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Doc</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a list of docs or doc to a database.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">Doc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_doc</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a doc to a database.&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;write a list of docs to database through bulk insert&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.io.db_writer.DbWriter.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">destination_table</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc_dtype</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create a new DbWriter object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_conn</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A medspacy.io.DbConnect object</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>destination_table</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the table to write to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cols</code>
            </td>
            <td>
                  <code>opt</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The names of the columns of the destination table. These should align with attributes extracted
by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</p>
<blockquote>
<blockquote>
<blockquote>
<p>DbWriter.get_default_cols()</p>
</blockquote>
</blockquote>
</blockquote>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>col_types</code>
            </td>
            <td>
                  <code>opt</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sql data types of the table columns. They should correspond 1:1 with cols.
A set of default values can be accesed by:</p>
<blockquote>
<blockquote>
<blockquote>
<p>DbWriter.get_default_col_types()</p>
</blockquote>
</blockquote>
</blockquote>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc_dtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of data from DocConsumer to write from a doc.
Either ("ents", "section", "context", or "doc")</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_table</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create a table</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db_conn</span><span class="p">,</span>
        <span class="n">destination_table</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">col_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">doc_dtype</span><span class="o">=</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">create_table</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">drop_existing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">write_batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new DbWriter object.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_conn: A medspacy.io.DbConnect object</span>
<span class="sd">        destination_table: The name of the table to write to</span>
<span class="sd">        cols (opt): The names of the columns of the destination table. These should align with attributes extracted</span>
<span class="sd">            by DocConsumer and stored in doc._.data. A set of default values can be accessed by:</span>
<span class="sd">            &gt;&gt;&gt; DbWriter.get_default_cols()</span>
<span class="sd">        col_types (opt): The sql data types of the table columns. They should correspond 1:1 with cols.</span>
<span class="sd">            A set of default values can be accesed by:</span>
<span class="sd">            &gt;&gt;&gt; DbWriter.get_default_col_types()</span>
<span class="sd">        doc_dtype: The type of data from DocConsumer to write from a doc.</span>
<span class="sd">            Either (&quot;ents&quot;, &quot;section&quot;, &quot;context&quot;, or &quot;doc&quot;)</span>
<span class="sd">        create_table (bool): Whether to create a table</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db_conn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">destination_table</span> <span class="o">=</span> <span class="n">destination_table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_table</span> <span class="o">=</span> <span class="n">create_table</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">drop_existing</span> <span class="o">=</span> <span class="n">drop_existing</span>
    <span class="k">if</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">DEFAULT_COLS</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">]</span>
        <span class="n">col_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">DEFAULT_COL_TYPES</span><span class="p">[</span><span class="n">doc_dtype</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">col_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cols must be specified if col_types is not None.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">col_types</span> <span class="o">=</span> <span class="n">col_types</span>
    <span class="n">_validate_dtypes</span><span class="p">((</span><span class="n">doc_dtype</span><span class="p">,))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span> <span class="o">=</span> <span class="n">doc_dtype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">write_batch_size</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">insert_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">create_table</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_insert_query</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.db_writer.DbWriter.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Write a list of docs or doc to a database.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Doc</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a list of docs or doc to a database.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">Doc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_doc</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.db_writer.DbWriter.write_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Write a doc to a database.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a doc to a database.&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.db_writer.DbWriter.write_docs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>write a list of docs to database through bulk insert</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/db_writer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">800</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;write a list of docs to database through bulk insert&quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doc_dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.io.doc_consumer" class="doc doc-heading">
            <code>doc_consumer</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.io.doc_consumer.DocConsumer" class="doc doc-heading">
            <code>DocConsumer</code>


</h4>


    <div class="doc doc-contents ">


        <p>A DocConsumer object will consume a spacy doc and output rows based on a configuration provided by the user.</p>
<p>This component extracts structured information from a Doc. Information is stored in doc._.data, which is a
    nested dictionary. The outer keys represent the data type of can one or more of:
        - "ents": data about the spans in doc.ents such as the text, label,
            context attributes, section information, or custom attributes
        - "group": data about spans in a span group with the name <code>span_group_attrs</code> section text and category
        - "context": data about entity-modifier pairs extracted by ConText
        - "doc": a single doc-level representation. By default only doc.text is extracted, but other attributes may
            be specified</p>
<pre><code>Once processed, a doc's data can be accessed either by:
    - doc._.data
    - doc._.get_data(dtype=...)
    - doc._.ent_data
    - doc._.to_dataframe(dtype=...)
</code></pre>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DocConsumer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A DocConsumer object will consume a spacy doc and output rows based on a configuration provided by the user.</span>

<span class="sd">    This component extracts structured information from a Doc. Information is stored in doc._.data, which is a</span>
<span class="sd">        nested dictionary. The outer keys represent the data type of can one or more of:</span>
<span class="sd">            - &quot;ents&quot;: data about the spans in doc.ents such as the text, label,</span>
<span class="sd">                context attributes, section information, or custom attributes</span>
<span class="sd">            - &quot;group&quot;: data about spans in a span group with the name `span_group_attrs` section text and category</span>
<span class="sd">            - &quot;context&quot;: data about entity-modifier pairs extracted by ConText</span>
<span class="sd">            - &quot;doc&quot;: a single doc-level representation. By default only doc.text is extracted, but other attributes may</span>
<span class="sd">                be specified</span>

<span class="sd">        Once processed, a doc&#39;s data can be accessed either by:</span>
<span class="sd">            - doc._.data</span>
<span class="sd">            - doc._.get_data(dtype=...)</span>
<span class="sd">            - doc._.ent_data</span>
<span class="sd">            - doc._.to_dataframe(dtype=...)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">,</span>
        <span class="n">dtypes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ents&quot;</span><span class="p">,),</span>
        <span class="n">dtype_attrs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new DocConsumer.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A spaCy model</span>
<span class="sd">            dtypes: Either a tuple of data types to collect or the string &quot;all&quot;. Default (&quot;ents&quot;,). Valid  options are:</span>
<span class="sd">                &quot;ents&quot;, &quot;group&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;.</span>
<span class="sd">            dtype_attrs: An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will</span>
<span class="sd">                set defaults for each dtype. Attributes for &quot;ents&quot;, &quot;group&quot;, and &quot;doc&quot; may be customized be adding either</span>
<span class="sd">                native or custom attributes (i.e., ent._....) &quot;context&quot; and &quot;section&quot; are not customizable at this time.</span>
<span class="sd">                Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</span>
<span class="sd">            span_group_name: the name of the span group used when dtypes contains &quot;group&quot;. At this time, only one span</span>
<span class="sd">                group is supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dtypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ALLOWED_DATA_TYPES</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;dtypes must be either &#39;all&#39; or a tuple, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;section&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">dtype_attrs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="n">dtype_attrs</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_attrs</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default_attrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the default attributes available to each type specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            dtypes: Optional tuple containing &quot;ents&quot;, &quot;group&quot;, &quot;context&quot;, &quot;section&quot;, or &quot;doc&quot;. If None, all will be</span>
<span class="sd">                returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The attributes the doc consumer will output for each of the specified types in `dtypes`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="n">ALLOWED_DATA_TYPES</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
            <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid dtype,&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="n">dtype_attrs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_ATTRS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dtype_attrs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the default attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_section_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that section attributes are either not specified or are valid attribute names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ALLOWED_SECTION_ATTRS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid section dtype_attrs specified: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the doc consumer on a doc and assign the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="n">data</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;context&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_context_edge_attributes</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_section_attributes</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;doc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">doc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_context_edge_attributes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">modifier</span><span class="p">:</span> <span class="n">ConTextModifier</span><span class="p">,</span> <span class="n">context_data</span><span class="p">,</span> <span class="n">doc</span>
    <span class="p">):</span>
        <span class="n">span_tup</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span>
        <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">span_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">span_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">scope_tup</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">scope_span</span>
        <span class="n">scope</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">scope_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">scope_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_text&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_label_&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_label_&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ent_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;ent_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_text&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_category&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_direction&quot;</span><span class="p">:</span>
               <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_direction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_scope_start_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_scope_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;modifier_scope_end_char&quot;</span><span class="p">:</span>
                <span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;modifier_scope_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if specified attribute is not one of these standard values, check the entity to see if it&#39;s an entity value</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attributes for dtype &#39;context&#39; must be either &quot;</span>
                                         <span class="sa">f</span><span class="s2">&quot;a registered custom Span attribute (i.e., Span._.attr) or one of these pre-defined values: &quot;</span>
                                          <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ALLOWED_CONTEXT_ATTRS</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">You passed in &#39;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="n">context_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_section_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">section_data</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
        <span class="c1"># Allow for null sections</span>
        <span class="n">section_title_tup</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">title_span</span>
        <span class="n">section_body_tup</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">body_span</span>
        <span class="n">section_title</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">section_title_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">section_title_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">section_body</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">section_body_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">section_body_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s2">&quot;section_category&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_category&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_title</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">section_title</span><span class="o">.</span><span class="n">start_char</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_title</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_text&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;section_title_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
                <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_title_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body_start_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body_start_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">start_char</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_body_end_char&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_body_end_char&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_body</span><span class="o">.</span><span class="n">end_char</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;section_parent&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">]:</span>
            <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_parent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.io.doc_consumer.DocConsumer.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call the doc consumer on a doc and assign the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the doc consumer on a doc and assign the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="n">dtype</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;group&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;group&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;context&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_context_edge_attributes</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">modifier</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_section_attributes</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">],</span> <span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;doc&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;doc&quot;</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.doc_consumer.DocConsumer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_doc_consumer&#39;</span><span class="p">,</span> <span class="n">dtypes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ents&#39;</span><span class="p">,),</span> <span class="n">dtype_attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new DocConsumer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtypes</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either a tuple of data types to collect or the string "all". Default ("ents",). Valid  options are:
"ents", "group", "section", "context", "doc".</p>
              </div>
            </td>
            <td>
                  <code>(&#39;ents&#39;,)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype_attrs</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will
set defaults for each dtype. Attributes for "ents", "group", and "doc" may be customized be adding either
native or custom attributes (i.e., ent._....) "context" and "section" are not customizable at this time.
Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the span group used when dtypes contains "group". At this time, only one span
group is supported.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">,</span>
    <span class="n">dtypes</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ents&quot;</span><span class="p">,),</span>
    <span class="n">dtype_attrs</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new DocConsumer.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A spaCy model</span>
<span class="sd">        dtypes: Either a tuple of data types to collect or the string &quot;all&quot;. Default (&quot;ents&quot;,). Valid  options are:</span>
<span class="sd">            &quot;ents&quot;, &quot;group&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;.</span>
<span class="sd">        dtype_attrs: An optional dictionary mapping the data types in dtypes to a list of attributes. If None, will</span>
<span class="sd">            set defaults for each dtype. Attributes for &quot;ents&quot;, &quot;group&quot;, and &quot;doc&quot; may be customized be adding either</span>
<span class="sd">            native or custom attributes (i.e., ent._....) &quot;context&quot; and &quot;section&quot; are not customizable at this time.</span>
<span class="sd">            Default values for each dtype can be retrieved by the class method `DocConsumer.get_default_attrs()</span>
<span class="sd">        span_group_name: the name of the span group used when dtypes contains &quot;group&quot;. At this time, only one span</span>
<span class="sd">            group is supported.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dtypes</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ALLOWED_DATA_TYPES</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;dtypes must be either &#39;all&#39; or a tuple, not </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dtypes</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;section&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">dtype_attrs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">=</span> <span class="n">dtypes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="n">dtype_attrs</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_default_attrs</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.doc_consumer.DocConsumer._set_default_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_set_default_attrs</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the default attributes.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_set_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the default attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype_attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_attrs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.doc_consumer.DocConsumer.get_default_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_default_attrs</span><span class="p">(</span><span class="n">dtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the default attributes available to each type specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dtypes</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tuple containing "ents", "group", "context", "section", or "doc". If None, all will be
returned.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attributes the doc consumer will output for each of the specified types in <code>dtypes</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_default_attrs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the default attributes available to each type specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        dtypes: Optional tuple containing &quot;ents&quot;, &quot;group&quot;, &quot;context&quot;, &quot;section&quot;, or &quot;doc&quot;. If None, all will be</span>
<span class="sd">            returned.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The attributes the doc consumer will output for each of the specified types in `dtypes`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dtypes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">ALLOWED_DATA_TYPES</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dtypes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">dtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">dtypes</span><span class="p">,)</span>
        <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid dtype,&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="n">dtype_attrs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DEFAULT_ATTRS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">dtypes</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">dtype_attrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.doc_consumer.DocConsumer.validate_section_attrs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_section_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Validate that section attributes are either not specified or are valid attribute names.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/doc_consumer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_section_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that section attributes are either not specified or are valid attribute names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">&quot;section&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;section&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">ALLOWED_SECTION_ATTRS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid section dtype_attrs specified: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.io.pipeline" class="doc doc-heading">
            <code>pipeline</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.io.pipeline.Pipeline" class="doc doc-heading">
            <code>Pipeline</code>


</h4>


    <div class="doc doc-contents ">


        <p>The Pipeline class executes a batch process of reading texts, processing them with a spaCy model, and writing
the results back to a database.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Pipeline</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Pipeline class executes a batch process of reading texts, processing them with a spaCy model, and writing</span>
<span class="sd">    the results back to a database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new Pipeline object.</span>
<span class="sd">        Args:</span>
<span class="sd">            reader: A DbReader object</span>
<span class="sd">            writer: A Dbwriter object</span>
<span class="sd">            nlp: A spaCy model</span>
<span class="sd">            dtype: The DocConsumer data type to write to a database.</span>
<span class="sd">                Default &quot;ent</span>
<span class="sd">                Valid options are (&quot;ent&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a pipeline by reading a set of texts from a source table, processing them with nlp,</span>
<span class="sd">        and writing doc._.data back to the destination table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">query_result</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">query_zip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">query_result</span><span class="p">))</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">texts</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
                    <span class="n">text_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="c1"># Get the data as rows of tuples</span>
                    <span class="n">doc_data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># Add the identifier column</span>
                    <span class="n">doc_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_id</span><span class="p">,)</span> <span class="o">+</span> <span class="n">row_data</span> <span class="k">for</span> <span class="n">row_data</span> <span class="ow">in</span> <span class="n">doc_data</span><span class="p">]</span>
                    <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>
                    <span class="c1"># doc_data = pd.DataFrame(data=doc._.get_data(self.dtype))</span>
                    <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>

                    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">+=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.io.pipeline.Pipeline.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_pipeline&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;ent&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create a new Pipeline object.
Args:
    reader: A DbReader object
    writer: A Dbwriter object
    nlp: A spaCy model
    dtype: The DocConsumer data type to write to a database.
        Default "ent
        Valid options are ("ent", "section", "context", "doc")</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlp</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">writer</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;medspacy_pipeline&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new Pipeline object.</span>
<span class="sd">    Args:</span>
<span class="sd">        reader: A DbReader object</span>
<span class="sd">        writer: A Dbwriter object</span>
<span class="sd">        nlp: A spaCy model</span>
<span class="sd">        dtype: The DocConsumer data type to write to a database.</span>
<span class="sd">            Default &quot;ent</span>
<span class="sd">            Valid options are (&quot;ent&quot;, &quot;section&quot;, &quot;context&quot;, &quot;doc&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">reader</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">writer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_DATA_TYPES</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid dtypes. Supported dtypes are </span><span class="si">{0}</span><span class="s2">, not </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">ALLOWED_DATA_TYPES</span><span class="p">,</span> <span class="n">dtype</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.io.pipeline.Pipeline.process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Run a pipeline by reading a set of texts from a source table, processing them with nlp,
and writing doc._.data back to the destination table.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/io/pipeline.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a pipeline by reading a set of texts from a source table, processing them with nlp,</span>
<span class="sd">    and writing doc._.data back to the destination table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">query_result</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">query_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query_zip</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">query_result</span><span class="p">))</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="n">query_zip</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">docs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">texts</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
                <span class="n">text_id</span> <span class="o">=</span> <span class="n">ids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c1"># Get the data as rows of tuples</span>
                <span class="n">doc_data</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">as_rows</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># Add the identifier column</span>
                <span class="n">doc_data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">text_id</span><span class="p">,)</span> <span class="o">+</span> <span class="n">row_data</span> <span class="k">for</span> <span class="n">row_data</span> <span class="ow">in</span> <span class="n">doc_data</span><span class="p">]</span>
                <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>
                <span class="c1"># doc_data = pd.DataFrame(data=doc._.get_data(self.dtype))</span>
                <span class="c1"># doc_data.insert(0, self.writer.cols[0], [text_id for _ in range(len(doc_data))])</span>

                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">+=</span> <span class="n">doc_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">query_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.postprocess" class="doc doc-heading">
            <code>postprocess</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.postprocess.PostprocessingPattern" class="doc doc-heading">
            <code>PostprocessingPattern</code>


</h3>


    <div class="doc doc-contents ">


        <p>PostprocessingPatterns are callable functions and equality values wrapped together that will create triggers
in the later Postprocessor as part of PostprocessingRules.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PostprocessingPattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PostprocessingPatterns are callable functions and equality values wrapped together that will create triggers</span>
<span class="sd">    in the later Postprocessor as part of PostprocessingRules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">success_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A PostprocessingPattern defines a single condition to check against an entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            condition: A function to call on an entity. If the result of the function call equals success_value, then</span>
<span class="sd">                the pattern passes.</span>
<span class="sd">            success_value: The value which should be returned by condition(ent) in order for the pattern to pass. Must</span>
<span class="sd">                have == defined for condition(ent) == success_value.</span>
<span class="sd">            kwargs: Optional keyword arguments to call with condition(ent, **kwargs).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span> <span class="o">=</span> <span class="n">success_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the PostprocessingPattern on the span specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            ent: the span to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether calling `condition` on the entity specified is `success_value`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.PostprocessingPattern.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Call the PostprocessingPattern on the span specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the span to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether calling <code>condition</code> on the entity specified is <code>success_value</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the PostprocessingPattern on the span specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: the span to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether calling `condition` on the entity specified is `success_value`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.PostprocessingPattern.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">success_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>A PostprocessingPattern defines a single condition to check against an entity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>condition</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function to call on an entity. If the result of the function call equals success_value, then
the pattern passes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>success_value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value which should be returned by condition(ent) in order for the pattern to pass. Must
have == defined for condition(ent) == success_value.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional keyword arguments to call with condition(ent, **kwargs).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">success_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PostprocessingPattern defines a single condition to check against an entity.</span>

<span class="sd">    Args:</span>
<span class="sd">        condition: A function to call on an entity. If the result of the function call equals success_value, then</span>
<span class="sd">            the pattern passes.</span>
<span class="sd">        success_value: The value which should be returned by condition(ent) in order for the pattern to pass. Must</span>
<span class="sd">            have == defined for condition(ent) == success_value.</span>
<span class="sd">        kwargs: Optional keyword arguments to call with condition(ent, **kwargs).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span> <span class="o">=</span> <span class="n">success_value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.postprocess.PostprocessingRule" class="doc doc-heading">
            <code>PostprocessingRule</code>


</h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PostprocessingRule</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patterns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingPattern</span><span class="p">],</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</span>

<span class="sd">        patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.</span>
<span class="sd">        action: A function to call with the entity as an argument. This function should take the following arguments:</span>
<span class="sd">            ent: The spacy span</span>
<span class="sd">            i: The index of ent</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Describes where to look for spans.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;.</span>
<span class="sd">            kwargs: Any additional keyword arguments for action.</span>
<span class="sd">        name: Optional name of direction.</span>
<span class="sd">        description: Optional description of the direction.</span>
<span class="sd">        kwargs: Optional keyword arguments to send to `action`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">=</span> <span class="n">patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all the rules in self.rules.</span>
<span class="sd">        If any pattern does not pass (ie., return True), then returns False.</span>
<span class="sd">        If they all pass, execute self.action and return True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
            <span class="c1"># If this is a tuple, at least one has to pass</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">subpattern</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
                    <span class="n">rslt</span> <span class="o">=</span> <span class="n">subpattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">passed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Otherwise just check a single value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rslt</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Every pattern passed - do the action</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Passed:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;on ent:&quot;</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
                    <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">_raise_action_error</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;PostprocessingRule: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.PostprocessingRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Iterate through all the rules in self.rules.
If any pattern does not pass (ie., return True), then returns False.
If they all pass, execute self.action and return True.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all the rules in self.rules.</span>
<span class="sd">    If any pattern does not pass (ie., return True), then returns False.</span>
<span class="sd">    If they all pass, execute self.action and return True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
        <span class="c1"># If this is a tuple, at least one has to pass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">subpattern</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
                <span class="n">rslt</span> <span class="o">=</span> <span class="n">subpattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">passed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Otherwise just check a single value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rslt</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Every pattern passed - do the action</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Passed:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;on ent:&quot;</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
                <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">_raise_action_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
            <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.PostprocessingRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</p>
<p>patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.
action: A function to call with the entity as an argument. This function should take the following arguments:
    ent: The spacy span
    i: The index of ent
    input_span_type: "ents" or "group". Describes where to look for spans.
    span_group_name: The name of the span group used when <code>input_span_type</code> is "group".
    kwargs: Any additional keyword arguments for action.
name: Optional name of direction.
description: Optional description of the direction.
kwargs: Optional keyword arguments to send to <code>action</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">patterns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingPattern</span><span class="p">],</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</span>

<span class="sd">    patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.</span>
<span class="sd">    action: A function to call with the entity as an argument. This function should take the following arguments:</span>
<span class="sd">        ent: The spacy span</span>
<span class="sd">        i: The index of ent</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Describes where to look for spans.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;.</span>
<span class="sd">        kwargs: Any additional keyword arguments for action.</span>
<span class="sd">    name: Optional name of direction.</span>
<span class="sd">    description: Optional description of the direction.</span>
<span class="sd">    kwargs: Optional keyword arguments to send to `action`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">=</span> <span class="n">patterns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.postprocess.Postprocessor" class="doc doc-heading">
            <code>Postprocessor</code>


</h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_postprocessor&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Postprocessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_postprocessor&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>

        <span class="k">if</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the rules.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of PostprocessingRules available to the Postprocessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_span_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_span_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds PostprocessingRules to the Postprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Rules must be type PostprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through the entities in reversed order</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ent</span> <span class="o">=</span> <span class="n">spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

            <span class="c1"># let&#39;s keep track of whether the rule makes a change to spans</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
                <span class="n">rule</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="c1"># Check if the entity was removed based on span counts before and after rule execution</span>
                <span class="c1"># if it was, skip to the next entity</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="c1"># if self.debug:</span>
            <span class="c1">#     print()</span>
        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="medspacy.postprocess.Postprocessor.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.postprocess.Postprocessor.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the rules.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of PostprocessingRules available to the Postprocessor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.postprocess.Postprocessor.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_span_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.Postprocessor.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Iterate through the entities in reversed order</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ent</span> <span class="o">=</span> <span class="n">spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

        <span class="c1"># let&#39;s keep track of whether the rule makes a change to spans</span>
        <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="n">rule</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
            <span class="c1"># Check if the entity was removed based on span counts before and after rule execution</span>
            <span class="c1"># if it was, skip to the next entity</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1"># if self.debug:</span>
        <span class="c1">#     print()</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.Postprocessor.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds PostprocessingRules to the Postprocessor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>, <span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds PostprocessingRules to the Postprocessor.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rules must be type PostprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="medspacy.postprocess.postprocessing_functions" class="doc doc-heading">
            <code>postprocessing_functions</code>


</h3>

    <div class="doc doc-contents ">

        <p>This module contains some simple functions that can be used as action or condition functions for postprocessing rules.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.ent_contains" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ent_contains</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if an entity occurs in the same sentence as another span of text. Case-insensitive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string or a collection of strings that will be searched inside <code>ent</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the <code>target</code> specified is a regex pattern. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the target is contained in the ent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ent_contains</span><span class="p">(</span>
    <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if an entity occurs in the same sentence as another span of text. Case-insensitive.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The span to check.</span>
<span class="sd">        target: A string or a collection of strings that will be searched inside `ent`.</span>
<span class="sd">        regex: If the `target` specified is a regex pattern. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the target is contained in the ent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span_contains</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_family" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_family</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is marked as family.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has span._.is_family set to True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_family</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is marked as family.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has span._.is_family set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_family</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_followed_by" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_followed_by</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks if an entity is followed by a target word within a certain window. If any phrases in target are more than one
token long, this may not capture it if window is smaller than the number of tokens. Case-insensitive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string or a collection of strings that will be searched for in the text following <code>ent</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens to search for <code>target</code> following <code>ent</code>. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the entity specified is followed by a target.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_followed_by</span><span class="p">(</span>
    <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if an entity is followed by a target word within a certain window. If any phrases in target are more than one</span>
<span class="sd">    token long, this may not capture it if window is smaller than the number of tokens. Case-insensitive.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The span to check.</span>
<span class="sd">        target: A string or a collection of strings that will be searched for in the text following `ent`.</span>
<span class="sd">        window: The number of tokens to search for `target` following `ent`. Default is 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the entity specified is followed by a target.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">following_span</span> <span class="o">=</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">ent</span><span class="o">.</span><span class="n">end</span> <span class="p">:</span> <span class="n">ent</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="n">window</span><span class="p">]</span>
    <span class="n">following_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">following_span</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">following_string</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">following_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_historical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_historical</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is marked as historical.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has span._.is_historical set to True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_historical</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is marked as historical.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has span._.is_historical set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_historical</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_hypothetical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_hypothetical</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is marked as hypothetical.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has span._.is_hypothetical set to True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_hypothetical</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is marked as hypothetical.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has span._.is_hypothetical set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_hypothetical</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_modified_by_category" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_modified_by_category</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is modified by a ConTextModifier of that type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category to check whether a ConTextModifier of that type modifies the span.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has the specified modifier type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_modified_by_category</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is modified by a ConTextModifier of that type.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>
<span class="sd">        category: The category to check whether a ConTextModifier of that type modifies the span.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has the specified modifier type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_modified_by_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_modified_by_text</span><span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is modified by a ConTextModifier with the specified text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category to check whether a ConTextModifier with this text modifies the span.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the <code>target</code> specified is a regex pattern. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has the specified modifier type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_modified_by_text</span><span class="p">(</span>
    <span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">regex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is modified by a ConTextModifier with the specified text.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>
<span class="sd">        target: The category to check whether a ConTextModifier with this text modifies the span.</span>
<span class="sd">        regex: If the `target` specified is a regex pattern. Default is True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has the specified modifier type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">span_contains</span><span class="p">(</span><span class="n">modifier</span><span class="o">.</span><span class="n">span</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_negated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_negated</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is marked as negated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has span._.is_negated set to True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_negated</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is marked as negated.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has span._.is_negated set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_negated</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_preceded_by" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_preceded_by</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks if an entity is preceded by a target word within a certain window. If any phrases in target are more than one
token long, this may not capture it if window is smaller than the number of tokens. Case-insensitive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string or a collection of strings that will be searched for in the text preceding <code>ent</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of tokens to search for <code>target</code> preceding <code>ent</code>. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the entity specified is preceded by a target.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_preceded_by</span><span class="p">(</span>
    <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if an entity is preceded by a target word within a certain window. If any phrases in target are more than one</span>
<span class="sd">    token long, this may not capture it if window is smaller than the number of tokens. Case-insensitive.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The span to check.</span>
<span class="sd">        target: A string or a collection of strings that will be searched for in the text preceding `ent`.</span>
<span class="sd">        window: The number of tokens to search for `target` preceding `ent`. Default is 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the entity specified is preceded by a target.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">preceding_span</span> <span class="o">=</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="p">[</span><span class="n">ent</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="n">window</span> <span class="p">:</span> <span class="n">ent</span><span class="o">.</span><span class="n">start</span><span class="p">]</span>
    <span class="n">preceding_string</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">preceding_span</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">preceding_string</span>
    <span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">preceding_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.is_uncertain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_uncertain</span><span class="p">(</span><span class="n">span</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns whether a span is marked as uncertain.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>span</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the specified span has span._.is_uncertain set to True.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_uncertain</span><span class="p">(</span><span class="n">span</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns whether a span is marked as uncertain.</span>

<span class="sd">    Args:</span>
<span class="sd">        span: The span to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the specified span has span._.is_uncertain set to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_uncertain</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.remove_ent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_ent</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Remove an entity at position [i] from doc.ents.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The entity to remove.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of <code>ent</code> in its source list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_type</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the entity, either "ents" or "group".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>input_type</code> is "group", the name of the span group.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_ent</span><span class="p">(</span>
    <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span>
    <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">input_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove an entity at position [i] from doc.ents.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The entity to remove.</span>
<span class="sd">        i: The index of `ent` in its source list.</span>
<span class="sd">        input_type: The source of the entity, either &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        span_group_name: If `input_type` is &quot;group&quot;, the name of the span group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span>
    <span class="k">if</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">])</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.sentence_contains" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sentence_contains</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check if an entity occurs in the same sentence as another span of text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string or a collection of strings that will be searched for in the text of the sentence containing
<code>ent</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>regex</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the <code>target</code> specified is a regex pattern. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sentence_contains</span><span class="p">(</span><span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if an entity occurs in the same sentence as another span of text.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The span to check.</span>
<span class="sd">        target: A string or a collection of strings that will be searched for in the text of the sentence containing</span>
<span class="sd">            `ent`.</span>
<span class="sd">        regex: If the `target` specified is a regex pattern. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">span_contains</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">sent</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">regex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_family" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_family</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the value of ent._.is_family to value.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_family</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="s2">&quot;Set the value of ent._.is_family to value.&quot;</span>
    <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_hypothetical</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_historical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_historical</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the value of ent._.is_historical to value.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_historical</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value of ent._.is_historical to value.&quot;&quot;&quot;</span>
    <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_historical</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_hypothetical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_hypothetical</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the value of ent._.is_hypothetical to value.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_hypothetical</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value of ent._.is_hypothetical to value.&quot;&quot;&quot;</span>
    <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_hypothetical</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_label" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_label</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">input_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a copy of the entity with a new label.</p>
<p>WARNING: This is not fully safe, as spaCy does not allow modifying the label of a span. Instead, this creates a new
copy and attempts to copy existing attributes, but this is not totally reliable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The entity to MODIFY.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index of <code>ent</code> in its source list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>input_type</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source of the entity, either "ents" or "group".</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>input_type</code> is "group", the name of the span group.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_label</span><span class="p">(</span>
    <span class="n">ent</span><span class="p">,</span>
    <span class="n">i</span><span class="p">,</span>
    <span class="n">input_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a copy of the entity with a new label.</span>

<span class="sd">    WARNING: This is not fully safe, as spaCy does not allow modifying the label of a span. Instead, this creates a new</span>
<span class="sd">    copy and attempts to copy existing attributes, but this is not totally reliable.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: The entity to MODIFY.</span>
<span class="sd">        i: The index of `ent` in its source list.</span>
<span class="sd">        input_type: The source of the entity, either &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        span_group_name: If `input_type` is &quot;group&quot;, the name of the span group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">spacy.tokens</span><span class="w"> </span><span class="kn">import</span> <span class="n">Span</span>

    <span class="n">new_ent</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
    <span class="c1"># Copy any additional attributes</span>
    <span class="c1"># NOTE: This may not be complete and should be used with caution</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_extensions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">new_ent</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_ent</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">=</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_ent</span><span class="p">,)</span> <span class="o">+</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_ent</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">][:</span><span class="n">i</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">new_ent</span><span class="p">,)</span>
                <span class="o">+</span> <span class="n">ent</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_negated" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_negated</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the value of ent._.is_negated to value.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_negated</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value of ent._.is_negated to value.&quot;&quot;&quot;</span>
    <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_negated</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.postprocess.postprocessing_functions.set_uncertain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_uncertain</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set the value of ent._.is_uncertain to value.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_uncertain</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the value of ent._.is_uncertain to value.&quot;&quot;&quot;</span>
    <span class="n">ent</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">is_uncertain</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.postprocess.postprocessing_pattern" class="doc doc-heading">
            <code>postprocessing_pattern</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.postprocess.postprocessing_pattern.PostprocessingPattern" class="doc doc-heading">
            <code>PostprocessingPattern</code>


</h4>


    <div class="doc doc-contents ">


        <p>PostprocessingPatterns are callable functions and equality values wrapped together that will create triggers
in the later Postprocessor as part of PostprocessingRules.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PostprocessingPattern</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PostprocessingPatterns are callable functions and equality values wrapped together that will create triggers</span>
<span class="sd">    in the later Postprocessor as part of PostprocessingRules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">success_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A PostprocessingPattern defines a single condition to check against an entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            condition: A function to call on an entity. If the result of the function call equals success_value, then</span>
<span class="sd">                the pattern passes.</span>
<span class="sd">            success_value: The value which should be returned by condition(ent) in order for the pattern to pass. Must</span>
<span class="sd">                have == defined for condition(ent) == success_value.</span>
<span class="sd">            kwargs: Optional keyword arguments to call with condition(ent, **kwargs).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span> <span class="o">=</span> <span class="n">success_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the PostprocessingPattern on the span specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            ent: the span to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether calling `condition` on the entity specified is `success_value`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessing_pattern.PostprocessingPattern.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call the PostprocessingPattern on the span specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ent</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Span">Span</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the span to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether calling <code>condition</code> on the entity specified is <code>success_value</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">:</span> <span class="n">Span</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the PostprocessingPattern on the span specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        ent: the span to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether calling `condition` on the entity specified is `success_value`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessing_pattern.PostprocessingPattern.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">success_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>A PostprocessingPattern defines a single condition to check against an entity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>condition</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function to call on an entity. If the result of the function call equals success_value, then
the pattern passes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>success_value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value which should be returned by condition(ent) in order for the pattern to pass. Must
have == defined for condition(ent) == success_value.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional keyword arguments to call with condition(ent, **kwargs).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_pattern.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">success_value</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PostprocessingPattern defines a single condition to check against an entity.</span>

<span class="sd">    Args:</span>
<span class="sd">        condition: A function to call on an entity. If the result of the function call equals success_value, then</span>
<span class="sd">            the pattern passes.</span>
<span class="sd">        success_value: The value which should be returned by condition(ent) in order for the pattern to pass. Must</span>
<span class="sd">            have == defined for condition(ent) == success_value.</span>
<span class="sd">        kwargs: Optional keyword arguments to call with condition(ent, **kwargs).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">success_value</span> <span class="o">=</span> <span class="n">success_value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.postprocess.postprocessing_rule" class="doc doc-heading">
            <code>postprocessing_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.postprocess.postprocessing_rule.PostprocessingRule" class="doc doc-heading">
            <code>PostprocessingRule</code>


</h4>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PostprocessingRule</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">patterns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingPattern</span><span class="p">],</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</span>

<span class="sd">        patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.</span>
<span class="sd">        action: A function to call with the entity as an argument. This function should take the following arguments:</span>
<span class="sd">            ent: The spacy span</span>
<span class="sd">            i: The index of ent</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Describes where to look for spans.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;.</span>
<span class="sd">            kwargs: Any additional keyword arguments for action.</span>
<span class="sd">        name: Optional name of direction.</span>
<span class="sd">        description: Optional description of the direction.</span>
<span class="sd">        kwargs: Optional keyword arguments to send to `action`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">=</span> <span class="n">patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through all the rules in self.rules.</span>
<span class="sd">        If any pattern does not pass (ie., return True), then returns False.</span>
<span class="sd">        If they all pass, execute self.action and return True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
            <span class="c1"># If this is a tuple, at least one has to pass</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">subpattern</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
                    <span class="n">rslt</span> <span class="o">=</span> <span class="n">subpattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">passed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Otherwise just check a single value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rslt</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Every pattern passed - do the action</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Passed:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;on ent:&quot;</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
                    <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">_raise_action_error</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;PostprocessingRule: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessing_rule.PostprocessingRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Iterate through all the rules in self.rules.
If any pattern does not pass (ie., return True), then returns False.
If they all pass, execute self.action and return True.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterate through all the rules in self.rules.</span>
<span class="sd">    If any pattern does not pass (ie., return True), then returns False.</span>
<span class="sd">    If they all pass, execute self.action and return True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span><span class="p">:</span>
        <span class="c1"># If this is a tuple, at least one has to pass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">subpattern</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
                <span class="n">rslt</span> <span class="o">=</span> <span class="n">subpattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">passed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">passed</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Otherwise just check a single value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rslt</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rslt</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Every pattern passed - do the action</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Passed:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;on ent:&quot;</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="n">ent</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span>
                <span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">_raise_action_error</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
            <span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessing_rule.PostprocessingRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</p>
<p>patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.
action: A function to call with the entity as an argument. This function should take the following arguments:
    ent: The spacy span
    i: The index of ent
    input_span_type: "ents" or "group". Describes where to look for spans.
    span_group_name: The name of the span group used when <code>input_span_type</code> is "group".
    kwargs: Any additional keyword arguments for action.
name: Optional name of direction.
description: Optional description of the direction.
kwargs: Optional keyword arguments to send to <code>action</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">patterns</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingPattern</span><span class="p">],</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A PostprocessingRule checks conditions of a spaCy Span entity and executes some action if all rules are met.</span>

<span class="sd">    patterns: A list of PostprocessingPatterns, each of which check a condition of an entity.</span>
<span class="sd">    action: A function to call with the entity as an argument. This function should take the following arguments:</span>
<span class="sd">        ent: The spacy span</span>
<span class="sd">        i: The index of ent</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Describes where to look for spans.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;.</span>
<span class="sd">        kwargs: Any additional keyword arguments for action.</span>
<span class="sd">    name: Optional name of direction.</span>
<span class="sd">    description: Optional description of the direction.</span>
<span class="sd">    kwargs: Optional keyword arguments to send to `action`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patterns</span> <span class="o">=</span> <span class="n">patterns</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.postprocess.postprocessor" class="doc doc-heading">
            <code>postprocessor</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.postprocess.postprocessor.Postprocessor" class="doc doc-heading">
            <code>Postprocessor</code>


</h4>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_postprocessor&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Postprocessor</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_postprocessor&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">debug</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>

        <span class="k">if</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the rules.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of PostprocessingRules available to the Postprocessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_span_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_span_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds PostprocessingRules to the Postprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Rules must be type PostprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Iterate through the entities in reversed order</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ent</span> <span class="o">=</span> <span class="n">spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

            <span class="c1"># let&#39;s keep track of whether the rule makes a change to spans</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
                <span class="n">rule</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
                <span class="c1"># Check if the entity was removed based on span counts before and after rule execution</span>
                <span class="c1"># if it was, skip to the next entity</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                            <span class="k">break</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="c1"># if self.debug:</span>
            <span class="c1">#     print()</span>
        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.postprocess.postprocessor.Postprocessor.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.postprocess.postprocessor.Postprocessor.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the rules.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of PostprocessingRules available to the Postprocessor.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.postprocess.postprocessor.Postprocessor.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_span_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessor.Postprocessor.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls the Postprocessor on a spaCy doc. This will call each PostprocessingRule on the doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Iterate through the entities in reversed order</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ent</span> <span class="o">=</span> <span class="n">spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>

        <span class="c1"># let&#39;s keep track of whether the rule makes a change to spans</span>
        <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">span_count_before_rule</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="n">rule</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">)</span>
            <span class="c1"># Check if the entity was removed based on span counts before and after rule execution</span>
            <span class="c1"># if it was, skip to the next entity</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">])</span> <span class="o">!=</span> <span class="n">span_count_before_rule</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="c1"># if self.debug:</span>
        <span class="c1">#     print()</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.postprocess.postprocessor.Postprocessor.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds PostprocessingRules to the Postprocessor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>, <span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.postprocess.PostprocessingRule" href="#medspacy.postprocess.PostprocessingRule">PostprocessingRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/postprocess/postprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PostprocessingRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds PostprocessingRules to the Postprocessor.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single PostprocessingRule or a collection of PostprocessingRules to add to the Postprocessor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PostprocessingRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Rules must be type PostprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">input_span_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.preprocess" class="doc doc-heading">
            <code>preprocess</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.preprocess.PreprocessingRule" class="doc doc-heading">
            <code>PreprocessingRule</code>


</h3>


    <div class="doc doc-contents ">


        <p>This is a rule for handling preprocessing in the medspaCy Preprocessor. This class does not inherit from BaseRule,
as it cannot be used in a spaCy pipeline. The Preprocessor and PreprocessingRules are designed to preprocess text
before entering a spaCy pipeline to allow for destructive preprocessing, such as stripping or replacing text.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PreprocessingRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a rule for handling preprocessing in the medspaCy Preprocessor. This class does not inherit from BaseRule,</span>
<span class="sd">    as it cannot be used in a spaCy pipeline. The Preprocessor and PreprocessingRules are designed to preprocess text</span>
<span class="sd">    before entering a spaCy pipeline to allow for destructive preprocessing, such as stripping or replacing text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;repl&quot;</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally</span>
<span class="sd">        replaced from the text underneath a doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern: The text pattern to match and replace in a doc. Must be a string, which will be compiled as</span>
<span class="sd">                a regular expression. The patterns will lead to re.Match objects.</span>
<span class="sd">            repl: The text to replace a matched string with. By default, repl is an empty string. If repl is a function,</span>
<span class="sd">                sends function to re.sub and it will be called on each Match object. More info here</span>
<span class="sd">                https://docs.python.org/3/library/re.html#re.sub</span>
<span class="sd">            flags: A regex compilation flag. Default is re.IGNORECASE.</span>
<span class="sd">            callback: An optional callable which takes the raw text and a Match and returns the new copy of the text,</span>
<span class="sd">                rather than just replacing strings for the matched text. This can allow larger text manipulation, such</span>
<span class="sd">                as stripping out an entire section based on a header.</span>
<span class="sd">            desc: An optional description.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repl</span> <span class="o">=</span> <span class="n">repl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreprocessingRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a PreprocessingRule from a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            d: The dict to read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A PreprocessingRule from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PreprocessingRule</span><span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span>
            <span class="n">repl</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;repl&quot;</span><span class="p">],</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">],</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the PreprocessingRule&#39;s data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
            <span class="s2">&quot;repl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span>
            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span>
            <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a JSON file containing PreprocessingRule data at the key &quot;preprocessing_rules&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: The filepath of the JSON to read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of PreprocessingRules from the JSON file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">PreprocessingRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;preprocessing_rules&quot;</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string</span>
<span class="sd">        using the direction sub method. If callback is not None, then callback function will be executed using</span>
<span class="sd">        the resulting match as an argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the direction just has a repl attribute,</span>
        <span class="c1"># Just return a simple re.sub</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;PreprocessingRule(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, flags=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="si">}</span><span class="s2">, repl=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;callback=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="si">}</span><span class="s2">, desc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.PreprocessingRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string
using the direction sub method. If callback is not None, then callback function will be executed using
the resulting match as an argument.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string</span>
<span class="sd">    using the direction sub method. If callback is not None, then callback function will be executed using</span>
<span class="sd">    the resulting match as an argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the direction just has a repl attribute,</span>
    <span class="c1"># Just return a simple re.sub</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.PreprocessingRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally
replaced from the text underneath a doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text pattern to match and replace in a doc. Must be a string, which will be compiled as
a regular expression. The patterns will lead to re.Match objects.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>repl</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Callable">Callable</span>[[<span title="re.Match">Match</span>], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to replace a matched string with. By default, repl is an empty string. If repl is a function,
sends function to re.sub and it will be called on each Match object. More info here
https://docs.python.org/3/library/re.html#re.sub</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flags</code>
            </td>
            <td>
                  <code><span title="re.RegexFlag">RegexFlag</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A regex compilation flag. Default is re.IGNORECASE.</p>
              </div>
            </td>
            <td>
                  <code><span title="re.IGNORECASE">IGNORECASE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callback</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[str, <span title="re.Match">Match</span>], str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callable which takes the raw text and a Match and returns the new copy of the text,
rather than just replacing strings for the matched text. This can allow larger text manipulation, such
as stripping out an entire section based on a header.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional description.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally</span>
<span class="sd">    replaced from the text underneath a doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern: The text pattern to match and replace in a doc. Must be a string, which will be compiled as</span>
<span class="sd">            a regular expression. The patterns will lead to re.Match objects.</span>
<span class="sd">        repl: The text to replace a matched string with. By default, repl is an empty string. If repl is a function,</span>
<span class="sd">            sends function to re.sub and it will be called on each Match object. More info here</span>
<span class="sd">            https://docs.python.org/3/library/re.html#re.sub</span>
<span class="sd">        flags: A regex compilation flag. Default is re.IGNORECASE.</span>
<span class="sd">        callback: An optional callable which takes the raw text and a Match and returns the new copy of the text,</span>
<span class="sd">            rather than just replacing strings for the matched text. This can allow larger text manipulation, such</span>
<span class="sd">            as stripping out an entire section based on a header.</span>
<span class="sd">        desc: An optional description.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repl</span> <span class="o">=</span> <span class="n">repl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.PreprocessingRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Creates a PreprocessingRule from a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dict to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.preprocess.preprocessing_rule.PreprocessingRule" href="#medspacy.preprocess.preprocessing_rule.PreprocessingRule">PreprocessingRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A PreprocessingRule from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreprocessingRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a PreprocessingRule from a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        d: The dict to read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A PreprocessingRule from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PreprocessingRule</span><span class="p">(</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span>
        <span class="n">repl</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;repl&quot;</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">],</span>
        <span class="n">callback</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">],</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.PreprocessingRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Read a JSON file containing PreprocessingRule data at the key "preprocessing_rules".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filepath of the JSON to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of PreprocessingRules from the JSON file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a JSON file containing PreprocessingRule data at the key &quot;preprocessing_rules&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The filepath of the JSON to read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of PreprocessingRules from the JSON file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">PreprocessingRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;preprocessing_rules&quot;</span><span class="p">]</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.PreprocessingRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the PreprocessingRule's data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary containing the PreprocessingRule&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
        <span class="s2">&quot;repl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span>
        <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.preprocess.Preprocessor" class="doc doc-heading">
            <code>Preprocessor</code>


</h3>


    <div class="doc doc-contents ">


        <p>This is the medspacy Preprocessor class. It is designed as a wrapper for destructive preprocessing rules such as
stripping or replacing text in a document before the text enters a spaCy pipeline.</p>
<p>This is NOT a spaCy component and cannot be added to a spaCy pipeline. Please use the preprocessor before
calling <code>nlp("your text here")</code>. SpaCy only allows for non-destructive processing on the text, but that is not
always advisable for every project, so this enables destructive preprocessing when required.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Preprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the medspacy Preprocessor class. It is designed as a wrapper for destructive preprocessing rules such as</span>
<span class="sd">    stripping or replacing text in a document before the text enters a spaCy pipeline.</span>

<span class="sd">    This is NOT a spaCy component and cannot be added to a spaCy pipeline. Please use the preprocessor before</span>
<span class="sd">    calling `nlp(&quot;your text here&quot;)`. SpaCy only allows for non-destructive processing on the text, but that is not</span>
<span class="sd">    always advisable for every project, so this enables destructive preprocessing when required.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            tokenizer:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single PreprocessingRule or a collection of PreprocessingRules to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Each rule must be an instance of PreprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Doc</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            text:</span>
<span class="sd">            tokenize:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenize</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.Preprocessor.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Doc</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        text:</span>
<span class="sd">        tokenize:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenize</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.Preprocessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        tokenizer:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.preprocess.Preprocessor.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.preprocess.PreprocessingRule" href="#medspacy.preprocess.PreprocessingRule">PreprocessingRule</a>, <span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.preprocess.PreprocessingRule" href="#medspacy.preprocess.PreprocessingRule">PreprocessingRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PreprocessingRule or a collection of PreprocessingRules to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single PreprocessingRule or a collection of PreprocessingRules to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Each rule must be an instance of PreprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="medspacy.preprocess.preprocessing_rule" class="doc doc-heading">
            <code>preprocessing_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule" class="doc doc-heading">
            <code>PreprocessingRule</code>


</h4>


    <div class="doc doc-contents ">


        <p>This is a rule for handling preprocessing in the medspaCy Preprocessor. This class does not inherit from BaseRule,
as it cannot be used in a spaCy pipeline. The Preprocessor and PreprocessingRules are designed to preprocess text
before entering a spaCy pipeline to allow for destructive preprocessing, such as stripping or replacing text.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PreprocessingRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a rule for handling preprocessing in the medspaCy Preprocessor. This class does not inherit from BaseRule,</span>
<span class="sd">    as it cannot be used in a spaCy pipeline. The Preprocessor and PreprocessingRules are designed to preprocess text</span>
<span class="sd">    before entering a spaCy pipeline to allow for destructive preprocessing, such as stripping or replacing text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;repl&quot;</span><span class="p">,</span> <span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
        <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally</span>
<span class="sd">        replaced from the text underneath a doc.</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern: The text pattern to match and replace in a doc. Must be a string, which will be compiled as</span>
<span class="sd">                a regular expression. The patterns will lead to re.Match objects.</span>
<span class="sd">            repl: The text to replace a matched string with. By default, repl is an empty string. If repl is a function,</span>
<span class="sd">                sends function to re.sub and it will be called on each Match object. More info here</span>
<span class="sd">                https://docs.python.org/3/library/re.html#re.sub</span>
<span class="sd">            flags: A regex compilation flag. Default is re.IGNORECASE.</span>
<span class="sd">            callback: An optional callable which takes the raw text and a Match and returns the new copy of the text,</span>
<span class="sd">                rather than just replacing strings for the matched text. This can allow larger text manipulation, such</span>
<span class="sd">                as stripping out an entire section based on a header.</span>
<span class="sd">            desc: An optional description.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repl</span> <span class="o">=</span> <span class="n">repl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreprocessingRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a PreprocessingRule from a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            d: The dict to read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A PreprocessingRule from the dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PreprocessingRule</span><span class="p">(</span>
            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span>
            <span class="n">repl</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;repl&quot;</span><span class="p">],</span>
            <span class="n">flags</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">],</span>
            <span class="n">callback</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">],</span>
            <span class="n">desc</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the PreprocessingRule&#39;s data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
            <span class="s2">&quot;repl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span>
            <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span>
            <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a JSON file containing PreprocessingRule data at the key &quot;preprocessing_rules&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: The filepath of the JSON to read.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of PreprocessingRules from the JSON file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">PreprocessingRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;preprocessing_rules&quot;</span><span class="p">]</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string</span>
<span class="sd">        using the direction sub method. If callback is not None, then callback function will be executed using</span>
<span class="sd">        the resulting match as an argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the direction just has a repl attribute,</span>
        <span class="c1"># Just return a simple re.sub</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;PreprocessingRule(pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, flags=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="si">}</span><span class="s2">, repl=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;callback=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="si">}</span><span class="s2">, desc=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string
using the direction sub method. If callback is not None, then callback function will be executed using
the resulting match as an argument.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a preprocessing direction. If the callback attribute of direction is None, then it will return a string</span>
<span class="sd">    using the direction sub method. If callback is not None, then callback function will be executed using</span>
<span class="sd">    the resulting match as an argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the direction just has a repl attribute,</span>
    <span class="c1"># Just return a simple re.sub</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally
replaced from the text underneath a doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text pattern to match and replace in a doc. Must be a string, which will be compiled as
a regular expression. The patterns will lead to re.Match objects.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>repl</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Callable">Callable</span>[[<span title="re.Match">Match</span>], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to replace a matched string with. By default, repl is an empty string. If repl is a function,
sends function to re.sub and it will be called on each Match object. More info here
https://docs.python.org/3/library/re.html#re.sub</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flags</code>
            </td>
            <td>
                  <code><span title="re.RegexFlag">RegexFlag</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A regex compilation flag. Default is re.IGNORECASE.</p>
              </div>
            </td>
            <td>
                  <code><span title="re.IGNORECASE">IGNORECASE</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callback</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[str, <span title="re.Match">Match</span>], str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callable which takes the raw text and a Match and returns the new copy of the text,
rather than just replacing strings for the matched text. This can allow larger text manipulation, such
as stripping out an entire section based on a header.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>desc</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional description.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">flags</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">RegexFlag</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">,</span>
    <span class="n">callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new PreprocessingRule. Preprocessing rules define spans of text to be removed and optionally</span>
<span class="sd">    replaced from the text underneath a doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern: The text pattern to match and replace in a doc. Must be a string, which will be compiled as</span>
<span class="sd">            a regular expression. The patterns will lead to re.Match objects.</span>
<span class="sd">        repl: The text to replace a matched string with. By default, repl is an empty string. If repl is a function,</span>
<span class="sd">            sends function to re.sub and it will be called on each Match object. More info here</span>
<span class="sd">            https://docs.python.org/3/library/re.html#re.sub</span>
<span class="sd">        flags: A regex compilation flag. Default is re.IGNORECASE.</span>
<span class="sd">        callback: An optional callable which takes the raw text and a Match and returns the new copy of the text,</span>
<span class="sd">            rather than just replacing strings for the matched text. This can allow larger text manipulation, such</span>
<span class="sd">            as stripping out an entire section based on a header.</span>
<span class="sd">        desc: An optional description.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repl</span> <span class="o">=</span> <span class="n">repl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">desc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a PreprocessingRule from a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dict to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.preprocess.preprocessing_rule.PreprocessingRule" href="#medspacy.preprocess.preprocessing_rule.PreprocessingRule">PreprocessingRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A PreprocessingRule from the dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PreprocessingRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a PreprocessingRule from a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        d: The dict to read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A PreprocessingRule from the dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">PreprocessingRule</span><span class="p">(</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span>
        <span class="n">repl</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;repl&quot;</span><span class="p">],</span>
        <span class="n">flags</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;flags&quot;</span><span class="p">],</span>
        <span class="n">callback</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;callback&quot;</span><span class="p">],</span>
        <span class="n">desc</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desc&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Read a JSON file containing PreprocessingRule data at the key "preprocessing_rules".</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filepath of the JSON to read.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of PreprocessingRules from the JSON file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read a JSON file containing PreprocessingRule data at the key &quot;preprocessing_rules&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: The filepath of the JSON to read.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of PreprocessingRules from the JSON file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">PreprocessingRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;preprocessing_rules&quot;</span><span class="p">]</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessing_rule.PreprocessingRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the PreprocessingRule's data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessing_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a preprocessing rule to a dictionary. Useful for writing all rules to a json later.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary containing the PreprocessingRule&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span>
        <span class="s2">&quot;repl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">repl</span><span class="p">,</span>
        <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc</span><span class="p">,</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.preprocess.preprocessor" class="doc doc-heading">
            <code>preprocessor</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.preprocess.preprocessor.Preprocessor" class="doc doc-heading">
            <code>Preprocessor</code>


</h4>


    <div class="doc doc-contents ">


        <p>This is the medspacy Preprocessor class. It is designed as a wrapper for destructive preprocessing rules such as
stripping or replacing text in a document before the text enters a spaCy pipeline.</p>
<p>This is NOT a spaCy component and cannot be added to a spaCy pipeline. Please use the preprocessor before
calling <code>nlp("your text here")</code>. SpaCy only allows for non-destructive processing on the text, but that is not
always advisable for every project, so this enables destructive preprocessing when required.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Preprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the medspacy Preprocessor class. It is designed as a wrapper for destructive preprocessing rules such as</span>
<span class="sd">    stripping or replacing text in a document before the text enters a spaCy pipeline.</span>

<span class="sd">    This is NOT a spaCy component and cannot be added to a spaCy pipeline. Please use the preprocessor before</span>
<span class="sd">    calling `nlp(&quot;your text here&quot;)`. SpaCy only allows for non-destructive processing on the text, but that is not</span>
<span class="sd">    always advisable for every project, so this enables destructive preprocessing when required.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            tokenizer:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single PreprocessingRule or a collection of PreprocessingRules to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Each rule must be an instance of PreprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Doc</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            text:</span>
<span class="sd">            tokenize:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenize</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessor.Preprocessor.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenize</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Doc</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        text:</span>
<span class="sd">        tokenize:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">rule</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">tokenize</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessor.Preprocessor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        tokenizer:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.preprocess.preprocessor.Preprocessor.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.preprocess.PreprocessingRule" href="#medspacy.preprocess.PreprocessingRule">PreprocessingRule</a>, <span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.preprocess.PreprocessingRule" href="#medspacy.preprocess.PreprocessingRule">PreprocessingRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single PreprocessingRule or a collection of PreprocessingRules to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/preprocess/preprocessor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">PreprocessingRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a PreprocessingRule or collection of PreprocessingRules to the Preprocessor.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single PreprocessingRule or a collection of PreprocessingRules to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">PreprocessingRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Each rule must be an instance of PreprocessingRule, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">+=</span> <span class="n">rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.section_detection" class="doc doc-heading">
            <code>section_detection</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.section_detection.Section" class="doc doc-heading">
            <code>Section</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Section is the object that stores the result of processing by the Sectionizer class. A Section contains information
describing the section's category, title span, body span, parent, and the rule that created it.</p>
<p>Section <code>category</code> is equivalent to <code>label_</code> in a basic spaCy entity. It is a normalized name for the section type
determined on initialization, either created manually or through the Sectionizer pipeline component.</p>
<p>Section title, defined with <code>title_start</code>, <code>title_end</code>, and <code>title_span</code> represents the section title or header
matched with the rule. In the text "Past medical history: stroke and high blood pressure", "Past medical history:"
would be the title.</p>
<p>Section body is defined with <code>body_start</code>, <code>body_end</code>, and <code>body_span</code>. It represents the text between the end of
the current section's title and the start of the title for the next Section or when scope is set in the rule or by
the Sectionizer. In the text "Past medical history: stroke and high blood pressure", "stroke and high blood
pressure" would be the body.</p>
<p>Parent is a string that represents the conceptual "parent" section in a section-&gt;subsection-&gt;subsubsection
hierarchy. Candidates are determined by category in the rule and matched at runtime.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Section is the object that stores the result of processing by the Sectionizer class. A Section contains information</span>
<span class="sd">    describing the section&#39;s category, title span, body span, parent, and the rule that created it.</span>

<span class="sd">    Section `category` is equivalent to `label_` in a basic spaCy entity. It is a normalized name for the section type</span>
<span class="sd">    determined on initialization, either created manually or through the Sectionizer pipeline component.</span>

<span class="sd">    Section title, defined with `title_start`, `title_end`, and `title_span` represents the section title or header</span>
<span class="sd">    matched with the rule. In the text &quot;Past medical history: stroke and high blood pressure&quot;, &quot;Past medical history:&quot;</span>
<span class="sd">    would be the title.</span>

<span class="sd">    Section body is defined with `body_start`, `body_end`, and `body_span`. It represents the text between the end of</span>
<span class="sd">    the current section&#39;s title and the start of the title for the next Section or when scope is set in the rule or by</span>
<span class="sd">    the Sectionizer. In the text &quot;Past medical history: stroke and high blood pressure&quot;, &quot;stroke and high blood</span>
<span class="sd">    pressure&quot; would be the body.</span>

<span class="sd">    Parent is a string that represents the conceptual &quot;parent&quot; section in a section-&gt;subsection-&gt;subsubsection</span>
<span class="sd">    hierarchy. Candidates are determined by category in the rule and matched at runtime.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">title_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">title_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">body_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">body_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Section object.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: A normalized name for the section. Equivalent to `label_` for basic spaCy entities.</span>
<span class="sd">            title_start: Index of the first token of the section title.</span>
<span class="sd">            title_end: Index of the last token of the section title.</span>
<span class="sd">            body_start: Index of the first token of the section body.</span>
<span class="sd">            body_end: Index of the last token of the section body.</span>
<span class="sd">            parent: The category of the parent section.</span>
<span class="sd">            rule: The SectionRule that generated the section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span> <span class="o">=</span> <span class="n">title_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span> <span class="o">=</span> <span class="n">title_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span> <span class="o">=</span> <span class="n">body_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span> <span class="o">=</span> <span class="n">body_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Section(category=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="si">}</span><span class="s2"> in the doc with a body at &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="si">}</span><span class="s2"> based on the rule </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">title_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the section title.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start and end indexes of the section title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">body_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the section body.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start and end indexes of the section body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">section_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the entire section, from title start to body end.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start index of the section title and the end index of the section body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the Section.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A json-serialized representation of the section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
            <span class="s2">&quot;title_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span>
            <span class="s2">&quot;title_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="p">,</span>
            <span class="s2">&quot;body_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span>
            <span class="s2">&quot;body_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="p">,</span>
            <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the section from a json-serialized form.</span>

<span class="sd">        Args:</span>
<span class="sd">            serialized_representation: The dictionary form of the section object to load.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Section object containing the data from the dictionary provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">])</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">serialized_representation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]}</span>
        <span class="p">)</span>
        <span class="n">section</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

        <span class="k">return</span> <span class="n">section</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Section.body_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">body_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the span of the section body.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start and end indexes of the section body.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Section.section_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the span of the entire section, from title start to body end.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start index of the section title and the end index of the section body.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Section.title_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">title_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets the span of the section title.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start and end indexes of the section title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Section.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">title_start</span><span class="p">,</span> <span class="n">title_end</span><span class="p">,</span> <span class="n">body_start</span><span class="p">,</span> <span class="n">body_end</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create a new Section object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A normalized name for the section. Equivalent to <code>label_</code> for basic spaCy entities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the first token of the section title.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the last token of the section title.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body_start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the first token of the section body.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body_end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the last token of the section body.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category of the parent section.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rule</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SectionRule that generated the section.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">title_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">title_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">body_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">body_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Section object.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: A normalized name for the section. Equivalent to `label_` for basic spaCy entities.</span>
<span class="sd">        title_start: Index of the first token of the section title.</span>
<span class="sd">        title_end: Index of the last token of the section title.</span>
<span class="sd">        body_start: Index of the first token of the section body.</span>
<span class="sd">        body_end: Index of the last token of the section body.</span>
<span class="sd">        parent: The category of the parent section.</span>
<span class="sd">        rule: The SectionRule that generated the section.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span> <span class="o">=</span> <span class="n">title_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span> <span class="o">=</span> <span class="n">title_end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span> <span class="o">=</span> <span class="n">body_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span> <span class="o">=</span> <span class="n">body_end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Section.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Load the section from a json-serialized form.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>serialized_representation</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary form of the section object to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Section object containing the data from the dictionary provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the section from a json-serialized form.</span>

<span class="sd">    Args:</span>
<span class="sd">        serialized_representation: The dictionary form of the section object to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Section object containing the data from the dictionary provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">])</span>
    <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">serialized_representation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]}</span>
    <span class="p">)</span>
    <span class="n">section</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

    <span class="k">return</span> <span class="n">section</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Section.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Serialize the Section.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A json-serialized representation of the section.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize the Section.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A json-serialized representation of the section.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
        <span class="s2">&quot;title_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span>
        <span class="s2">&quot;title_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="p">,</span>
        <span class="s2">&quot;body_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span>
        <span class="s2">&quot;body_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="p">,</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.section_detection.SectionRule" class="doc doc-heading">
            <code>SectionRule</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>SectionRule defines rules for extracting entities from text using the Sectionizer.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SectionRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SectionRule defines rules for extracting entities from text using the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parents&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_required&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_required</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class for defining rules for extracting entities from text using TargetMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            max_scope: A number of tokens to explicitly limit the size of a section body. If None, the scope will</span>
<span class="sd">                include the entire doc up until either the next section header or the end of the doc. This variable can</span>
<span class="sd">                also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the</span>
<span class="sd">                rule scope will take precedence. If not None, this will be the number of tokens following the matched</span>
<span class="sd">                section header</span>
<span class="sd">                    Example:</span>
<span class="sd">                        In the text &quot;Past Medical History: Pt has hx of pneumonia&quot;,</span>
<span class="sd">                        SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=None) will include the entire doc, but</span>
<span class="sd">                        SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=2) will limit the section</span>
<span class="sd">                            to be &quot;Past Medical History: Pt has&quot;</span>
<span class="sd">                This can be useful for limiting certain sections which are known to be short or allowing others to be</span>
<span class="sd">                longer than the regular global max_scope.</span>
<span class="sd">            parents: A list of candidate parents for determining subsections</span>
<span class="sd">            parent_required: Whether a parent is required for the section to exist in the final output. If true and no</span>
<span class="sd">                parent is identified, the section will be removed.</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
        <span class="k">if</span> <span class="n">parent_required</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Jsonl file incorrectly formatted for pattern name </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;If parents are required, then at least one parent must be specified.&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span> <span class="o">=</span> <span class="n">parent_required</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: the .json file containing modifier rules</span>

<span class="sd">        Returns:</span>
<span class="sd">            section_rules: a list of SectionRule objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">section_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">section_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_rules&quot;</span><span class="p">]:</span>
            <span class="n">section_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">section_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a dictionary into a SectionRule list. Used when reading from a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: the dictionary to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            item: the SectionRule created from the dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{</span><span class="n">invalid_keys</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Must be one of: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            rule_dict: the dictionary containing the TargetRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SectionRule(literal=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&quot;, category=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, on_match=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">on_match</span><span class="si">}</span><span class="s2">, parents=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="si">}</span><span class="s2">, parent_required=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.SectionRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Class for defining rules for extracting entities from text using TargetMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]], str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number of tokens to explicitly limit the size of a section body. If None, the scope will
include the entire doc up until either the next section header or the end of the doc. This variable can
also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the
rule scope will take precedence. If not None, this will be the number of tokens following the matched
section header
    Example:
        In the text "Past Medical History: Pt has hx of pneumonia",
        SectionRule("Past Medical History:", "pmh", max_scope=None) will include the entire doc, but
        SectionRule("Past Medical History:", "pmh", max_scope=2) will limit the section
            to be "Past Medical History: Pt has"
This can be useful for limiting certain sections which are known to be short or allowing others to be
longer than the regular global max_scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parents</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of candidate parents for determining subsections</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_required</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether a parent is required for the section to exist in the final output. If true and no
parent is identified, the section will be removed.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parent_required</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for defining rules for extracting entities from text using TargetMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        max_scope: A number of tokens to explicitly limit the size of a section body. If None, the scope will</span>
<span class="sd">            include the entire doc up until either the next section header or the end of the doc. This variable can</span>
<span class="sd">            also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the</span>
<span class="sd">            rule scope will take precedence. If not None, this will be the number of tokens following the matched</span>
<span class="sd">            section header</span>
<span class="sd">                Example:</span>
<span class="sd">                    In the text &quot;Past Medical History: Pt has hx of pneumonia&quot;,</span>
<span class="sd">                    SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=None) will include the entire doc, but</span>
<span class="sd">                    SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=2) will limit the section</span>
<span class="sd">                        to be &quot;Past Medical History: Pt has&quot;</span>
<span class="sd">            This can be useful for limiting certain sections which are known to be short or allowing others to be</span>
<span class="sd">            longer than the regular global max_scope.</span>
<span class="sd">        parents: A list of candidate parents for determining subsections</span>
<span class="sd">        parent_required: Whether a parent is required for the section to exist in the final output. If true and no</span>
<span class="sd">            parent is identified, the section will be removed.</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
    <span class="k">if</span> <span class="n">parent_required</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Jsonl file incorrectly formatted for pattern name </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;If parents are required, then at least one parent must be specified.&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span> <span class="o">=</span> <span class="n">parent_required</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.SectionRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a SectionRule list. Used when reading from a json file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the SectionRule created from the dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a dictionary into a SectionRule list. Used when reading from a json file.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: the dictionary to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        item: the SectionRule created from the dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{</span><span class="n">invalid_keys</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Must be one of: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.SectionRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Read in a lexicon of modifiers from a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the .json file containing modifier rules</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>section_rules</code></td>            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of SectionRule objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: the .json file containing modifier rules</span>

<span class="sd">    Returns:</span>
<span class="sd">        section_rules: a list of SectionRule objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">section_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">section_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_rules&quot;</span><span class="p">]:</span>
        <span class="n">section_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">section_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.SectionRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rule_dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary containing the TargetRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rule_dict: the dictionary containing the TargetRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="medspacy.section_detection.Sectionizer" class="doc doc-heading">
            <code>Sectionizer</code>


</h3>


    <div class="doc doc-contents ">


        <p>The Sectionizer will search for spans in the text which match section header rules, such as 'Past Medical History:'.
Sections will be represented in custom attributes as:
    category: A normalized title of the section. Example: 'past_medical_history'
    section_title: The Span of the doc which was matched as a section header.
        Example: 'Past Medical History:'
    section_span: The entire section of the note, starting with section_header and up until the end
        of the section, which will be either the start of the next section header of some pre-specified
        scope. Example: 'Past Medical History: Type II DM'</p>
<p>Section attributes will be registered for each Doc, Span, and Token in the following attributes:
    Doc.<em>.sections: A list of namedtuples of type Section with 4 elements:
        - section_title
        - section_header
        - section_parent
        - section_span.
    A Doc will also have attributes corresponding to lists of each
        (ie., Doc.</em>.section_titles, Doc.<em>.section_headers, Doc.</em>.section_parents, Doc.<em>.section_list)
    (Span|Token).</em>.section_title
    (Span|Token).<em>.section_header
    (Span|Token).</em>.section_parent
    (Span|Token)._.section_span</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Sectionizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Sectionizer will search for spans in the text which match section header rules, such as &#39;Past Medical History:&#39;.</span>
<span class="sd">    Sections will be represented in custom attributes as:</span>
<span class="sd">        category: A normalized title of the section. Example: &#39;past_medical_history&#39;</span>
<span class="sd">        section_title: The Span of the doc which was matched as a section header.</span>
<span class="sd">            Example: &#39;Past Medical History:&#39;</span>
<span class="sd">        section_span: The entire section of the note, starting with section_header and up until the end</span>
<span class="sd">            of the section, which will be either the start of the next section header of some pre-specified</span>
<span class="sd">            scope. Example: &#39;Past Medical History: Type II DM&#39;</span>

<span class="sd">    Section attributes will be registered for each Doc, Span, and Token in the following attributes:</span>
<span class="sd">        Doc._.sections: A list of namedtuples of type Section with 4 elements:</span>
<span class="sd">            - section_title</span>
<span class="sd">            - section_header</span>
<span class="sd">            - section_parent</span>
<span class="sd">            - section_span.</span>
<span class="sd">        A Doc will also have attributes corresponding to lists of each</span>
<span class="sd">            (ie., Doc._.section_titles, Doc._.section_headers, Doc._.section_parents, Doc._.section_list)</span>
<span class="sd">        (Span|Token)._.section_title</span>
<span class="sd">        (Span|Token)._.section_header</span>
<span class="sd">        (Span|Token)._.section_parent</span>
<span class="sd">        (Span|Token)._.section_span</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
        <span class="n">max_section_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">require_start_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">require_end_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">newline_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\n\r]+[\s]*$&quot;</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
        <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">apply_sentence_boundary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Sectionizer component.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A SpaCy Language object.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">                SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules</span>
<span class="sd">                are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through</span>
<span class="sd">                `Sectionizer.add`.</span>
<span class="sd">            language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">                and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">                Default is &quot;en&quot; for English.</span>
<span class="sd">            max_section_length: Optional argument specifying the maximum number of tokens following a section header</span>
<span class="sd">                which can be included in a section body. This can be useful if you think your section rules are</span>
<span class="sd">                incomplete and want to prevent sections from running too long in the note. Default is None, meaning that</span>
<span class="sd">                the scope of a section will be until either the next section header or the end of the document.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            require_start_line: Optionally require a section header to start on a new line. Default False.</span>
<span class="sd">            require_end_line: Optionally require a section header to end with a new line. Default False.</span>
<span class="sd">            newline_pattern: Regular expression to match the new line either preceding or following a header</span>
<span class="sd">                if either require_start_line or require_end_line are True. Default is r&quot;[\n\r]+[\s]*$&quot;</span>
<span class="sd">            span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">                `DEFAULT_ATTRIBUTES`. If a dictionary of custom attributes, format is a dictionary mapping section</span>
<span class="sd">                categories to a dictionary containing the attribute name and the value to set the attribute to when a</span>
<span class="sd">                span is contained in a section of that category. Custom attributes must be assigned with</span>
<span class="sd">                `Span.set_extension` before creating the Sectionizer. If None, sectionizer will not modify span</span>
<span class="sd">                attributes.</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for spans when modifying attributes of spans</span>
<span class="sd">                contained in a section if `span_attrs` is not None. &quot;ents&quot; will modify attributes of spans in doc.ents.</span>
<span class="sd">                &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">            apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures</span>
<span class="sd">                the section header is considered its own sentence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="o">=</span> <span class="n">max_section_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span> <span class="o">=</span> <span class="n">require_start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span> <span class="o">=</span> <span class="n">require_end_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span> <span class="o">=</span> <span class="n">apply_sentence_boundary</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;section_patterns.json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets list of rules associated with the Sectionizer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of SectionRules associated with the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">section_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a list of categories used in the Sectionizer.</span>

<span class="sd">        Returns:</span>
<span class="sd">                The list of all section categories available to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds SectionRules to the Sectionizer.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single SectionRule or a collection of SectionRules to add to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be type SectionRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parents</span>
            <span class="n">parent_required</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parent_required</span>
            <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Merging parents. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;If this is not intended, please specify distinct titles.&quot;</span><span class="p">,</span>
                        <span class="ne">RuntimeWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">parent_required</span>
            <span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has different parent_required option. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Setting parent_required to False.&quot;</span><span class="p">,</span>
                    <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_required</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_parent_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the legal parent-child section relationships from the list</span>
<span class="sd">        of in-order sections of a document and the possible parents of each</span>
<span class="sd">        section as specified during direction creation.</span>

<span class="sd">        Args:</span>
<span class="sd">            sections: a list of spacy match tuples found in the doc</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</span>
<span class="sd">            and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</span>
<span class="sd">            smaller list than the input due to pruning with `parent_required`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sections_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">removed_sections</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">category</span>
            <span class="n">required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">i_a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">removed_sections</span>  <span class="c1"># adjusted index for removed values</span>
            <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">identified_parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                    <span class="c1"># go backwards through the section &quot;tree&quot; until you hit a root or the start of the list</span>
                    <span class="n">candidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                    <span class="n">candidates_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">candidates_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">candidates_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                <span class="n">sections_final</span><span class="p">[</span><span class="n">candidates_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">candidates_parent</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">candidate_i</span> <span class="o">=</span> <span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="n">candidate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                            <span class="n">identified_parent</span> <span class="o">=</span> <span class="n">candidate_i</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># if you are at the end of the list... no parent</span>
                            <span class="k">if</span> <span class="n">candidate_i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">continue</span>
                            <span class="c1"># if the current candidate has no parent... no parent exists</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates_parent</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">continue</span>
                            <span class="c1"># otherwise get the previous item in the list</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                    <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                            <span class="n">temp_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">temp_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">temp_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                        <span class="n">sections_final</span><span class="p">[</span><span class="n">temp_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="p">]</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_parent</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="c1"># if the previous item is the parent of the current item</span>
                            <span class="c1"># OR if the previous item is a sibling of the current item</span>
                            <span class="c1"># continue to search</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">temp</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                                <span class="ow">or</span> <span class="n">temp_parent</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                            <span class="p">):</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="n">temp</span>
                                <span class="n">candidates_parent</span> <span class="o">=</span> <span class="n">temp_parent</span>
                                <span class="n">candidate_i</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="c1"># otherwise, there is no further tree traversal</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># if a parent is required, then add</span>
                <span class="k">if</span> <span class="n">identified_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">required</span><span class="p">:</span>
                    <span class="c1"># if the parent is identified, add section</span>
                    <span class="c1"># if the parent is not required, add section</span>
                    <span class="c1"># if parent is not identified and required, do not add the section</span>
                    <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">identified_parent</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sections_final</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_assertion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spans</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Span</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add Span-level attributes to entities based on which section they occur in.</span>

<span class="sd">        Args:</span>
<span class="sd">            spans: the spans to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span>
                <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span>
            <span class="p">):</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">[</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any</span>
<span class="sd">        section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections</span>
<span class="sd">        the entities spans in.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed spaCy Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="c1"># If this has already been processed by the sectionizer, reset the sections</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if there were no matches, return the doc as one section</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">doc</span>

        <span class="n">section_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if the first match does not begin at token 0, handle the first section</span>
        <span class="n">first_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># handle section spans</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">parent_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>
                <span class="k">if</span> <span class="n">parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="n">section_list</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># IDEs will warn here about match shape disagreeing w/ type hinting, but this if is only used if</span>
                <span class="c1"># parent sections were never set, so parent_idx does not exist</span>
                <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>

            <span class="c1"># Make section header its own sentence</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span><span class="p">:</span>
                <span class="c1"># Section headers should be considered the start of a sentence</span>
                <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Text following the header should also be considered a new sentence</span>
                <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
                    <span class="n">doc</span><span class="p">[</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
            <span class="c1"># If this is the last match, it should include the rest of the doc</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># If there is no scope limitation, go until the end of the doc</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the rule has a max_scope, use that as a precedence</span>
                    <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="c1"># Otherwise, go until the next section header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">section_span</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
                <span class="n">token</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">section</span>

        <span class="c1"># If it is specified to add assertion attributes,</span>
        <span class="c1"># iterate through the entities in doc and add them</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">doc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_start_lines</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter a list of matches to only contain spans where the start token is the beginning of a new line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_start_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_end_lines</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter a list of matches to only contain spans where the start token is followed by a new line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_end_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Sectionizer.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Sectionizer.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets list of rules associated with the Sectionizer.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of SectionRules associated with the Sectionizer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Sectionizer.section_categories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_categories</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Gets a list of categories used in the Sectionizer.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Set">Set</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of all section categories available to the Sectionizer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="medspacy.section_detection.Sectionizer.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any
section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections
the entities spans in.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed spaCy Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any</span>
<span class="sd">    section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections</span>
<span class="sd">    the entities spans in.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed spaCy Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

    <span class="c1"># If this has already been processed by the sectionizer, reset the sections</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if there were no matches, return the doc as one section</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">doc</span>

    <span class="n">section_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if the first match does not begin at token 0, handle the first section</span>
    <span class="n">first_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># handle section spans</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">parent_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">if</span> <span class="n">parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">section_list</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># IDEs will warn here about match shape disagreeing w/ type hinting, but this if is only used if</span>
            <span class="c1"># parent sections were never set, so parent_idx does not exist</span>
            <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>

        <span class="c1"># Make section header its own sentence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span><span class="p">:</span>
            <span class="c1"># Section headers should be considered the start of a sentence</span>
            <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Text following the header should also be considered a new sentence</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
                <span class="n">doc</span><span class="p">[</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
        <span class="c1"># If this is the last match, it should include the rest of the doc</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If there is no scope limitation, go until the end of the doc</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the rule has a max_scope, use that as a precedence</span>
                <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># Otherwise, go until the next section header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">section_span</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">section</span>

    <span class="c1"># If it is specified to add assertion attributes,</span>
    <span class="c1"># iterate through the entities in doc and add them</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_sectionizer&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">max_section_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">require_start_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">require_end_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newline_pattern</span><span class="o">=</span><span class="s1">&#39;[</span><span class="se">\\</span><span class="s1">n</span><span class="se">\\</span><span class="s1">r]+[</span><span class="se">\\</span><span class="s1">s]*$&#39;</span><span class="p">,</span> <span class="n">input_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="n">span_attrs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">apply_sentence_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <pre><code>   Create a new Sectionizer component.

   Args:
       nlp: A SpaCy Language object.
       name: The name of the component.
       rules: The rules to load. Default is "default", loads rules packaged with medspaCy that are derived from
           SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules
           are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through
           `Sectionizer.add`.
       language_code: Language code to use (ISO code) as a default for loading resources.  See documentation
           and also the /resources directory to see which resources might be available in each language.
           Default is "en" for English.
       max_section_length: Optional argument specifying the maximum number of tokens following a section header
           which can be included in a section body. This can be useful if you think your section rules are
           incomplete and want to prevent sections from running too long in the note. Default is None, meaning that
           the scope of a section will be until either the next section header or the end of the document.
       phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default
           is 'LOWER'.
       require_start_line: Optionally require a section header to start on a new line. Default False.
       require_end_line: Optionally require a section header to end with a new line. Default False.
       newline_pattern: Regular expression to match the new line either preceding or following a header
           if either require_start_line or require_end_line are True. Default is r"[
</code></pre>
<p>]+[\s]*$"
           span_attrs: The optional span attributes to modify. Default option "default" uses attributes in
               <code>DEFAULT_ATTRIBUTES</code>. If a dictionary of custom attributes, format is a dictionary mapping section
               categories to a dictionary containing the attribute name and the value to set the attribute to when a
               span is contained in a section of that category. Custom attributes must be assigned with
               <code>Span.set_extension</code> before creating the Sectionizer. If None, sectionizer will not modify span
               attributes.
           input_span_type: "ents" or "group". Where to look for spans when modifying attributes of spans
               contained in a section if <code>span_attrs</code> is not None. "ents" will modify attributes of spans in doc.ents.
               "group" will modify attributes of spans in the span group specified by <code>span_group_name</code>.
           span_group_name: The name of the span group used when <code>input_span_type</code> is "group". Default is
               "medspacy_spans".
           apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures
               the section header is considered its own sentence.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">max_section_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">require_start_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">require_end_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">newline_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\n\r]+[\s]*$&quot;</span><span class="p">,</span>
    <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">apply_sentence_boundary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Sectionizer component.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A SpaCy Language object.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">            SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules</span>
<span class="sd">            are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through</span>
<span class="sd">            `Sectionizer.add`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        max_section_length: Optional argument specifying the maximum number of tokens following a section header</span>
<span class="sd">            which can be included in a section body. This can be useful if you think your section rules are</span>
<span class="sd">            incomplete and want to prevent sections from running too long in the note. Default is None, meaning that</span>
<span class="sd">            the scope of a section will be until either the next section header or the end of the document.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        require_start_line: Optionally require a section header to start on a new line. Default False.</span>
<span class="sd">        require_end_line: Optionally require a section header to end with a new line. Default False.</span>
<span class="sd">        newline_pattern: Regular expression to match the new line either preceding or following a header</span>
<span class="sd">            if either require_start_line or require_end_line are True. Default is r&quot;[\n\r]+[\s]*$&quot;</span>
<span class="sd">        span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">            `DEFAULT_ATTRIBUTES`. If a dictionary of custom attributes, format is a dictionary mapping section</span>
<span class="sd">            categories to a dictionary containing the attribute name and the value to set the attribute to when a</span>
<span class="sd">            span is contained in a section of that category. Custom attributes must be assigned with</span>
<span class="sd">            `Span.set_extension` before creating the Sectionizer. If None, sectionizer will not modify span</span>
<span class="sd">            attributes.</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for spans when modifying attributes of spans</span>
<span class="sd">            contained in a section if `span_attrs` is not None. &quot;ents&quot; will modify attributes of spans in doc.ents.</span>
<span class="sd">            &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">        apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures</span>
<span class="sd">            the section header is considered its own sentence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="o">=</span> <span class="n">max_section_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span> <span class="o">=</span> <span class="n">require_start_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span> <span class="o">=</span> <span class="n">require_end_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span> <span class="o">=</span> <span class="n">apply_sentence_boundary</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="s2">&quot;section_patterns.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

    <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Adds SectionRules to the Sectionizer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single SectionRule or a collection of SectionRules to add to the Sectionizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds SectionRules to the Sectionizer.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single SectionRule or a collection of SectionRules to add to the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be type SectionRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parents</span>
        <span class="n">parent_required</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parent_required</span>
        <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Merging parents. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;If this is not intended, please specify distinct titles.&quot;</span><span class="p">,</span>
                    <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">parent_required</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has different parent_required option. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Setting parent_required to False.&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_required</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.filter_end_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Filter a list of matches to only contain spans where the start token is followed by a new line.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of match tuples (match_id, start, end) that meet the filter criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_end_lines</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a list of matches to only contain spans where the start token is followed by a new line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_end_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.filter_start_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Filter a list of matches to only contain spans where the start token is the beginning of a new line.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of match tuples (match_id, start, end) that meet the filter criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_start_lines</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a list of matches to only contain spans where the start token is the beginning of a new line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_start_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.register_default_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_default_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Register the default values for the Span attributes defined in <code>DEFAULT_ATTRIBUTES</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.set_assertion_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Add Span-level attributes to entities based on which section they occur in.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>spans</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Span">Span</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the spans to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_assertion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spans</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Span</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add Span-level attributes to entities based on which section they occur in.</span>

<span class="sd">    Args:</span>
<span class="sd">        spans: the spans to modify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span>
            <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span>
        <span class="p">):</span>
            <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">[</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.Sectionizer.set_parent_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Determine the legal parent-child section relationships from the list
of in-order sections of a document and the possible parents of each
section as specified during direction creation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sections</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of spacy match tuples found in the doc</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>smaller list than the input due to pruning with <code>parent_required</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_parent_sections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the legal parent-child section relationships from the list</span>
<span class="sd">    of in-order sections of a document and the possible parents of each</span>
<span class="sd">    section as specified during direction creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        sections: a list of spacy match tuples found in the doc</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</span>
<span class="sd">        and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</span>
<span class="sd">        smaller list than the input due to pruning with `parent_required`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sections_final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">removed_sections</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">category</span>
        <span class="n">required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">i_a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">removed_sections</span>  <span class="c1"># adjusted index for removed values</span>
        <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">identified_parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="c1"># go backwards through the section &quot;tree&quot; until you hit a root or the start of the list</span>
                <span class="n">candidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                <span class="n">candidates_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">candidates_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">candidates_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                            <span class="n">sections_final</span><span class="p">[</span><span class="n">candidates_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">candidates_parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">candidate_i</span> <span class="o">=</span> <span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">candidate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                        <span class="n">identified_parent</span> <span class="o">=</span> <span class="n">candidate_i</span>
                        <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># if you are at the end of the list... no parent</span>
                        <span class="k">if</span> <span class="n">candidate_i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                        <span class="c1"># if the current candidate has no parent... no parent exists</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates_parent</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                        <span class="c1"># otherwise get the previous item in the list</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                        <span class="n">temp_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">temp_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">temp_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                    <span class="n">sections_final</span><span class="p">[</span><span class="n">temp_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp_parent</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="c1"># if the previous item is the parent of the current item</span>
                        <span class="c1"># OR if the previous item is a sibling of the current item</span>
                        <span class="c1"># continue to search</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">temp</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                            <span class="ow">or</span> <span class="n">temp_parent</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                        <span class="p">):</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="n">temp</span>
                            <span class="n">candidates_parent</span> <span class="o">=</span> <span class="n">temp_parent</span>
                            <span class="n">candidate_i</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="c1"># otherwise, there is no further tree traversal</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># if a parent is required, then add</span>
            <span class="k">if</span> <span class="n">identified_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">required</span><span class="p">:</span>
                <span class="c1"># if the parent is identified, add section</span>
                <span class="c1"># if the parent is not required, add section</span>
                <span class="c1"># if parent is not identified and required, do not add the section</span>
                <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">identified_parent</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">sections_final</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>



<div class="doc doc-object doc-module">



<h3 id="medspacy.section_detection.section" class="doc doc-heading">
            <code>section</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.section_detection.section.Section" class="doc doc-heading">
            <code>Section</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>object</code></p>


        <p>Section is the object that stores the result of processing by the Sectionizer class. A Section contains information
describing the section's category, title span, body span, parent, and the rule that created it.</p>
<p>Section <code>category</code> is equivalent to <code>label_</code> in a basic spaCy entity. It is a normalized name for the section type
determined on initialization, either created manually or through the Sectionizer pipeline component.</p>
<p>Section title, defined with <code>title_start</code>, <code>title_end</code>, and <code>title_span</code> represents the section title or header
matched with the rule. In the text "Past medical history: stroke and high blood pressure", "Past medical history:"
would be the title.</p>
<p>Section body is defined with <code>body_start</code>, <code>body_end</code>, and <code>body_span</code>. It represents the text between the end of
the current section's title and the start of the title for the next Section or when scope is set in the rule or by
the Sectionizer. In the text "Past medical history: stroke and high blood pressure", "stroke and high blood
pressure" would be the body.</p>
<p>Parent is a string that represents the conceptual "parent" section in a section-&gt;subsection-&gt;subsubsection
hierarchy. Candidates are determined by category in the rule and matched at runtime.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Section is the object that stores the result of processing by the Sectionizer class. A Section contains information</span>
<span class="sd">    describing the section&#39;s category, title span, body span, parent, and the rule that created it.</span>

<span class="sd">    Section `category` is equivalent to `label_` in a basic spaCy entity. It is a normalized name for the section type</span>
<span class="sd">    determined on initialization, either created manually or through the Sectionizer pipeline component.</span>

<span class="sd">    Section title, defined with `title_start`, `title_end`, and `title_span` represents the section title or header</span>
<span class="sd">    matched with the rule. In the text &quot;Past medical history: stroke and high blood pressure&quot;, &quot;Past medical history:&quot;</span>
<span class="sd">    would be the title.</span>

<span class="sd">    Section body is defined with `body_start`, `body_end`, and `body_span`. It represents the text between the end of</span>
<span class="sd">    the current section&#39;s title and the start of the title for the next Section or when scope is set in the rule or by</span>
<span class="sd">    the Sectionizer. In the text &quot;Past medical history: stroke and high blood pressure&quot;, &quot;stroke and high blood</span>
<span class="sd">    pressure&quot; would be the body.</span>

<span class="sd">    Parent is a string that represents the conceptual &quot;parent&quot; section in a section-&gt;subsection-&gt;subsubsection</span>
<span class="sd">    hierarchy. Candidates are determined by category in the rule and matched at runtime.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">title_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">title_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">body_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">body_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Section object.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: A normalized name for the section. Equivalent to `label_` for basic spaCy entities.</span>
<span class="sd">            title_start: Index of the first token of the section title.</span>
<span class="sd">            title_end: Index of the last token of the section title.</span>
<span class="sd">            body_start: Index of the first token of the section body.</span>
<span class="sd">            body_end: Index of the last token of the section body.</span>
<span class="sd">            parent: The category of the parent section.</span>
<span class="sd">            rule: The SectionRule that generated the section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span> <span class="o">=</span> <span class="n">title_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span> <span class="o">=</span> <span class="n">title_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span> <span class="o">=</span> <span class="n">body_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span> <span class="o">=</span> <span class="n">body_end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Section(category=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="si">}</span><span class="s2"> in the doc with a body at &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="si">}</span><span class="s2"> based on the rule </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rule</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">title_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the section title.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start and end indexes of the section title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">body_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the section body.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start and end indexes of the section body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">section_span</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the span of the entire section, from title start to body end.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple (int,int) containing the start index of the section title and the end index of the section body.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialize the Section.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A json-serialized representation of the section.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
            <span class="s2">&quot;title_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span>
            <span class="s2">&quot;title_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="p">,</span>
            <span class="s2">&quot;body_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span>
            <span class="s2">&quot;body_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="p">,</span>
            <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the section from a json-serialized form.</span>

<span class="sd">        Args:</span>
<span class="sd">            serialized_representation: The dictionary form of the section object to load.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Section object containing the data from the dictionary provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">])</span>
        <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
            <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">serialized_representation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]}</span>
        <span class="p">)</span>
        <span class="n">section</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

        <span class="k">return</span> <span class="n">section</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.section.Section.body_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">body_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the span of the section body.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start and end indexes of the section body.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.section.Section.section_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the span of the entire section, from title start to body end.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start index of the section title and the end index of the section body.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.section.Section.title_span" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">title_span</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the span of the section title.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple (int,int) containing the start and end indexes of the section title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section.Section.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">title_start</span><span class="p">,</span> <span class="n">title_end</span><span class="p">,</span> <span class="n">body_start</span><span class="p">,</span> <span class="n">body_end</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Create a new Section object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A normalized name for the section. Equivalent to <code>label_</code> for basic spaCy entities.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the first token of the section title.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the last token of the section title.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body_start</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the first token of the section body.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>body_end</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Index of the last token of the section body.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category of the parent section.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rule</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SectionRule that generated the section.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">title_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">title_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">body_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">body_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Section object.</span>

<span class="sd">    Args:</span>
<span class="sd">        category: A normalized name for the section. Equivalent to `label_` for basic spaCy entities.</span>
<span class="sd">        title_start: Index of the first token of the section title.</span>
<span class="sd">        title_end: Index of the last token of the section title.</span>
<span class="sd">        body_start: Index of the first token of the section body.</span>
<span class="sd">        body_end: Index of the last token of the section body.</span>
<span class="sd">        parent: The category of the parent section.</span>
<span class="sd">        rule: The SectionRule that generated the section.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span> <span class="o">=</span> <span class="n">title_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span> <span class="o">=</span> <span class="n">title_end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span> <span class="o">=</span> <span class="n">body_start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span> <span class="o">=</span> <span class="n">body_end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section.Section.from_serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_serialized_representation</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Load the section from a json-serialized form.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>serialized_representation</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary form of the section object to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Section object containing the data from the dictionary provided.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_serialized_representation</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">serialized_representation</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the section from a json-serialized form.</span>

<span class="sd">    Args:</span>
<span class="sd">        serialized_representation: The dictionary form of the section object to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Section object containing the data from the dictionary provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">serialized_representation</span><span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">])</span>
    <span class="n">section</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">serialized_representation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rule&quot;</span><span class="p">]}</span>
    <span class="p">)</span>
    <span class="n">section</span><span class="o">.</span><span class="n">rule</span> <span class="o">=</span> <span class="n">rule</span>

    <span class="k">return</span> <span class="n">section</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section.Section.serialized_representation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">serialized_representation</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Serialize the Section.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A json-serialized representation of the section.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">serialized_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize the Section.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A json-serialized representation of the section.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
        <span class="s2">&quot;title_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_start</span><span class="p">,</span>
        <span class="s2">&quot;title_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_end</span><span class="p">,</span>
        <span class="s2">&quot;body_start&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_start</span><span class="p">,</span>
        <span class="s2">&quot;body_end&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_end</span><span class="p">,</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="s2">&quot;rule&quot;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">rule</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.section_detection.section_rule" class="doc doc-heading">
            <code>section_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.section_detection.section_rule.SectionRule" class="doc doc-heading">
            <code>SectionRule</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>SectionRule defines rules for extracting entities from text using the Sectionizer.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SectionRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SectionRule defines rules for extracting entities from text using the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parents&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_required&quot;</span><span class="p">,</span>
        <span class="s2">&quot;max_scope&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_required</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class for defining rules for extracting entities from text using TargetMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            max_scope: A number of tokens to explicitly limit the size of a section body. If None, the scope will</span>
<span class="sd">                include the entire doc up until either the next section header or the end of the doc. This variable can</span>
<span class="sd">                also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the</span>
<span class="sd">                rule scope will take precedence. If not None, this will be the number of tokens following the matched</span>
<span class="sd">                section header</span>
<span class="sd">                    Example:</span>
<span class="sd">                        In the text &quot;Past Medical History: Pt has hx of pneumonia&quot;,</span>
<span class="sd">                        SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=None) will include the entire doc, but</span>
<span class="sd">                        SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=2) will limit the section</span>
<span class="sd">                            to be &quot;Past Medical History: Pt has&quot;</span>
<span class="sd">                This can be useful for limiting certain sections which are known to be short or allowing others to be</span>
<span class="sd">                longer than the regular global max_scope.</span>
<span class="sd">            parents: A list of candidate parents for determining subsections</span>
<span class="sd">            parent_required: Whether a parent is required for the section to exist in the final output. If true and no</span>
<span class="sd">                parent is identified, the section will be removed.</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
        <span class="k">if</span> <span class="n">parent_required</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Jsonl file incorrectly formatted for pattern name </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;If parents are required, then at least one parent must be specified.&quot;</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span> <span class="o">=</span> <span class="n">parent_required</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: the .json file containing modifier rules</span>

<span class="sd">        Returns:</span>
<span class="sd">            section_rules: a list of SectionRule objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">section_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">section_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_rules&quot;</span><span class="p">]:</span>
            <span class="n">section_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">section_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a dictionary into a SectionRule list. Used when reading from a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: the dictionary to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            item: the SectionRule created from the dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{</span><span class="n">invalid_keys</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Must be one of: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            rule_dict: the dictionary containing the TargetRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SectionRule(literal=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&quot;, category=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, on_match=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">on_match</span><span class="si">}</span><span class="s2">, parents=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="si">}</span><span class="s2">, parent_required=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section_rule.SectionRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent_required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Class for defining rules for extracting entities from text using TargetMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]], str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_scope</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A number of tokens to explicitly limit the size of a section body. If None, the scope will
include the entire doc up until either the next section header or the end of the doc. This variable can
also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the
rule scope will take precedence. If not None, this will be the number of tokens following the matched
section header
    Example:
        In the text "Past Medical History: Pt has hx of pneumonia",
        SectionRule("Past Medical History:", "pmh", max_scope=None) will include the entire doc, but
        SectionRule("Past Medical History:", "pmh", max_scope=2) will limit the section
            to be "Past Medical History: Pt has"
This can be useful for limiting certain sections which are known to be short or allowing others to be
longer than the regular global max_scope.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parents</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of candidate parents for determining subsections</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_required</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether a parent is required for the section to exist in the final output. If true and no
parent is identified, the section will be removed.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parent_required</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for defining rules for extracting entities from text using TargetMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        max_scope: A number of tokens to explicitly limit the size of a section body. If None, the scope will</span>
<span class="sd">            include the entire doc up until either the next section header or the end of the doc. This variable can</span>
<span class="sd">            also be set at a global level as `Sectionizer(nlp, max_scope=...), but if the attribute is set here, the</span>
<span class="sd">            rule scope will take precedence. If not None, this will be the number of tokens following the matched</span>
<span class="sd">            section header</span>
<span class="sd">                Example:</span>
<span class="sd">                    In the text &quot;Past Medical History: Pt has hx of pneumonia&quot;,</span>
<span class="sd">                    SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=None) will include the entire doc, but</span>
<span class="sd">                    SectionRule(&quot;Past Medical History:&quot;, &quot;pmh&quot;, max_scope=2) will limit the section</span>
<span class="sd">                        to be &quot;Past Medical History: Pt has&quot;</span>
<span class="sd">            This can be useful for limiting certain sections which are known to be short or allowing others to be</span>
<span class="sd">            longer than the regular global max_scope.</span>
<span class="sd">        parents: A list of candidate parents for determining subsections</span>
<span class="sd">        parent_required: Whether a parent is required for the section to exist in the final output. If true and no</span>
<span class="sd">            parent is identified, the section will be removed.</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_scope</span> <span class="o">=</span> <span class="n">max_scope</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
    <span class="k">if</span> <span class="n">parent_required</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Jsonl file incorrectly formatted for pattern name </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;If parents are required, then at least one parent must be specified.&quot;</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_required</span> <span class="o">=</span> <span class="n">parent_required</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section_rule.SectionRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a SectionRule list. Used when reading from a json file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>item</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the SectionRule created from the dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a dictionary into a SectionRule list. Used when reading from a json file.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: the dictionary to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        item: the SectionRule created from the dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{</span><span class="n">invalid_keys</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Must be one of: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">SectionRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section_rule.SectionRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Read in a lexicon of modifiers from a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the .json file containing modifier rules</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>section_rules</code></td>            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of SectionRule objects</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: the .json file containing modifier rules</span>

<span class="sd">    Returns:</span>
<span class="sd">        section_rules: a list of SectionRule objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">section_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">section_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">section_data</span><span class="p">[</span><span class="s2">&quot;section_rules&quot;</span><span class="p">]:</span>
        <span class="n">section_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">section_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.section_rule.SectionRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>rule_dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary containing the TargetRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/section_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts TargetRules to a python dictionary. Used when writing section rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        rule_dict: the dictionary containing the TargetRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.section_detection.sectionizer" class="doc doc-heading">
            <code>sectionizer</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.section_detection.sectionizer.Sectionizer" class="doc doc-heading">
            <code>Sectionizer</code>


</h4>


    <div class="doc doc-contents ">


        <p>The Sectionizer will search for spans in the text which match section header rules, such as 'Past Medical History:'.
Sections will be represented in custom attributes as:
    category: A normalized title of the section. Example: 'past_medical_history'
    section_title: The Span of the doc which was matched as a section header.
        Example: 'Past Medical History:'
    section_span: The entire section of the note, starting with section_header and up until the end
        of the section, which will be either the start of the next section header of some pre-specified
        scope. Example: 'Past Medical History: Type II DM'</p>
<p>Section attributes will be registered for each Doc, Span, and Token in the following attributes:
    Doc.<em>.sections: A list of namedtuples of type Section with 4 elements:
        - section_title
        - section_header
        - section_parent
        - section_span.
    A Doc will also have attributes corresponding to lists of each
        (ie., Doc.</em>.section_titles, Doc.<em>.section_headers, Doc.</em>.section_parents, Doc.<em>.section_list)
    (Span|Token).</em>.section_title
    (Span|Token).<em>.section_header
    (Span|Token).</em>.section_parent
    (Span|Token)._.section_span</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Sectionizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Sectionizer will search for spans in the text which match section header rules, such as &#39;Past Medical History:&#39;.</span>
<span class="sd">    Sections will be represented in custom attributes as:</span>
<span class="sd">        category: A normalized title of the section. Example: &#39;past_medical_history&#39;</span>
<span class="sd">        section_title: The Span of the doc which was matched as a section header.</span>
<span class="sd">            Example: &#39;Past Medical History:&#39;</span>
<span class="sd">        section_span: The entire section of the note, starting with section_header and up until the end</span>
<span class="sd">            of the section, which will be either the start of the next section header of some pre-specified</span>
<span class="sd">            scope. Example: &#39;Past Medical History: Type II DM&#39;</span>

<span class="sd">    Section attributes will be registered for each Doc, Span, and Token in the following attributes:</span>
<span class="sd">        Doc._.sections: A list of namedtuples of type Section with 4 elements:</span>
<span class="sd">            - section_title</span>
<span class="sd">            - section_header</span>
<span class="sd">            - section_parent</span>
<span class="sd">            - section_span.</span>
<span class="sd">        A Doc will also have attributes corresponding to lists of each</span>
<span class="sd">            (ie., Doc._.section_titles, Doc._.section_headers, Doc._.section_parents, Doc._.section_list)</span>
<span class="sd">        (Span|Token)._.section_title</span>
<span class="sd">        (Span|Token)._.section_header</span>
<span class="sd">        (Span|Token)._.section_parent</span>
<span class="sd">        (Span|Token)._.section_span</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
        <span class="n">max_section_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">require_start_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">require_end_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">newline_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\n\r]+[\s]*$&quot;</span><span class="p">,</span>
        <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
        <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">apply_sentence_boundary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new Sectionizer component.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A SpaCy Language object.</span>
<span class="sd">            name: The name of the component.</span>
<span class="sd">            rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">                SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules</span>
<span class="sd">                are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through</span>
<span class="sd">                `Sectionizer.add`.</span>
<span class="sd">            language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">                and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">                Default is &quot;en&quot; for English.</span>
<span class="sd">            max_section_length: Optional argument specifying the maximum number of tokens following a section header</span>
<span class="sd">                which can be included in a section body. This can be useful if you think your section rules are</span>
<span class="sd">                incomplete and want to prevent sections from running too long in the note. Default is None, meaning that</span>
<span class="sd">                the scope of a section will be until either the next section header or the end of the document.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            require_start_line: Optionally require a section header to start on a new line. Default False.</span>
<span class="sd">            require_end_line: Optionally require a section header to end with a new line. Default False.</span>
<span class="sd">            newline_pattern: Regular expression to match the new line either preceding or following a header</span>
<span class="sd">                if either require_start_line or require_end_line are True. Default is r&quot;[\n\r]+[\s]*$&quot;</span>
<span class="sd">            span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">                `DEFAULT_ATTRIBUTES`. If a dictionary of custom attributes, format is a dictionary mapping section</span>
<span class="sd">                categories to a dictionary containing the attribute name and the value to set the attribute to when a</span>
<span class="sd">                span is contained in a section of that category. Custom attributes must be assigned with</span>
<span class="sd">                `Span.set_extension` before creating the Sectionizer. If None, sectionizer will not modify span</span>
<span class="sd">                attributes.</span>
<span class="sd">            input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for spans when modifying attributes of spans</span>
<span class="sd">                contained in a section if `span_attrs` is not None. &quot;ents&quot; will modify attributes of spans in doc.ents.</span>
<span class="sd">                &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">            span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">            apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures</span>
<span class="sd">                the section header is considered its own sentence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="o">=</span> <span class="n">max_section_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span> <span class="o">=</span> <span class="n">require_start_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span> <span class="o">=</span> <span class="n">require_end_line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span> <span class="o">=</span> <span class="n">apply_sentence_boundary</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
            <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;section_patterns.json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRS</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                        <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SectionRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets list of rules associated with the Sectionizer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of SectionRules associated with the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">section_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a list of categories used in the Sectionizer.</span>

<span class="sd">        Returns:</span>
<span class="sd">                The list of all section categories available to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The input source of entities for the component. Must be either &quot;ents&quot; corresponding to doc.ents or &quot;group&quot; for</span>
<span class="sd">        a spaCy span group.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The input type, &quot;ents&quot; or &quot;group&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span>

    <span class="nd">@input_span_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_span_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;input_type must be &quot;ents&quot; or &quot;group&quot;.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `input_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        use spans in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
                <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds SectionRules to the Sectionizer.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single SectionRule or a collection of SectionRules to add to the Sectionizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be type SectionRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parents</span>
            <span class="n">parent_required</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parent_required</span>
            <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Merging parents. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;If this is not intended, please specify distinct titles.&quot;</span><span class="p">,</span>
                        <span class="ne">RuntimeWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">parent_required</span>
            <span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has different parent_required option. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Setting parent_required to False.&quot;</span><span class="p">,</span>
                    <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_required</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_parent_sections</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the legal parent-child section relationships from the list</span>
<span class="sd">        of in-order sections of a document and the possible parents of each</span>
<span class="sd">        section as specified during direction creation.</span>

<span class="sd">        Args:</span>
<span class="sd">            sections: a list of spacy match tuples found in the doc</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</span>
<span class="sd">            and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</span>
<span class="sd">            smaller list than the input due to pruning with `parent_required`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sections_final</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">removed_sections</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">category</span>
            <span class="n">required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">i_a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">removed_sections</span>  <span class="c1"># adjusted index for removed values</span>
            <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">identified_parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                    <span class="c1"># go backwards through the section &quot;tree&quot; until you hit a root or the start of the list</span>
                    <span class="n">candidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                    <span class="n">candidates_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">candidates_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">candidates_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                <span class="n">sections_final</span><span class="p">[</span><span class="n">candidates_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">candidates_parent</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">candidate_i</span> <span class="o">=</span> <span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="n">candidate</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                            <span class="n">identified_parent</span> <span class="o">=</span> <span class="n">candidate_i</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># if you are at the end of the list... no parent</span>
                            <span class="k">if</span> <span class="n">candidate_i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">continue</span>
                            <span class="c1"># if the current candidate has no parent... no parent exists</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates_parent</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">continue</span>
                            <span class="c1"># otherwise get the previous item in the list</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                    <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                            <span class="n">temp_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">temp_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">temp_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                        <span class="n">sections_final</span><span class="p">[</span><span class="n">temp_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="p">]</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp_parent</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="c1"># if the previous item is the parent of the current item</span>
                            <span class="c1"># OR if the previous item is a sibling of the current item</span>
                            <span class="c1"># continue to search</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">temp</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                                <span class="ow">or</span> <span class="n">temp_parent</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                            <span class="p">):</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="n">temp</span>
                                <span class="n">candidates_parent</span> <span class="o">=</span> <span class="n">temp_parent</span>
                                <span class="n">candidate_i</span> <span class="o">-=</span> <span class="mi">1</span>
                            <span class="c1"># otherwise, there is no further tree traversal</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># if a parent is required, then add</span>
                <span class="k">if</span> <span class="n">identified_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">required</span><span class="p">:</span>
                    <span class="c1"># if the parent is identified, add section</span>
                    <span class="c1"># if the parent is not required, add section</span>
                    <span class="c1"># if parent is not identified and required, do not add the section</span>
                    <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">identified_parent</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sections_final</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_assertion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spans</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Span</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add Span-level attributes to entities based on which section they occur in.</span>

<span class="sd">        Args:</span>
<span class="sd">            spans: the spans to modify.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span>
                <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span>
            <span class="p">):</span>
                <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">[</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any</span>
<span class="sd">        section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections</span>
<span class="sd">        the entities spans in.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The processed spaCy Doc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

        <span class="c1"># If this has already been processed by the sectionizer, reset the sections</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if there were no matches, return the doc as one section</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">doc</span>

        <span class="n">section_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if the first match does not begin at token 0, handle the first section</span>
        <span class="n">first_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># handle section spans</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">parent_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>
                <span class="k">if</span> <span class="n">parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="n">section_list</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># IDEs will warn here about match shape disagreeing w/ type hinting, but this if is only used if</span>
                <span class="c1"># parent sections were never set, so parent_idx does not exist</span>
                <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>

            <span class="c1"># Make section header its own sentence</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span><span class="p">:</span>
                <span class="c1"># Section headers should be considered the start of a sentence</span>
                <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># Text following the header should also be considered a new sentence</span>
                <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
                    <span class="n">doc</span><span class="p">[</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
            <span class="c1"># If this is the last match, it should include the rest of the doc</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># If there is no scope limitation, go until the end of the doc</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If the rule has a max_scope, use that as a precedence</span>
                    <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="c1"># Otherwise, go until the next section header</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                    <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">section_span</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
                <span class="n">token</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">section</span>

        <span class="c1"># If it is specified to add assertion attributes,</span>
        <span class="c1"># iterate through the entities in doc and add them</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">doc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_start_lines</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter a list of matches to only contain spans where the start token is the beginning of a new line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_start_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_end_lines</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filter a list of matches to only contain spans where the start token is followed by a new line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_end_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.sectionizer.Sectionizer.input_span_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_span_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The input source of entities for the component. Must be either "ents" corresponding to doc.ents or "group" for
a spaCy span group.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input type, "ents" or "group".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.sectionizer.Sectionizer.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets list of rules associated with the Sectionizer.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.section_detection.section_rule.SectionRule" href="#medspacy.section_detection.section_rule.SectionRule">SectionRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of SectionRules associated with the Sectionizer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.sectionizer.Sectionizer.section_categories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">section_categories</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets a list of categories used in the Sectionizer.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Set">Set</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of all section categories available to the Sectionizer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.section_detection.sectionizer.Sectionizer.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>input_type</code> is "group", calling this component will
use spans in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any
section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections
the entities spans in.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The processed spaCy Doc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call the Sectionizer on a spaCy doc. Sectionizer will identify sections using provided rules, then evaluate any</span>
<span class="sd">    section hierarchy as needed, create section spans, and modify attributes on existing spans based on the sections</span>
<span class="sd">    the entities spans in.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The processed spaCy Doc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">:</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>

    <span class="c1"># If this has already been processed by the sectionizer, reset the sections</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if there were no matches, return the doc as one section</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">doc</span>

    <span class="n">section_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># if the first match does not begin at token 0, handle the first section</span>
    <span class="n">first_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_match</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># handle section spans</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">parent_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">if</span> <span class="n">parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="n">section_list</span><span class="p">[</span><span class="n">parent_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># IDEs will warn here about match shape disagreeing w/ type hinting, but this if is only used if</span>
            <span class="c1"># parent sections were never set, so parent_idx does not exist</span>
            <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">match</span>

        <span class="c1"># Make section header its own sentence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span><span class="p">:</span>
            <span class="c1"># Section headers should be considered the start of a sentence</span>
            <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Text following the header should also be considered a new sentence</span>
            <span class="k">if</span> <span class="n">end</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
                <span class="n">doc</span><span class="p">[</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">sent_start</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
        <span class="c1"># If this is the last match, it should include the rest of the doc</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># If there is no scope limitation, go until the end of the doc</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If the rule has a max_scope, use that as a precedence</span>
                <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="c1"># Otherwise, go until the next section header</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">next_match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">next_match</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">next_start</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="n">rule</span><span class="o">.</span><span class="n">max_scope</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scope_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span><span class="p">,</span> <span class="n">next_start</span><span class="p">)</span>
                <span class="n">section_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Section</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope_end</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">:</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">section_span</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span> <span class="o">=</span> <span class="n">section</span>

    <span class="c1"># If it is specified to add assertion attributes,</span>
    <span class="c1"># iterate through the entities in doc and add them</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_sectionizer&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">max_section_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">require_start_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">require_end_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">newline_pattern</span><span class="o">=</span><span class="s1">&#39;[</span><span class="se">\\</span><span class="s1">n</span><span class="se">\\</span><span class="s1">r]+[</span><span class="se">\\</span><span class="s1">s]*$&#39;</span><span class="p">,</span> <span class="n">input_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="n">span_attrs</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">apply_sentence_boundary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <pre><code>   Create a new Sectionizer component.

   Args:
       nlp: A SpaCy Language object.
       name: The name of the component.
       rules: The rules to load. Default is "default", loads rules packaged with medspaCy that are derived from
           SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules
           are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through
           `Sectionizer.add`.
       language_code: Language code to use (ISO code) as a default for loading resources.  See documentation
           and also the /resources directory to see which resources might be available in each language.
           Default is "en" for English.
       max_section_length: Optional argument specifying the maximum number of tokens following a section header
           which can be included in a section body. This can be useful if you think your section rules are
           incomplete and want to prevent sections from running too long in the note. Default is None, meaning that
           the scope of a section will be until either the next section header or the end of the document.
       phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default
           is 'LOWER'.
       require_start_line: Optionally require a section header to start on a new line. Default False.
       require_end_line: Optionally require a section header to end with a new line. Default False.
       newline_pattern: Regular expression to match the new line either preceding or following a header
           if either require_start_line or require_end_line are True. Default is r"[
</code></pre>
<p>]+[\s]*$"
           span_attrs: The optional span attributes to modify. Default option "default" uses attributes in
               <code>DEFAULT_ATTRIBUTES</code>. If a dictionary of custom attributes, format is a dictionary mapping section
               categories to a dictionary containing the attribute name and the value to set the attribute to when a
               span is contained in a section of that category. Custom attributes must be assigned with
               <code>Span.set_extension</code> before creating the Sectionizer. If None, sectionizer will not modify span
               attributes.
           input_span_type: "ents" or "group". Where to look for spans when modifying attributes of spans
               contained in a section if <code>span_attrs</code> is not None. "ents" will modify attributes of spans in doc.ents.
               "group" will modify attributes of spans in the span group specified by <code>span_group_name</code>.
           span_group_name: The name of the span group used when <code>input_span_type</code> is "group". Default is
               "medspacy_spans".
           apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures
               the section header is considered its own sentence.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
    <span class="n">max_section_length</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">require_start_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">require_end_line</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">newline_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\n\r]+[\s]*$&quot;</span><span class="p">,</span>
    <span class="n">input_span_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="n">span_attrs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">apply_sentence_boundary</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new Sectionizer component.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A SpaCy Language object.</span>
<span class="sd">        name: The name of the component.</span>
<span class="sd">        rules: The rules to load. Default is &quot;default&quot;, loads rules packaged with medspaCy that are derived from</span>
<span class="sd">            SecTag, MIMIC-III, and practical refinement at the US Department of Veterans Affairs. If None, no rules</span>
<span class="sd">            are loaded. Otherwise, must be a path to a json file containing rules. Add SectionRules directly through</span>
<span class="sd">            `Sectionizer.add`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        max_section_length: Optional argument specifying the maximum number of tokens following a section header</span>
<span class="sd">            which can be included in a section body. This can be useful if you think your section rules are</span>
<span class="sd">            incomplete and want to prevent sections from running too long in the note. Default is None, meaning that</span>
<span class="sd">            the scope of a section will be until either the next section header or the end of the document.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        require_start_line: Optionally require a section header to start on a new line. Default False.</span>
<span class="sd">        require_end_line: Optionally require a section header to end with a new line. Default False.</span>
<span class="sd">        newline_pattern: Regular expression to match the new line either preceding or following a header</span>
<span class="sd">            if either require_start_line or require_end_line are True. Default is r&quot;[\n\r]+[\s]*$&quot;</span>
<span class="sd">        span_attrs: The optional span attributes to modify. Default option &quot;default&quot; uses attributes in</span>
<span class="sd">            `DEFAULT_ATTRIBUTES`. If a dictionary of custom attributes, format is a dictionary mapping section</span>
<span class="sd">            categories to a dictionary containing the attribute name and the value to set the attribute to when a</span>
<span class="sd">            span is contained in a section of that category. Custom attributes must be assigned with</span>
<span class="sd">            `Span.set_extension` before creating the Sectionizer. If None, sectionizer will not modify span</span>
<span class="sd">            attributes.</span>
<span class="sd">        input_span_type: &quot;ents&quot; or &quot;group&quot;. Where to look for spans when modifying attributes of spans</span>
<span class="sd">            contained in a section if `span_attrs` is not None. &quot;ents&quot; will modify attributes of spans in doc.ents.</span>
<span class="sd">            &quot;group&quot; will modify attributes of spans in the span group specified by `span_group_name`.</span>
<span class="sd">        span_group_name: The name of the span group used when `input_span_type` is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">        apply_sentence_boundary: Optionally end sentence before and after section header boundary. This ensures</span>
<span class="sd">            the section header is considered its own sentence.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_section_length</span> <span class="o">=</span> <span class="n">max_section_length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">require_start_line</span> <span class="o">=</span> <span class="n">require_start_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">require_end_line</span> <span class="o">=</span> <span class="n">require_end_line</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_input_span_type</span> <span class="o">=</span> <span class="n">input_span_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_apply_sentence_boundary</span> <span class="o">=</span> <span class="n">apply_sentence_boundary</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="s2">&quot;resources&quot;</span><span class="p">,</span>
        <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="s2">&quot;section_patterns.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">rule_path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">rules</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_RULES_FILEPATH</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rule_path</span> <span class="o">=</span> <span class="n">rules</span>

    <span class="k">if</span> <span class="n">rule_path</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SectionRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rule_path</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">span_attrs</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">DEFAULT_ATTRS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_default_attributes</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">span_attrs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="n">span_attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">Span</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Custom extension </span><span class="si">{</span><span class="n">attr_name</span><span class="si">}</span><span class="s2"> has not been set. Please ensure Span.set_extension is &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;called for your pipeline&#39;s custom extensions.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span> <span class="o">=</span> <span class="n">span_attrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds SectionRules to the Sectionizer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single SectionRule or a collection of SectionRules to add to the Sectionizer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds SectionRules to the Sectionizer.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single SectionRule or a collection of SectionRules to add to the Sectionizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">SectionRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be type SectionRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parents</span>
        <span class="n">parent_required</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">parent_required</span>
        <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. Merging parents. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;If this is not intended, please specify distinct titles.&quot;</span><span class="p">,</span>
                    <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">parent_required</span>
        <span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Duplicate section title </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> has different parent_required option. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Setting parent_required to False.&quot;</span><span class="p">,</span>
                <span class="ne">RuntimeWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_required</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.filter_end_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_end_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Filter a list of matches to only contain spans where the start token is followed by a new line.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of match tuples (match_id, start, end) that meet the filter criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_end_lines</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a list of matches to only contain spans where the start token is followed by a new line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_end_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.filter_start_lines" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_start_lines</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Filter a list of matches to only contain spans where the start token is the beginning of a new line.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of match tuples (match_id, start, end) that meet the filter criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_start_lines</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">matches</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filter a list of matches to only contain spans where the start token is the beginning of a new line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of match tuples (match_id, start, end) that meet the filter criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">util</span><span class="o">.</span><span class="n">is_start_line</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">doc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline_pattern</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.register_default_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_default_attributes</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Register the default values for the Span attributes defined in <code>DEFAULT_ATTRIBUTES</code>.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register_default_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register the default values for the Span attributes defined in `DEFAULT_ATTRIBUTES`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;is_negated&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_uncertain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_historical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_hypothetical&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_family&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Span</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Extension already set</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.set_assertion_attributes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_assertion_attributes</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Add Span-level attributes to entities based on which section they occur in.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>spans</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="spacy.tokens.Span">Span</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the spans to modify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_assertion_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spans</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Span</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add Span-level attributes to entities based on which section they occur in.</span>

<span class="sd">    Args:</span>
<span class="sd">        spans: the spans to modify.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span>
            <span class="ow">and</span> <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span>
        <span class="p">):</span>
            <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertion_attributes_mapping</span><span class="p">[</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">section</span><span class="o">.</span><span class="n">category</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.section_detection.sectionizer.Sectionizer.set_parent_sections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_parent_sections</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Determine the legal parent-child section relationships from the list
of in-order sections of a document and the possible parents of each
section as specified during direction creation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sections</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of spacy match tuples found in the doc</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int, int]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>smaller list than the input due to pruning with <code>parent_required</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/sectionizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_parent_sections</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the legal parent-child section relationships from the list</span>
<span class="sd">    of in-order sections of a document and the possible parents of each</span>
<span class="sd">    section as specified during direction creation.</span>

<span class="sd">    Args:</span>
<span class="sd">        sections: a list of spacy match tuples found in the doc</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples (match_id, start, end, parent_idx) where the first three indices are the same as the input</span>
<span class="sd">        and the added parent_idx represents the index in the list that corresponds to the parent section. Might be a</span>
<span class="sd">        smaller list than the input due to pruning with `parent_required`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sections_final</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">removed_sections</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sections</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">match_id</span><span class="p">]]</span><span class="o">.</span><span class="n">category</span>
        <span class="n">required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_required</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">i_a</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">removed_sections</span>  <span class="c1"># adjusted index for removed values</span>
        <span class="k">if</span> <span class="n">required</span> <span class="ow">and</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">i_a</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_sections</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">identified_parent</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
                <span class="c1"># go backwards through the section &quot;tree&quot; until you hit a root or the start of the list</span>
                <span class="n">candidate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                <span class="n">candidates_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">candidates_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">candidates_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                            <span class="n">sections_final</span><span class="p">[</span><span class="n">candidates_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="p">]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">candidates_parent</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">candidate_i</span> <span class="o">=</span> <span class="n">i_a</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="n">candidate</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">candidate</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                        <span class="n">identified_parent</span> <span class="o">=</span> <span class="n">candidate_i</span>
                        <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># if you are at the end of the list... no parent</span>
                        <span class="k">if</span> <span class="n">candidate_i</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                        <span class="c1"># if the current candidate has no parent... no parent exists</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates_parent</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">continue</span>
                        <span class="c1"># otherwise get the previous item in the list</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="p">]</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                        <span class="n">temp_parent_idx</span> <span class="o">=</span> <span class="n">sections_final</span><span class="p">[</span><span class="n">candidate_i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">temp_parent_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">temp_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span>
                                    <span class="n">sections_final</span><span class="p">[</span><span class="n">temp_parent_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="p">]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">category</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp_parent</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="c1"># if the previous item is the parent of the current item</span>
                        <span class="c1"># OR if the previous item is a sibling of the current item</span>
                        <span class="c1"># continue to search</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">temp</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                            <span class="ow">or</span> <span class="n">temp_parent</span> <span class="o">==</span> <span class="n">candidates_parent</span>
                        <span class="p">):</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="n">temp</span>
                            <span class="n">candidates_parent</span> <span class="o">=</span> <span class="n">temp_parent</span>
                            <span class="n">candidate_i</span> <span class="o">-=</span> <span class="mi">1</span>
                        <span class="c1"># otherwise, there is no further tree traversal</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">candidate</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># if a parent is required, then add</span>
            <span class="k">if</span> <span class="n">identified_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">required</span><span class="p">:</span>
                <span class="c1"># if the parent is identified, add section</span>
                <span class="c1"># if the parent is not required, add section</span>
                <span class="c1"># if parent is not identified and required, do not add the section</span>
                <span class="n">sections_final</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">match_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">identified_parent</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">removed_sections</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">sections_final</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.section_detection.util" class="doc doc-heading">
            <code>util</code>


</h3>

    <div class="doc doc-contents ">

        <p>This module will contain helper functions and classes for common clinical processing tasks
which will be used in medspaCy's sectionizer.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.util.is_end_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_end_line</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check whether the token at idx occurs at the end of the line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token index to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The doc to check in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="re.Pattern">Pattern</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newline pattern to check with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the token occurs at the end of a line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_end_line</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the token at idx occurs at the end of the line.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx: The token index to check.</span>
<span class="sd">        doc: The doc to check in.</span>
<span class="sd">        pattern: The newline pattern to check with.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the token occurs at the end of a line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If it&#39;s the end of the doc, return True</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># Check if either the token has trailing newlines,</span>
    <span class="c1"># or if the next token is a newline</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">text_with_ws</span>
    <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="n">following_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text_with_ws</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">following_text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.section_detection.util.is_start_line" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_start_line</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Check whether the token at idx occurs at the start of the line.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>idx</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token index to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The doc to check in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="re.Pattern">Pattern</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newline pattern to check with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the token occurs at the start of a line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/section_detection/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_start_line</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the token at idx occurs at the start of the line.</span>

<span class="sd">    Args:</span>
<span class="sd">        idx: The token index to check.</span>
<span class="sd">        doc: The doc to check in.</span>
<span class="sd">        pattern: The newline pattern to check with.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the token occurs at the start of a line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If it&#39;s the start of the doc, return True</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Otherwise, check if the preceding token ends with newlines</span>
    <span class="n">preceding_text</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text_with_ws</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">preceding_text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.sentence_splitting" class="doc doc-heading">
            <code>sentence_splitting</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.sentence_splitting.PySBDSentenceSplitter" class="doc doc-heading">
            <code>PySBDSentenceSplitter</code>


</h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/sentence_splitting.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_pysbd&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PySBDSentenceSplitter</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">nlp</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seg</span> <span class="o">=</span> <span class="n">pysbd</span><span class="o">.</span><span class="n">Segmenter</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="n">clean</span><span class="p">,</span> <span class="n">char_span</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spacy component based on: https://github.com/nipunsadvilkar/pySBD improved to work with spacy 3.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sents_char_spans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">)</span>
        <span class="n">start_token_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents_char_spans</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">is_sent_start</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">idx</span> <span class="ow">in</span> <span class="n">start_token_ids</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.sentence_splitting.PySBDSentenceSplitter.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Spacy component based on: https://github.com/nipunsadvilkar/pySBD improved to work with spacy 3.0</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/sentence_splitting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spacy component based on: https://github.com/nipunsadvilkar/pySBD improved to work with spacy 3.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sents_char_spans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">text_with_ws</span><span class="p">)</span>
    <span class="n">start_token_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="o">.</span><span class="n">start</span> <span class="k">for</span> <span class="n">sent</span> <span class="ow">in</span> <span class="n">sents_char_spans</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">token</span><span class="o">.</span><span class="n">is_sent_start</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">idx</span> <span class="ow">in</span> <span class="n">start_token_ids</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.target_matcher" class="doc doc-heading">
            <code>target_matcher</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="medspacy.target_matcher.concept_tagger" class="doc doc-heading">
            <code>concept_tagger</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.target_matcher.concept_tagger.ConceptTagger" class="doc doc-heading">
            <code>ConceptTagger</code>


</h4>


    <div class="doc doc-contents ">


        <p>ConceptTagger is a component for setting an attribute on tokens contained in spans extracted by TargetRules. This
can be used for tasks such as semantic labeling or for normalizing tokens, making downstream extraction simpler.</p>
<p>A common use case is when a single concept can have many synonyms or variants and downstream rules would be
simplified by matching on a unified token tag for those synonyms rather than including the entire synonym list in
each downstream rule.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/target_matcher/concept_tagger.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_concept_tagger&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ConceptTagger</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ConceptTagger is a component for setting an attribute on tokens contained in spans extracted by TargetRules. This</span>
<span class="sd">    can be used for tasks such as semantic labeling or for normalizing tokens, making downstream extraction simpler.</span>

<span class="sd">    A common use case is when a single concept can have many synonyms or variants and downstream rules would be</span>
<span class="sd">    simplified by matching on a unified token tag for those synonyms rather than including the entire synonym list in</span>
<span class="sd">    each downstream rule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_concept_tagger&quot;</span><span class="p">,</span>
        <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;concept_tag&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new ConceptTagger.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A spaCy Language model.</span>
<span class="sd">            name: The name of the ConceptTagger component. Must be a valid python variable name.</span>
<span class="sd">            attr_name: The name of the attribute to set to tokens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attr_name</span> <span class="o">=</span> <span class="n">attr_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># If the token attribute hasn&#39;t been registered, add it now</span>
        <span class="c1"># If it has already been set, then we can pass.</span>
        <span class="c1"># This will happen, for example, if you&#39;ve already instantiated</span>
        <span class="c1"># the ConceptTagger and it registered the attribute.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Token</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
            <span class="n">Token</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">attr_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the attribute that will be set on each matched token.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The attribute name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr_name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a single TargetRule or a list of TargetRules to the ConceptTagger.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single TargetRule or a collection of TargetRules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call ConceptTagger on a doc. Matches spans and assigns attributes to all tokens contained in those spans, but</span>
<span class="sd">        does not preserve the spans themselves.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The spaCy Doc processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.target_matcher.concept_tagger.ConceptTagger.attr_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attr_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The name of the attribute that will be set on each matched token.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attribute name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.concept_tagger.ConceptTagger.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Call ConceptTagger on a doc. Matches spans and assigns attributes to all tokens contained in those spans, but
does not preserve the spans themselves.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc processed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/concept_tagger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call ConceptTagger on a doc. Matches spans and assigns attributes to all tokens contained in those spans, but</span>
<span class="sd">    does not preserve the spans themselves.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The spaCy Doc processed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rule_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.concept_tagger.ConceptTagger.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_concept_tagger&#39;</span><span class="p">,</span> <span class="n">attr_name</span><span class="o">=</span><span class="s1">&#39;concept_tag&#39;</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new ConceptTagger.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.language.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy Language model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the ConceptTagger component. Must be a valid python variable name.</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_concept_tagger&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attr_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the attribute to set to tokens.</p>
              </div>
            </td>
            <td>
                  <code>&#39;concept_tag&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/concept_tagger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_concept_tagger&quot;</span><span class="p">,</span>
    <span class="n">attr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;concept_tag&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new ConceptTagger.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A spaCy Language model.</span>
<span class="sd">        name: The name of the ConceptTagger component. Must be a valid python variable name.</span>
<span class="sd">        attr_name: The name of the attribute to set to tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_attr_name</span> <span class="o">=</span> <span class="n">attr_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># If the token attribute hasn&#39;t been registered, add it now</span>
    <span class="c1"># If it has already been set, then we can pass.</span>
    <span class="c1"># This will happen, for example, if you&#39;ve already instantiated</span>
    <span class="c1"># the ConceptTagger and it registered the attribute.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Token</span><span class="o">.</span><span class="n">has_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">):</span>
        <span class="n">Token</span><span class="o">.</span><span class="n">set_extension</span><span class="p">(</span><span class="n">attr_name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.concept_tagger.ConceptTagger.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds a single TargetRule or a list of TargetRules to the ConceptTagger.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>, <span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single TargetRule or a collection of TargetRules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/concept_tagger.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a single TargetRule or a list of TargetRules to the ConceptTagger.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single TargetRule or a collection of TargetRules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.target_matcher.target_matcher" class="doc doc-heading">
            <code>target_matcher</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.target_matcher.target_matcher.TargetMatcher" class="doc doc-heading">
            <code>TargetMatcher</code>


</h4>


    <div class="doc doc-contents ">


        <p>TargetMatcher is a component for advanced direction-based text extraction. Rules are defined using
<code>medspacy.target_matcher.TargetRule</code>.</p>
<p>A <code>TargetMatcher</code> will use the added <code>TargetRule</code> objects to identify matches in the text and apply labels or modify
attributes. It will either modify the input spaCy <code>Doc</code> with the result or return the spans as a list.</p>
<p>In addition to extracting spans of text and setting labels, TargetRules can also define setting custom attributes
and metadata. Additionally, each resulting span has an attribute span._.target_rule which maps a span to the
TargetRule which set it.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/target_matcher/target_matcher.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Language</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="s2">&quot;medspacy_target_matcher&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TargetMatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TargetMatcher is a component for advanced direction-based text extraction. Rules are defined using</span>
<span class="sd">    `medspacy.target_matcher.TargetRule`.</span>

<span class="sd">    A `TargetMatcher` will use the added `TargetRule` objects to identify matches in the text and apply labels or modify</span>
<span class="sd">    attributes. It will either modify the input spaCy `Doc` with the result or return the spans as a list.</span>

<span class="sd">    In addition to extracting spans of text and setting labels, TargetRules can also define setting custom attributes</span>
<span class="sd">    and metadata. Additionally, each resulting span has an attribute span._.target_rule which maps a span to the</span>
<span class="sd">    TargetRule which set it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_target_matcher&quot;</span><span class="p">,</span>
        <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
        <span class="n">result_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
        <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
        <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new TargetMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            nlp: A spaCy Language model.</span>
<span class="sd">            name: The name of the TargetMatcher component</span>
<span class="sd">            rules: An optional filepath containing a JSON of TargetRules. If None, then no rules will be added. Default</span>
<span class="sd">                None.</span>
<span class="sd">            phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">                is &#39;LOWER&#39;.</span>
<span class="sd">            result_type: &quot;ents&quot; (default), &quot;group&quot;, or None. Determines where TargetMatcher will put the matched spans.</span>
<span class="sd">                &quot;ents&quot; will add spans to doc.ents and add to any existing entities. If conflicts appear, existing</span>
<span class="sd">                entities will take precedence. &quot;group&quot; will add spans to doc.spans under the specified group name. None</span>
<span class="sd">                will return the list of spans rather than saving to the Doc.</span>
<span class="sd">            span_group_name: The name of the span group used to store results when result_type is &quot;group&quot;. Default is</span>
<span class="sd">                &quot;medspacy_spans&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span> <span class="o">=</span> <span class="n">result_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span> <span class="o">=</span> <span class="n">prune</span>

        <span class="k">if</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">TargetRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rules</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
            <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prune</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of TargetRules for the TargetMatcher.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of TargetRules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rules</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the list of labels for the TargetMatcher. Based on rules added to the TargetMatcher.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of all labels that the TargetMatcher can produce.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">labels</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">result_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The result type of the TargetMatcher. &quot;ents&quot; indicates that calling TargetMatcher will store the results in</span>
<span class="sd">        doc.ents, &quot;group&quot; indicates that the results will be stored in the span group indicated by `span_group_name`,</span>
<span class="sd">        and None indicates that spans will be returned in a list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The result type string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span>

    <span class="nd">@result_type</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">result_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">result_type</span> <span class="ow">or</span> <span class="n">result_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span> <span class="ow">or</span> <span class="n">result_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;result_type must be &quot;ents&quot;, &quot;group&quot; or None.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span> <span class="o">=</span> <span class="n">result_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The name of the span group used by this component. If `result_type` is &quot;group&quot;, calling this component will</span>
<span class="sd">        place results in the span group with this name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The span group name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span>

    <span class="nd">@span_group_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">span_group_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Span group name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a single TargetRule or a list of TargetRules to the TargetMatcher.</span>

<span class="sd">        Args:</span>
<span class="sd">            rules: A single TargetRule or a collection of TargetRules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">TargetRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">TargetRule</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be TargetRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls TargetMatcher on a Doc. By default and when `result_type` is &quot;ents&quot;, adds results to doc.ents. If</span>
<span class="sd">        `result_type` is &quot;group&quot;, adds results to the span group specified by `span_group_name`. If `result_type` is</span>
<span class="sd">        None, then returns a list of the matched Spans.</span>

<span class="sd">        Args:</span>
<span class="sd">            doc: The spaCy Doc to process.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Returns a modified `doc` when `TargetMatcher.result_type` is &quot;ents&quot; or &quot;group&quot;. Returns a list of</span>
<span class="sd">            `Span` objects if `TargetMatcher.result_type` is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]]</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
            <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">target_rule</span> <span class="o">=</span> <span class="n">rule</span>
            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">e</span>
            <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spans</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">+=</span> <span class="p">(</span><span class="n">span</span><span class="p">,)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="c1"># spaCy will raise a value error if the token in span are already part of an entity (i.e., as part</span>
                    <span class="c1"># of an upstream component). In that case, let the existing span supersede this one.</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;The result &quot;&quot;</span><span class="si">{</span><span class="n">span</span><span class="si">}</span><span class="s1">&quot;&quot; conflicts with a pre-existing entity in doc.ents. This result has been &#39;</span>
                        <span class="sa">f</span><span class="s2">&quot;skipped.&quot;</span><span class="p">,</span>
                        <span class="ne">RuntimeWarning</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="n">doc</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spans</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>
            <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">labels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the list of labels for the TargetMatcher. Based on rules added to the TargetMatcher.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Set">Set</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of all labels that the TargetMatcher can produce.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.result_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">result_type</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The result type of the TargetMatcher. "ents" indicates that calling TargetMatcher will store the results in
doc.ents, "group" indicates that the results will be stored in the span group indicated by <code>span_group_name</code>,
and None indicates that spans will be returned in a list.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[str, None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result type string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.rules" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rules</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Gets the list of TargetRules for the TargetMatcher.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of TargetRules.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.span_group_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">span_group_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>The name of the span group used by this component. If <code>result_type</code> is "group", calling this component will
place results in the span group with this name.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The span group name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Calls TargetMatcher on a Doc. By default and when <code>result_type</code> is "ents", adds results to doc.ents. If
<code>result_type</code> is "group", adds results to the span group specified by <code>span_group_name</code>. If <code>result_type</code> is
None, then returns a list of the matched Spans.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spaCy Doc to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="spacy.tokens.Doc">Doc</span>, <span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns a modified <code>doc</code> when <code>TargetMatcher.result_type</code> is "ents" or "group". Returns a list of</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="spacy.tokens.Doc">Doc</span>, <span title="typing.List">List</span>[<span title="spacy.tokens.Span">Span</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>Span</code> objects if <code>TargetMatcher.result_type</code> is None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Doc</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Span</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls TargetMatcher on a Doc. By default and when `result_type` is &quot;ents&quot;, adds results to doc.ents. If</span>
<span class="sd">    `result_type` is &quot;group&quot;, adds results to the span group specified by `span_group_name`. If `result_type` is</span>
<span class="sd">    None, then returns a list of the matched Spans.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spaCy Doc to process.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Returns a modified `doc` when `TargetMatcher.result_type` is &quot;ents&quot; or &quot;group&quot;. Returns a list of</span>
<span class="sd">        `Span` objects if `TargetMatcher.result_type` is None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rule_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">rule_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nlp</span><span class="o">.</span><span class="n">vocab</span><span class="o">.</span><span class="n">strings</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]]</span>
        <span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">)</span>
        <span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">target_rule</span> <span class="o">=</span> <span class="n">rule</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">span</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
        <span class="n">spans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">spans</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">ents</span> <span class="o">+=</span> <span class="p">(</span><span class="n">span</span><span class="p">,)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># spaCy will raise a value error if the token in span are already part of an entity (i.e., as part</span>
                <span class="c1"># of an upstream component). In that case, let the existing span supersede this one.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;The result &quot;&quot;</span><span class="si">{</span><span class="n">span</span><span class="si">}</span><span class="s1">&quot;&quot; conflicts with a pre-existing entity in doc.ents. This result has been &#39;</span>
                    <span class="sa">f</span><span class="s2">&quot;skipped.&quot;</span><span class="p">,</span>
                    <span class="ne">RuntimeWarning</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">doc</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">spans</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">spans</span>
        <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;medspacy_target_matcher&#39;</span><span class="p">,</span> <span class="n">rules</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span> <span class="n">result_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new TargetMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nlp</code>
            </td>
            <td>
                  <code><span title="spacy.language.Language">Language</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy Language model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the TargetMatcher component</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_target_matcher&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional filepath containing a JSON of TargetRules. If None, then no rules will be added. Default
None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phrase_matcher_attr</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token attribute to use for PhraseMatcher for rules where <code>pattern</code> is None. Default
is 'LOWER'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;LOWER&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>result_type</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[&#39;ents&#39;, &#39;group&#39;], None]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"ents" (default), "group", or None. Determines where TargetMatcher will put the matched spans.
"ents" will add spans to doc.ents and add to any existing entities. If conflicts appear, existing
entities will take precedence. "group" will add spans to doc.spans under the specified group name. None
will return the list of spans rather than saving to the Doc.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ents&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>span_group_name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the span group used to store results when result_type is "group". Default is
"medspacy_spans".</p>
              </div>
            </td>
            <td>
                  <code>&#39;medspacy_spans&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nlp</span><span class="p">:</span> <span class="n">Language</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_target_matcher&quot;</span><span class="p">,</span>
    <span class="n">rules</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">phrase_matcher_attr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;LOWER&quot;</span><span class="p">,</span>
    <span class="n">result_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="s2">&quot;group&quot;</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">,</span>
    <span class="n">prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new TargetMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        nlp: A spaCy Language model.</span>
<span class="sd">        name: The name of the TargetMatcher component</span>
<span class="sd">        rules: An optional filepath containing a JSON of TargetRules. If None, then no rules will be added. Default</span>
<span class="sd">            None.</span>
<span class="sd">        phrase_matcher_attr: The token attribute to use for PhraseMatcher for rules where `pattern` is None. Default</span>
<span class="sd">            is &#39;LOWER&#39;.</span>
<span class="sd">        result_type: &quot;ents&quot; (default), &quot;group&quot;, or None. Determines where TargetMatcher will put the matched spans.</span>
<span class="sd">            &quot;ents&quot; will add spans to doc.ents and add to any existing entities. If conflicts appear, existing</span>
<span class="sd">            entities will take precedence. &quot;group&quot; will add spans to doc.spans under the specified group name. None</span>
<span class="sd">            will return the list of spans rather than saving to the Doc.</span>
<span class="sd">        span_group_name: The name of the span group used to store results when result_type is &quot;group&quot;. Default is</span>
<span class="sd">            &quot;medspacy_spans&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlp</span> <span class="o">=</span> <span class="n">nlp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_result_type</span> <span class="o">=</span> <span class="n">result_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_prune</span> <span class="o">=</span> <span class="n">prune</span>

    <span class="k">if</span> <span class="n">rules</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">TargetRule</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">rules</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span> <span class="o">=</span> <span class="n">MedspacyMatcher</span><span class="p">(</span>
        <span class="n">nlp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">phrase_matcher_attr</span><span class="o">=</span><span class="n">phrase_matcher_attr</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prune</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_matcher.TargetMatcher.add" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Adds a single TargetRule or a list of TargetRules to the TargetMatcher.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rules</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>, <span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single TargetRule or a collection of TargetRules.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_matcher.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a single TargetRule or a list of TargetRules to the TargetMatcher.</span>

<span class="sd">    Args:</span>
<span class="sd">        rules: A single TargetRule or a collection of TargetRules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">TargetRule</span><span class="p">):</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">TargetRule</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rules must be TargetRule, not&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rule</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__matcher</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="medspacy.target_matcher.target_rule" class="doc doc-heading">
            <code>target_rule</code>


</h3>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h4 id="medspacy.target_matcher.target_rule.TargetRule" class="doc doc-heading">
            <code>TargetRule</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="medspacy.common.base_rule.BaseRule" href="#medspacy.common.base_rule.BaseRule">BaseRule</a></code></p>


        <p>TargetRule defines rules for extracting entities from text using the TargetMatcher.</p>






              <details class="quote">
                <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TargetRule</span><span class="p">(</span><span class="n">BaseRule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TargetRule defines rules for extracting entities from text using the TargetMatcher.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_ALLOWED_KEYS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pattern&quot;</span><span class="p">,</span>
        <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;attributes&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new TargetRule.</span>

<span class="sd">        Args:</span>
<span class="sd">            literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">                matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">                but can be used as a reference as the rule name.</span>
<span class="sd">            category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">            pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">                token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">                RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">                https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">            on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">                matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">            attributes: Optional custom attribute names to set for a Span matched by the direction. These attribute</span>
<span class="sd">                names are stored under Span._.[attribute_name]. For example, if `attributes={&#39;is_historical&#39;:True}`,</span>
<span class="sd">                then any spans matched by this direction will have span._.is_historical = True</span>
<span class="sd">            metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            filepath: the .json file containing modifier rules</span>

<span class="sd">        Returns:</span>
<span class="sd">            context_item: A list of ConTextRule objects.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If the dictionary contains any keys other than</span>
<span class="sd">                those accepted by ConTextRule.__init__</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">target_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">target_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">target_data</span><span class="p">[</span><span class="s2">&quot;target_rules&quot;</span><span class="p">]:</span>
            <span class="n">target_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TargetRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">target_rules</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetRule</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reads a dictionary into a ConTextRule. Used when reading from a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">            rule_dict: the dictionary to convert</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ConTextRule created from the dictionary</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if the json is invalid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">TargetRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rule</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_rules: a list of TargetRules that will be written to a file.</span>
<span class="sd">            filepath: the .json file to contain modifier rules</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;target_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">target_rules</span><span class="p">]}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts TargetRules to a python dictionary. Used when writing target rules to a json file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dictionary containing the TargetRule info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">rule_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;TargetRule(literal=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">literal</span><span class="si">}</span><span class="s2">&quot;, category=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="si">}</span><span class="s2">&quot;, pattern=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="si">}</span><span class="s2">, attributes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="si">}</span><span class="s2">, on_match=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">on_match</span><span class="si">}</span><span class="s2">)&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_rule.TargetRule.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">on_match</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Creates a new TargetRule.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>literal</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of a concept. If <code>pattern</code> is None, this string will be lower-cased and
matched to the lower-case string. If <code>pattern</code> is not None, this argument will not be used for matching
but can be used as a reference as the rule name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>category</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The semantic class of the matched span. This corresponds to the <code>label_</code> attribute of an entity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, str]], str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list or string to use as a spaCy pattern rather than <code>literal</code>. If a list, will use spaCy
token-based pattern matching to match using token attributes. If a string, will use medspaCy's
RegexMatcher. If None, will use <code>literal</code> as the pattern for phrase matching. For more information, see
https://spacy.io/usage/rule-based-matching.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_match</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<span title="spacy.matcher.Matcher">Matcher</span>, <span title="spacy.tokens.Doc">Doc</span>, int, <span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]]], <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional callback function or other callable which takes 4 arguments: <code>(matcher, doc, i,
matches)</code>. For more information, see https://spacy.io/usage/rule-based-matching#on_match</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attributes</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom attribute names to set for a Span matched by the direction. These attribute
names are stored under Span.<em>.[attribute_name]. For example, if <code>attributes={'is_historical':True}</code>,
then any spans matched by this direction will have span.</em>.is_historical = True</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dictionary of any extra metadata.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">literal</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_match</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">Matcher</span><span class="p">,</span> <span class="n">Doc</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a new TargetRule.</span>

<span class="sd">    Args:</span>
<span class="sd">        literal: The string representation of a concept. If `pattern` is None, this string will be lower-cased and</span>
<span class="sd">            matched to the lower-case string. If `pattern` is not None, this argument will not be used for matching</span>
<span class="sd">            but can be used as a reference as the rule name.</span>
<span class="sd">        category: The semantic class of the matched span. This corresponds to the `label_` attribute of an entity.</span>
<span class="sd">        pattern: A list or string to use as a spaCy pattern rather than `literal`. If a list, will use spaCy</span>
<span class="sd">            token-based pattern matching to match using token attributes. If a string, will use medspaCy&#39;s</span>
<span class="sd">            RegexMatcher. If None, will use `literal` as the pattern for phrase matching. For more information, see</span>
<span class="sd">            https://spacy.io/usage/rule-based-matching.</span>
<span class="sd">        on_match: An optional callback function or other callable which takes 4 arguments: `(matcher, doc, i,</span>
<span class="sd">            matches)`. For more information, see https://spacy.io/usage/rule-based-matching#on_match</span>
<span class="sd">        attributes: Optional custom attribute names to set for a Span matched by the direction. These attribute</span>
<span class="sd">            names are stored under Span._.[attribute_name]. For example, if `attributes={&#39;is_historical&#39;:True}`,</span>
<span class="sd">            then any spans matched by this direction will have span._.is_historical = True</span>
<span class="sd">        metadata: Optional dictionary of any extra metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">literal</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">on_match</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rule_id</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_rule.TargetRule.from_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">rule_dict</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Reads a dictionary into a ConTextRule. Used when reading from a json file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rule_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dictionary to convert</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ConTextRule created from the dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ValueError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the json is invalid</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rule_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TargetRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads a dictionary into a ConTextRule. Used when reading from a json file.</span>

<span class="sd">    Args:</span>
<span class="sd">        rule_dict: the dictionary to convert</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ConTextRule created from the dictionary</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: if the json is invalid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">rule_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">invalid_keys</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">invalid_keys</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;JSON object contains invalid keys: </span><span class="si">{0}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Must be one of: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalid_keys</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="n">TargetRule</span><span class="p">(</span><span class="o">**</span><span class="n">rule_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rule</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_rule.TargetRule.from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Read in a lexicon of modifiers from a JSON file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the .json file containing modifier rules</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>context_item</code></td>            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of ConTextRule objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>KeyError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the dictionary contains any keys other than
those accepted by ConTextRule.<strong>init</strong></p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read in a lexicon of modifiers from a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath: the .json file containing modifier rules</span>

<span class="sd">    Returns:</span>
<span class="sd">        context_item: A list of ConTextRule objects.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If the dictionary contains any keys other than</span>
<span class="sd">            those accepted by ConTextRule.__init__</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">target_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">target_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">target_data</span><span class="p">[</span><span class="s2">&quot;target_rules&quot;</span><span class="p">]:</span>
        <span class="n">target_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TargetRule</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">target_rules</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_rule.TargetRule.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Converts TargetRules to a python dictionary. Used when writing target rules to a json file.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary containing the TargetRule info.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts TargetRules to a python dictionary. Used when writing target rules to a json file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The dictionary containing the TargetRule info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rule_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ALLOWED_KEYS</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">rule_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="medspacy.target_matcher.target_rule.TargetRule.to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">target_rules</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>


    <div class="doc doc-contents ">

        <p>Writes ConTextItems to a json file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_rules</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="medspacy.target_matcher.target_rule.TargetRule" href="#medspacy.target_matcher.target_rule.TargetRule">TargetRule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of TargetRules that will be written to a file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the .json file to contain modifier rules</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/target_matcher/target_rule.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target_rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TargetRule</span><span class="p">],</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes ConTextItems to a json file.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_rules: a list of TargetRules that will be written to a file.</span>
<span class="sd">        filepath: the .json file to contain modifier rules</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;target_rules&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">target_rules</span><span class="p">]}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.util" class="doc doc-heading">
            <code>util</code>


</h2>

    <div class="doc doc-contents ">

        <p>This module will contain helper functions and classes for common clinical processing tasks
which will be used in many medspaCy components.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="medspacy.util._build_pipe_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_build_pipe_names</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Implement logic based on the pipenames defined in 'enable' and 'disable'. If enable and disable are both None,
then it will load the default pipenames. Otherwise, will allow custom selection of components.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>enable</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>"all" loads components from ALL_PIPE_NAMES. "default" loads components from DEFAULT_PIPE_NAMES.
Otherwise, loads he list of components as components.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disable</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Iterable">Iterable</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optional list of components to disable. Set difference of enable.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Set">Set</span>[str], <span title="typing.Set">Set</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A complete list of enabled and disabled components, with all components listed and empty intersection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_build_pipe_names</span><span class="p">(</span>
    <span class="n">enable</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">disable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement logic based on the pipenames defined in &#39;enable&#39; and &#39;disable&#39;. If enable and disable are both None,</span>
<span class="sd">    then it will load the default pipenames. Otherwise, will allow custom selection of components.</span>

<span class="sd">    Args:</span>
<span class="sd">        enable: &quot;all&quot; loads components from ALL_PIPE_NAMES. &quot;default&quot; loads components from DEFAULT_PIPE_NAMES.</span>
<span class="sd">            Otherwise, loads he list of components as components.</span>
<span class="sd">        disable: The optional list of components to disable. Set difference of enable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A complete list of enabled and disabled components, with all components listed and empty intersection.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">enable</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Enable cannot be none, please specify &#39;all&#39;, &#39;default&#39; or a list of components.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># cannot allow lists of enabled and disabled components, what happens if &quot;context&quot; is both enabled and disabled?</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">enable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="n">disable</span><span class="p">,</span> <span class="n">Iterable</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both enable and disable cannot be collections of components.&quot;</span><span class="p">)</span>

    <span class="c1"># set which components are enabled first</span>
    <span class="k">if</span> <span class="n">enable</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">enable</span> <span class="o">=</span> <span class="n">ALL_PIPE_NAMES</span>
    <span class="k">elif</span> <span class="n">enable</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">enable</span> <span class="o">=</span> <span class="n">DEFAULT_PIPE_NAMES</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>

    <span class="c1"># then find the difference with deactivated components</span>
    <span class="k">if</span> <span class="n">disable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enable</span> <span class="o">=</span> <span class="n">enable</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">disable</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">disable</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># otherwise disable is empty</span>

    <span class="k">return</span> <span class="n">enable</span><span class="p">,</span> <span class="n">disable</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.util.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">medspacy_enable</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">medspacy_disable</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">load_rules</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quickumls_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">model_kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load a spaCy language object with medSpaCy pipeline components.
By default, the base model will be a blank 'en' model with the
following components:
    - "medspacy_tokenizer": A customized, more aggressive tokenizer than the default spaCy tokenizer. This is set to
        <code>nlp.tokenizer</code> and is not loaded as a pipeline component.
    - "medspacy_pyrush": PyRuSH Sentencizer for sentence splitting
    - "medspacy_target_matcher": TargetMatcher for extended pattern matching
    - "medspacy_context": ConText for attribute assertion
    - "medspacy_quickumls": QuickUMLS for UMLS concept mapping
Args:
    model: The base spaCy model to load. If 'default', will instantiate from a blank 'en' model. If it is a spaCy
        language model, then it will simply add medspaCy components to the existing pipeline. If it is a string
        other than 'default', passes the string to spacy.load(model, **model_kwargs).
    medspacy_enable: Specifies which components to enable in the medspacy pipeline. If "default", will load all components
        found in <code>DEFAULT_PIPE_NAMES</code>. These represent the simplest components used in a clinical NLP pipeline:
        tokenization, sentence detection, concept identification, and ConText. If "all", all components in medspaCy
        will be loaded. If a collection of strings, the components specified will be loaded.
    medspacy_disable: A collection of component names to exclude. Requires "all" is the value for <code>enable</code>.
    language_code: Language code to use (ISO code) as a default for loading additional resources.  See documentation
        and also the /resources directory to see which resources might be available in each language.
        Default is "en" for English.
    load_rules: Whether to include default rules for available components. If True, sectionizer and context will
        both be loaded with default rules. Default is True.
    quickumls_path: Path to QuickUMLS dictionaries if it is included in the pipeline.
    model_kwargs: Optional model keyword arguments to pass to spacy.load().</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spaCy Language object containing the specified medspacy components.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Language</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">medspacy_enable</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">medspacy_disable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">language_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
    <span class="n">load_rules</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">quickumls_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">model_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a spaCy language object with medSpaCy pipeline components.</span>
<span class="sd">    By default, the base model will be a blank &#39;en&#39; model with the</span>
<span class="sd">    following components:</span>
<span class="sd">        - &quot;medspacy_tokenizer&quot;: A customized, more aggressive tokenizer than the default spaCy tokenizer. This is set to</span>
<span class="sd">            `nlp.tokenizer` and is not loaded as a pipeline component.</span>
<span class="sd">        - &quot;medspacy_pyrush&quot;: PyRuSH Sentencizer for sentence splitting</span>
<span class="sd">        - &quot;medspacy_target_matcher&quot;: TargetMatcher for extended pattern matching</span>
<span class="sd">        - &quot;medspacy_context&quot;: ConText for attribute assertion</span>
<span class="sd">        - &quot;medspacy_quickumls&quot;: QuickUMLS for UMLS concept mapping</span>
<span class="sd">    Args:</span>
<span class="sd">        model: The base spaCy model to load. If &#39;default&#39;, will instantiate from a blank &#39;en&#39; model. If it is a spaCy</span>
<span class="sd">            language model, then it will simply add medspaCy components to the existing pipeline. If it is a string</span>
<span class="sd">            other than &#39;default&#39;, passes the string to spacy.load(model, **model_kwargs).</span>
<span class="sd">        medspacy_enable: Specifies which components to enable in the medspacy pipeline. If &quot;default&quot;, will load all components</span>
<span class="sd">            found in `DEFAULT_PIPE_NAMES`. These represent the simplest components used in a clinical NLP pipeline:</span>
<span class="sd">            tokenization, sentence detection, concept identification, and ConText. If &quot;all&quot;, all components in medspaCy</span>
<span class="sd">            will be loaded. If a collection of strings, the components specified will be loaded.</span>
<span class="sd">        medspacy_disable: A collection of component names to exclude. Requires &quot;all&quot; is the value for `enable`.</span>
<span class="sd">        language_code: Language code to use (ISO code) as a default for loading additional resources.  See documentation</span>
<span class="sd">            and also the /resources directory to see which resources might be available in each language.</span>
<span class="sd">            Default is &quot;en&quot; for English.</span>
<span class="sd">        load_rules: Whether to include default rules for available components. If True, sectionizer and context will</span>
<span class="sd">            both be loaded with default rules. Default is True.</span>
<span class="sd">        quickumls_path: Path to QuickUMLS dictionaries if it is included in the pipeline.</span>
<span class="sd">        model_kwargs: Optional model keyword arguments to pass to spacy.load().</span>

<span class="sd">    Returns:</span>
<span class="sd">        A spaCy Language object containing the specified medspacy components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">medspacy_enable</span><span class="p">,</span> <span class="n">medspacy_disable</span> <span class="o">=</span> <span class="n">_build_pipe_names</span><span class="p">(</span>
        <span class="n">medspacy_enable</span><span class="p">,</span> <span class="n">medspacy_disable</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
        <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Language</span><span class="p">):</span>
        <span class="n">nlp</span> <span class="o">=</span> <span class="n">model</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">model_kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;model must be either &#39;default&#39; or an actual spaCy Language object, not &quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_tokenizer&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.custom_tokenizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_medspacy_tokenizer</span>

        <span class="n">medspacy_tokenizer</span> <span class="o">=</span> <span class="n">create_medspacy_tokenizer</span><span class="p">(</span><span class="n">nlp</span><span class="p">)</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">medspacy_tokenizer</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_preprocessor&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.preprocess</span><span class="w"> </span><span class="kn">import</span> <span class="n">Preprocessor</span>

        <span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessor</span><span class="p">(</span><span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">)</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">preprocessor</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_pyrush&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="n">pyrush_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;resources&quot;</span><span class="p">,</span> <span class="n">language_code</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;rush_rules.tsv&quot;</span>
        <span class="p">)</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_pyrush&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rules_path&quot;</span><span class="p">:</span> <span class="n">pyrush_path</span><span class="p">})</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_target_matcher&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_target_matcher&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_quickumls&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">quickumls_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quickumls_path</span> <span class="o">=</span> <span class="n">get_quickumls_demo_dir</span><span class="p">(</span><span class="n">language_code</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Loading QuickUMLS resources from a Medspacy-distributed SAMPLE of UMLS data from here: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">quickumls_path</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_quickumls&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;quickumls_fp&quot;</span><span class="p">:</span> <span class="n">quickumls_path</span><span class="p">})</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_context&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">load_rules</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;language_code&#39;</span><span class="p">:</span> <span class="n">language_code</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="s1">&#39;language_code&#39;</span><span class="p">:</span> <span class="n">language_code</span><span class="p">}</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_context&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_sectionizer&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">load_rules</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;language_code&#39;</span><span class="p">:</span> <span class="n">language_code</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rules&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                      <span class="s1">&#39;language_code&#39;</span><span class="p">:</span> <span class="n">language_code</span><span class="p">}</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_sectionizer&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_postprocessor&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_postprocessor&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;medspacy_doc_consumer&quot;</span> <span class="ow">in</span> <span class="n">medspacy_enable</span><span class="p">:</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="s2">&quot;medspacy_doc_consumer&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nlp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.util.tuple_overlaps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tuple_overlaps</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates whether two tuples overlap. Assumes tuples are sorted to be like spans (start, end)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple representing a span (start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[int, int]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple representing a span (start, end).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the tuples overlap.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tuple_overlaps</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates whether two tuples overlap. Assumes tuples are sorted to be like spans (start, end)</span>

<span class="sd">    Args:</span>
<span class="sd">        a: A tuple representing a span (start, end).</span>
<span class="sd">        b: A tuple representing a span (start, end).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Whether the tuples overlap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="medspacy.visualization" class="doc doc-heading">
            <code>visualization</code>


</h2>

    <div class="doc doc-contents ">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="medspacy.visualization.MedspaCyVisualizerWidget" class="doc doc-heading">
            <code>MedspaCyVisualizerWidget</code>


</h3>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>medspacy/visualization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MedspaCyVisualizerWidget</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">target_span_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an IPython Widget Box displaying medspaCy&#39;s visualizers.</span>
<span class="sd">        The widget allows selecting visualization style (&quot;Ent&quot;, &quot;Dep&quot;, or &quot;Both&quot;)</span>
<span class="sd">        and a slider for selecting the index of docs.</span>

<span class="sd">        For more information on IPython widgets, see:</span>
<span class="sd">            https://ipywidgets.readthedocs.io/en/latest/index.html</span>

<span class="sd">        Parameters:</span>
<span class="sd">            docs: A list of docs processed by a medspaCy pipeline</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_span_type</span> <span class="o">=</span> <span class="n">target_span_type</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Doc:&quot;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">readout_format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ent&quot;</span><span class="p">,</span> <span class="s2">&quot;Dep&quot;</span><span class="p">,</span> <span class="s2">&quot;Both&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
            <span class="n">display</span><span class="o">=</span><span class="s2">&quot;flex&quot;</span><span class="p">,</span> <span class="n">flex_flow</span><span class="o">=</span><span class="s2">&quot;column&quot;</span><span class="p">,</span> <span class="n">align_items</span><span class="o">=</span><span class="s2">&quot;stretch&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Next&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_click_next</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Previous&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_click_prev</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_doc</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the Box widget in the current IPython cell.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span> <span class="k">as</span> <span class="n">ipydisplay</span>

        <span class="n">ipydisplay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_change_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_doc</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;dep&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
            <span class="n">visualize_dep</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ent&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">):</span>
            <span class="n">visualize_ent</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">target_span_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_span_type</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_click_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_on_click_prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">value</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">):</span>
        <span class="s2">&quot;Replace the list of docs to be visualized.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_doc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="medspacy.visualization.MedspaCyVisualizerWidget.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">target_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Create an IPython Widget Box displaying medspaCy's visualizers.
The widget allows selecting visualization style ("Ent", "Dep", or "Both")
and a slider for selecting the index of docs.</p>
<p>For more information on IPython widgets, see:
    https://ipywidgets.readthedocs.io/en/latest/index.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>docs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of docs processed by a medspaCy pipeline</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="n">target_span_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create an IPython Widget Box displaying medspaCy&#39;s visualizers.</span>
<span class="sd">    The widget allows selecting visualization style (&quot;Ent&quot;, &quot;Dep&quot;, or &quot;Both&quot;)</span>
<span class="sd">    and a slider for selecting the index of docs.</span>

<span class="sd">    For more information on IPython widgets, see:</span>
<span class="sd">        https://ipywidgets.readthedocs.io/en/latest/index.html</span>

<span class="sd">    Parameters:</span>
<span class="sd">        docs: A list of docs processed by a medspaCy pipeline</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_span_type</span> <span class="o">=</span> <span class="n">target_span_type</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">span_group_name</span> <span class="o">=</span> <span class="n">span_group_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Doc:&quot;</span><span class="p">,</span>
        <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">continuous_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
        <span class="n">readout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">readout_format</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">radio</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ent&quot;</span><span class="p">,</span> <span class="s2">&quot;Dep&quot;</span><span class="p">,</span> <span class="s2">&quot;Both&quot;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span>
        <span class="n">display</span><span class="o">=</span><span class="s2">&quot;flex&quot;</span><span class="p">,</span> <span class="n">flex_flow</span><span class="o">=</span><span class="s2">&quot;column&quot;</span><span class="p">,</span> <span class="n">align_items</span><span class="o">=</span><span class="s2">&quot;stretch&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_handler</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_change_handler</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Next&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_click_next</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Previous&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_click_prev</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">radio</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_button</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="n">layout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_doc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.visualization.MedspaCyVisualizerWidget.display" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Display the Box widget in the current IPython cell.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the Box widget in the current IPython cell.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span> <span class="k">as</span> <span class="n">ipydisplay</span>

    <span class="n">ipydisplay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">box</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="medspacy.visualization.MedspaCyVisualizerWidget.set_docs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Replace the list of docs to be visualized.</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">):</span>
    <span class="s2">&quot;Replace the list of docs to be visualized.&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="n">docs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_visualize_doc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="medspacy.visualization._create_color_generator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_create_color_generator</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a generator which will cycle through a list of
default matplotlib colors</p>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_color_generator</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a generator which will cycle through a list of</span>
<span class="sd">    default matplotlib colors&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">cycle</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;#1f77b4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#ff7f0e&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#2ca02c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#d62728&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#9467bd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#8c564b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#e377c2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#7f7f7f&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#bcbd22&quot;</span><span class="p">,</span>
        <span class="s2">&quot;#17becf&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">cycle</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.visualization.visualize_dep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visualize_dep</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a dependency-style visualization for ConText targets and modifiers in doc. This will show the relationships
between entities in doc and contextual modifiers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The spacy Doc to visualize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jupyter</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether it is being rendered in a jupyter notebook.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visualization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visualize_dep</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span> <span class="n">jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a dependency-style visualization for ConText targets and modifiers in doc. This will show the relationships</span>
<span class="sd">    between entities in doc and contextual modifiers.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: The spacy Doc to visualize.</span>
<span class="sd">        jupyter: Whether it is being rendered in a jupyter notebook.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">token_data_mapping</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span><span class="p">}</span>
        <span class="n">token_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">token_data_mapping</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># Merge phrases</span>
    <span class="c1"># targets_and_modifiers = [*doc._.context_graph.targets]</span>
    <span class="n">existing_tokens</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">targets_and_modifiers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Used to prevent duplication of token in targets or modifiers that appear twice due to being in a span group or, appearing twice as a modifier</span>
    <span class="k">for</span> <span class="n">target_or_modifier</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">modifiers</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">target_or_modifier</span><span class="p">,</span> <span class="n">Span</span><span class="p">):</span>
            <span class="n">span</span><span class="o">=</span><span class="n">target_or_modifier</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">span</span><span class="o">=</span><span class="n">doc</span><span class="p">[</span><span class="n">target_or_modifier</span><span class="o">.</span><span class="n">_start</span> <span class="p">:</span> <span class="n">target_or_modifier</span><span class="o">.</span><span class="n">_end</span><span class="p">]</span>
        <span class="n">already_seen</span> <span class="o">=</span> <span class="kc">False</span> 
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">span</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">existing_tokens</span><span class="p">:</span>
                <span class="n">already_seen</span> <span class="o">=</span> <span class="kc">True</span> 
                <span class="k">break</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">already_seen</span><span class="p">:</span>
            <span class="n">targets_and_modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_or_modifier</span><span class="p">)</span>
            <span class="n">existing_tokens</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">token</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">span</span><span class="p">})</span> 

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">targets_and_modifiers</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Span</span><span class="p">):</span>
            <span class="n">first_token</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">token_data_mapping</span><span class="p">[</span><span class="n">first_token</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">label_</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">other_token</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="c1"># Add the text to the display data for the first word</span>
                    <span class="c1"># and remove the subsequent token</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">other_token</span><span class="o">.</span><span class="n">text</span>
                    <span class="c1"># Remove this token from the list of display data</span>
                    <span class="n">token_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">other_data</span> <span class="ow">in</span> <span class="n">token_data</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">other_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">span_tup</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">modifier_span</span>
            <span class="n">first_token</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">span_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">token_data_mapping</span><span class="p">[</span><span class="n">first_token</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">category</span>
            <span class="k">if</span> <span class="n">span_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">span_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">span_tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">span_tup</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">other_token</span> <span class="ow">in</span> <span class="n">span</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="c1"># Add the text to the display data for the first word</span>
                    <span class="c1"># and remove the subsequent token</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">other_token</span><span class="o">.</span><span class="n">text</span>
                    <span class="c1"># Remove this token from the list of display data</span>
                    <span class="n">token_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">other_data</span> <span class="ow">in</span> <span class="n">token_data</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">other_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">span</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c1"># if len(span) == 1:</span>
        <span class="c1">#     continue</span>
        <span class="c1">#</span>
        <span class="c1"># idx = data[&quot;index&quot;]</span>
        <span class="c1"># for other_token in span[1:]:</span>
        <span class="c1">#     # Add the text to the display data for the first word</span>
        <span class="c1">#     # and remove the subsequent token</span>
        <span class="c1">#     data[&quot;text&quot;] += &quot; &quot; + other_token.text</span>
        <span class="c1">#     # Remove this token from the list of display data</span>
        <span class="c1">#     token_data.pop(idx + 1)</span>
        <span class="c1">#</span>
        <span class="c1"># # Lower the index of the following tokens</span>
        <span class="c1"># for other_data in token_data[idx + 1 :]:</span>
        <span class="c1">#     other_data[&quot;index&quot;] -= len(span) - 1</span>

    <span class="n">dep_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;words&quot;</span><span class="p">:</span> <span class="n">token_data</span><span class="p">,</span> <span class="s2">&quot;arcs&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Gather the edges between targets and modifiers</span>
    <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">context_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">target_data</span> <span class="o">=</span> <span class="n">token_data_mapping</span><span class="p">[</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">modifier_data</span> <span class="o">=</span> <span class="n">token_data_mapping</span><span class="p">[</span><span class="n">doc</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
        <span class="n">dep_data</span><span class="p">[</span><span class="s2">&quot;arcs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">target_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">],</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">target_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">],</span> <span class="n">modifier_data</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                <span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span>
                <span class="k">if</span> <span class="n">target</span> <span class="o">&gt;</span> <span class="n">doc</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">dep_data</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="n">jupyter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="medspacy.visualization.visualize_ent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">visualize_ent</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sections</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_span_type</span><span class="o">=</span><span class="s1">&#39;ents&#39;</span><span class="p">,</span> <span class="n">span_group_name</span><span class="o">=</span><span class="s1">&#39;medspacy_spans&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a NER-style visualization for targets and modifiers in Doc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>doc</code>
            </td>
            <td>
                  <code><span title="spacy.tokens.Doc">Doc</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A spacy doc to visualize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display the modifiers generated by medSpaCy's cycontext. If the doc has not been processed
by context, this will be automatically changed to False. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sections</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to display the section titles generated by medSpaCy's sectionizer (still in development). If
the doc has not been processed by sectionizer , this will be automatically changed to False. This may also
have some overlap with cycontext, in which case duplicate spans will be displayed. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>jupyter</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, will render directly in a Jupyter notebook. If False, will return the HTML. Default True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colors</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[str, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional dictionary which maps labels of targets and modifiers to color strings to be rendered. If
None, will create a generator which cycles through the default matplotlib colors for ent and modifier labels
and uses a light gray for section headers. Default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The visualization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>medspacy/visualization.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visualize_ent</span><span class="p">(</span>
    <span class="n">doc</span><span class="p">:</span> <span class="n">Doc</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">sections</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">jupyter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">colors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_span_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ents&quot;</span><span class="p">,</span>
    <span class="n">span_group_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;medspacy_spans&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a NER-style visualization for targets and modifiers in Doc.</span>

<span class="sd">    Args:</span>
<span class="sd">        doc: A spacy doc to visualize.</span>
<span class="sd">        context: Whether to display the modifiers generated by medSpaCy&#39;s cycontext. If the doc has not been processed</span>
<span class="sd">            by context, this will be automatically changed to False. Default True.</span>
<span class="sd">        sections: Whether to display the section titles generated by medSpaCy&#39;s sectionizer (still in development). If</span>
<span class="sd">            the doc has not been processed by sectionizer , this will be automatically changed to False. This may also</span>
<span class="sd">            have some overlap with cycontext, in which case duplicate spans will be displayed. Default True.</span>
<span class="sd">        jupyter: If True, will render directly in a Jupyter notebook. If False, will return the HTML. Default True.</span>
<span class="sd">        colors: An optional dictionary which maps labels of targets and modifiers to color strings to be rendered. If</span>
<span class="sd">            None, will create a generator which cycles through the default matplotlib colors for ent and modifier labels</span>
<span class="sd">            and uses a light gray for section headers. Default None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure that doc has the custom medSpaCy attributes registered</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="s2">&quot;context_graph&quot;</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="p">,</span> <span class="s2">&quot;sections&quot;</span><span class="p">):</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">ents_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">target_span_type</span> <span class="o">==</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span>
    <span class="k">elif</span> <span class="n">target_span_type</span> <span class="o">==</span> <span class="s2">&quot;group&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">spans</span><span class="p">[</span><span class="n">span_group_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target span type must be either ents or group.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">ent_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">target</span><span class="o">.</span><span class="n">start_char</span><span class="p">,</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">target</span><span class="o">.</span><span class="n">end_char</span><span class="p">,</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">target</span><span class="o">.</span><span class="n">label_</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">ents_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ent_data</span><span class="p">,</span> <span class="s2">&quot;ent&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
        <span class="n">visualized_modifiers</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">modifiers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modifier</span> <span class="ow">in</span> <span class="n">visualized_modifiers</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">modifier</span><span class="o">.</span><span class="n">modifier_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">ent_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">span</span><span class="o">.</span><span class="n">start_char</span><span class="p">,</span>
                    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">span</span><span class="o">.</span><span class="n">end_char</span><span class="p">,</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">modifier</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">ents_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ent_data</span><span class="p">,</span> <span class="s2">&quot;modifier&quot;</span><span class="p">))</span>
                <span class="n">visualized_modifiers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">modifier</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sections</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">section</span><span class="o">.</span><span class="n">category</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="n">section</span><span class="o">.</span><span class="n">title_span</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">section</span><span class="o">.</span><span class="n">title_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">ent_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">span</span><span class="o">.</span><span class="n">start_char</span><span class="p">,</span>
                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">span</span><span class="o">.</span><span class="n">end_char</span><span class="p">,</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&lt;&lt; </span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> &gt;&gt;&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">ents_data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ent_data</span><span class="p">,</span> <span class="s2">&quot;section&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ents_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># No data to display</span>
        <span class="n">viz_data</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;ents&quot;</span><span class="p">:</span> <span class="p">[]}]</span>
        <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ents_data</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ents_data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;start&quot;</span><span class="p">])</span>

        <span class="c1"># If colors aren&#39;t defined, generate color mappings for each entity</span>
        <span class="c1"># and modifier label and set all section titles to a light gray</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">section_titles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">ent_data</span><span class="p">,</span> <span class="n">ent_type</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ents_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ent_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;ent&quot;</span><span class="p">,</span> <span class="s2">&quot;modifier&quot;</span><span class="p">):</span>
                    <span class="n">labels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ent_data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">ent_type</span> <span class="o">==</span> <span class="s2">&quot;section&quot;</span><span class="p">:</span>
                    <span class="n">section_titles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ent_data</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">_create_color_mapping</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">section_titles</span><span class="p">:</span>
                <span class="n">colors</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#dee0e3&quot;</span>
        <span class="n">ents_display_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">ents_data</span><span class="p">)</span>
        <span class="n">viz_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="s2">&quot;ents&quot;</span><span class="p">:</span> <span class="n">ents_display_data</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;colors&quot;</span><span class="p">:</span> <span class="n">colors</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">viz_data</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">jupyter</span><span class="o">=</span><span class="n">jupyter</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
